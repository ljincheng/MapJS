var geomap=geomap||{version:"1.0.0"};if(typeof exports!=="undefined"){exports.geomap=geomap}if(typeof document!=="undefined"&&typeof window!=="undefined"){if(document instanceof (typeof HTMLDocument!=="undefined"?HTMLDocument:Document)){geomap.document=document}else{geomap.document=document.implementation.createHTMLDocument("")}geomap.window=window;geomap.log=console.log;geomap.warn=console.warn;geomap.debug=console.log}else{var jsdom=require("jsdom");var virtualWindow=new jsdom.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;geomap.document=virtualWindow.document;geomap.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper;geomap.nodeCanvas=require("jsdom/lib/jsdom/utils").Canvas;geomap.window=virtualWindow;geomap.log=console.log;geomap.warn=console.warn;geomap.debug=console.log;DOMParser=geomap.window.DOMParser}if(typeof document!=="undefined"&&typeof window!=="undefined"){window.geomap=geomap}if(typeof(eventjs)==="undefined"){var eventjs={}}(function(n){n.modifyEventListener=false;n.modifySelectors=false;n.configure=function(s){if(isFinite(s.modifyEventListener)){n.modifyEventListener=s.modifyEventListener}if(isFinite(s.modifySelectors)){n.modifySelectors=s.modifySelectors}if(e===false&&n.modifyEventListener){l()}if(f===false&&n.modifySelectors){o()}};n.add=function(v,t,u,s){return d(v,t,u,s,"add")};n.remove=function(v,t,u,s){return d(v,t,u,s,"remove")};n.returnFalse=function(s){return false};n.stop=function(s){if(!s){return}if(s.stopPropagation){s.stopPropagation()}s.cancelBubble=true;s.cancelBubbleCount=0};n.prevent=function(s){if(!s){return}if(s.preventDefault){s.preventDefault()}else{if(s.preventManipulation){s.preventManipulation()}else{s.returnValue=false}}};n.cancel=function(s){n.stop(s);n.prevent(s)};n.blur=function(){var s=document.activeElement;if(!s){return}var t=document.activeElement.nodeName;if(t==="INPUT"||t==="TEXTAREA"||s.contentEditable==="true"){if(s.blur){s.blur()}}};n.getEventSupport=function(u,t){if(typeof(u)==="string"){t=u;u=window}t="on"+t;if(t in u){return true}if(!u.setAttribute){u=document.createElement("div")}if(u.setAttribute&&u.removeAttribute){u.setAttribute(t,"");var s=typeof u[t]==="function";if(typeof u[t]!=="undefined"){u[t]=null}u.removeAttribute(t);return s}};var q=function(u){if(!u||typeof(u)!=="object"){return u}var s=new u.constructor();for(var t in u){if(!u[t]||typeof(u[t])!=="object"){s[t]=u[t]}else{s[t]=q(u[t])}}return s};var d=function(S,u,v,R,D,N){R=R||{};if(String(S)==="[object Object]"){var U=S;S=U.target;delete U.target;if(U.type&&U.listener){u=U.type;delete U.type;v=U.listener;delete U.listener;for(var V in U){R[V]=U[V]}}else{for(var w in U){var K=U[w];if(typeof(K)==="function"){continue}R[w]=K}var T={};for(var V in U){var w=V.split(",");var H=U[V];var B={};for(var L in R){B[L]=R[L]}if(typeof(H)==="function"){var v=H}else{if(typeof(H.listener)==="function"){var v=H.listener;for(var L in H){if(typeof(H[L])==="function"){continue}B[L]=H[L]}}else{continue}}for(var J=0;J<w.length;J++){T[V]=eventjs.add(S,w[J],v,B,D)}}return T}}if(!S||!u||!v){return}if(typeof(S)==="string"&&u==="ready"){if(window.eventjs_stallOnReady){u="load";S=window}else{var x=(new Date()).getTime();var A=R.timeout;var I=R.interval||1000/60;var O=window.setInterval(function(){if((new Date()).getTime()-x>A){window.clearInterval(O)}if(document.querySelector(S)){window.clearInterval(O);setTimeout(v,1)}},I);return}}if(typeof(S)==="string"){S=document.querySelectorAll(S);if(S.length===0){return b("Missing target on listener!",arguments)}if(S.length===1){S=S[0]}}var M;var s={};if(S.length>0&&S!==window){for(var z=0,G=S.length;z<G;z++){M=d(S[z],u,v,q(R),D);if(M){s[z]=M}}return i(s)}if(typeof(u)==="string"){u=u.toLowerCase();if(u.indexOf(" ")!==-1){u=u.split(" ")}else{if(u.indexOf(",")!==-1){u=u.split(",")}}}if(typeof(u)!=="string"){if(typeof(u.length)==="number"){for(var y=0,E=u.length;y<E;y++){M=d(S,u[y],v,q(R),D);if(M){s[u[y]]=M}}}else{for(var V in u){if(typeof(u[V])==="function"){M=d(S,V,u[V],q(R),D)}else{M=d(S,V,u[V].listener,q(u[V]),D)}if(M){s[V]=M}}}return i(s)}else{if(u.indexOf("on")===0){u=u.substr(2)}}if(typeof(S)!=="object"){return b("Target is not defined!",arguments)}if(typeof(v)!=="function"){return b("Listener is not a function!",arguments)}var Q=R.useCapture||false;var F=c(S)+"."+c(v)+"."+(Q?1:0);if(n.Gesture&&n.Gesture._gestureHandlers[u]){F=u+F;if(D==="remove"){if(!j[F]){return}j[F].remove();delete j[F]}else{if(D==="add"){if(j[F]){j[F].add();return j[F]}if(R.useCall&&!n.modifyEventListener){var P=v;v=function(Y,W){for(var X in W){Y[X]=W[X]}return P.call(S,Y)}}R.gesture=u;R.target=S;R.listener=v;R.fromOverwrite=N;j[F]=n.proxy[u](R)}}return j[F]}else{var t=g(u);for(var J=0,C;J<t.length;J++){u=t[J];C=u+"."+F;if(D==="remove"){if(!j[C]){continue}S[r](u,v,Q);delete j[C]}else{if(D==="add"){if(j[C]){return j[C]}S[m](u,v,Q);j[C]={id:C,type:u,target:S,listener:v,remove:function(){for(var W=0;W<t.length;W++){n.remove(S,t[W],v,R)}}}}}}return j[C]}};var i=function(s){return{remove:function(){for(var t in s){s[t].remove()}},add:function(){for(var t in s){s[t].add()}}}};var b=function(s,t){if(typeof(console)==="undefined"){return}if(typeof(console.error)==="undefined"){return}console.error(s,t)};var p={msPointer:["MSPointerDown","MSPointerMove","MSPointerUp"],touch:["touchstart","touchmove","touchend"],mouse:["mousedown","mousemove","mouseup"]};var h={MSPointerDown:0,MSPointerMove:1,MSPointerUp:2,touchstart:0,touchmove:1,touchend:2,mousedown:0,mousemove:1,mouseup:2};var a=(function(){n.supports={};if(window.navigator.msPointerEnabled){n.supports.msPointer=true}if(n.getEventSupport("touchstart")){n.supports.touch=true}if(n.getEventSupport("mousedown")){n.supports.mouse=true}})();var g=(function(){return function(v){var w=document.addEventListener?"":"on";var s=h[v];if(isFinite(s)){var u=[];for(var t in n.supports){u.push(w+p[t][s])}return u}else{return[w+v]}}})();var j={};var k=0;var c=function(s){if(s===window){return"#window"}if(s===document){return"#document"}if(!s.uniqueID){s.uniqueID="e"+k++}return s.uniqueID};var m=document.addEventListener?"addEventListener":"attachEvent";var r=document.removeEventListener?"removeEventListener":"detachEvent";n.createPointerEvent=function(t,z,s){var w=z.gesture;var x=z.target;var A=t.changedTouches||n.proxy.getCoords(t);if(A.length){var B=A[0];z.pointers=s?[]:A;z.pageX=B.pageX;z.pageY=B.pageY;z.x=z.pageX;z.y=z.pageY}var v=document.createEvent("Event");v.initEvent(w,true,true);v.originalEvent=t;for(var u in z){if(u==="target"){continue}v[u]=z[u]}var y=v.type;if(n.Gesture&&n.Gesture._gestureHandlers[y]){z.oldListener.call(x,v,z,false)}};var e=false;var l=function(){if(!window.HTMLElement){return}var s=function(u){var t=function(v){var x=v+"EventListener";var w=u[x];u[x]=function(B,C,y){if(n.Gesture&&n.Gesture._gestureHandlers[B]){var z=y;if(typeof(y)==="object"){z.useCall=true}else{z={useCall:true,useCapture:y}}d(this,B,C,z,v,true)}else{var A=g(B);for(var D=0;D<A.length;D++){w.call(this,A[D],C,y)}}}};t("add");t("remove")};if(navigator.userAgent.match(/Firefox/)){s(HTMLDivElement.prototype);s(HTMLCanvasElement.prototype)}else{s(HTMLElement.prototype)}s(document);s(window)};var f=false;var o=function(){var s=NodeList.prototype;s.removeEventListener=function(u,w,t){for(var x=0,v=this.length;x<v;x++){this[x].removeEventListener(u,w,t)}};s.addEventListener=function(u,w,t){for(var x=0,v=this.length;x<v;x++){this[x].addEventListener(u,w,t)}}};return n})(eventjs);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.pointerSetup=function(f,e){f.target=f.target||window;f.doc=f.target.ownerDocument||f.target;f.minFingers=f.minFingers||f.fingers||1;f.maxFingers=f.maxFingers||f.fingers||Infinity;f.position=f.position||"relative";delete f.fingers;e=e||{};e.enabled=true;e.gesture=f.gesture;e.target=f.target;e.env=f.env;if(eventjs.modifyEventListener&&f.fromOverwrite){f.oldListener=f.listener;f.listener=eventjs.createPointerEvent}var d=0;var g=e.gesture.indexOf("pointer")===0&&eventjs.modifyEventListener?"pointer":"mouse";if(f.oldListener){e.oldListener=f.oldListener}e.listener=f.listener;e.proxy=function(h){e.defaultListener=f.listener;f.listener=h;h(f.event,e)};e.add=function(){if(e.enabled===true){return}if(f.onPointerDown){eventjs.add(f.target,g+"down",f.onPointerDown)}if(f.onPointerMove){eventjs.add(f.doc,g+"move",f.onPointerMove)}if(f.onPointerUp){eventjs.add(f.doc,g+"up",f.onPointerUp)}e.enabled=true};e.remove=function(){if(e.enabled===false){return}if(f.onPointerDown){eventjs.remove(f.target,g+"down",f.onPointerDown)}if(f.onPointerMove){eventjs.remove(f.doc,g+"move",f.onPointerMove)}if(f.onPointerUp){eventjs.remove(f.doc,g+"up",f.onPointerUp)}e.reset();e.enabled=false};e.pause=function(h){if(f.onPointerMove&&(!h||h.move)){eventjs.remove(f.doc,g+"move",f.onPointerMove)}if(f.onPointerUp&&(!h||h.up)){eventjs.remove(f.doc,g+"up",f.onPointerUp)}d=f.fingers;f.fingers=0};e.resume=function(h){if(f.onPointerMove&&(!h||h.move)){eventjs.add(f.doc,g+"move",f.onPointerMove)}if(f.onPointerUp&&(!h||h.up)){eventjs.add(f.doc,g+"up",f.onPointerUp)}f.fingers=d};e.reset=function(){f.tracker={};f.fingers=0};return e};var b=eventjs.supports;eventjs.isMouse=!!b.mouse;eventjs.isMSPointer=!!b.touch;eventjs.isTouch=!!b.msPointer;a.pointerStart=function(e,r,o){var p=(e.type||"mousedown").toUpperCase();if(p.indexOf("MOUSE")===0){eventjs.isMouse=true;eventjs.isTouch=false;eventjs.isMSPointer=false}else{if(p.indexOf("TOUCH")===0){eventjs.isMouse=false;eventjs.isTouch=true;eventjs.isMSPointer=false}else{if(p.indexOf("MSPOINTER")===0){eventjs.isMouse=false;eventjs.isTouch=false;eventjs.isMSPointer=true}}}var k=function(z,t){var v=o.bbox;var u=h[t]={};switch(o.position){case"absolute":u.offsetX=0;u.offsetY=0;break;case"differenceFromLast":u.offsetX=z.pageX;u.offsetY=z.pageY;break;case"difference":u.offsetX=z.pageX;u.offsetY=z.pageY;break;case"move":u.offsetX=z.pageX-v.x1;u.offsetY=z.pageY-v.y1;break;default:u.offsetX=v.x1-v.scrollLeft;u.offsetY=v.y1-v.scrollTop;break}var i=z.pageX-u.offsetX;var w=z.pageY-u.offsetY;u.rotation=0;u.scale=1;u.startTime=u.moveTime=(new Date()).getTime();u.move={x:i,y:w};u.start={x:i,y:w};o.fingers++};o.event=e;if(r.defaultListener){o.listener=r.defaultListener;delete r.defaultListener}var s=!o.fingers;var h=o.tracker;var n=e.changedTouches||a.getCoords(e);var g=n.length;for(var m=0;m<g;m++){var l=n[m];var f=l.identifier||Infinity;if(o.fingers){if(o.fingers>=o.maxFingers){var d=[];for(var f in o.tracker){d.push(f)}r.identifier=d.join(",");return s}var j=0;for(var q in h){if(h[q].up){delete h[q];k(l,f);o.cancel=true;break}j++}if(h[f]){continue}k(l,f)}else{h=o.tracker={};r.bbox=o.bbox=a.getBoundingBox(o.target);o.fingers=0;o.cancel=false;k(l,f)}}var d=[];for(var f in o.tracker){d.push(f)}r.identifier=d.join(",");return s};a.pointerEnd=function(e,p,n,j){var m=e.touches||[];var h=m.length;var o={};for(var l=0;l<h;l++){var k=m[l];var f=k.identifier;o[f||Infinity]=true}for(var f in n.tracker){var g=n.tracker[f];if(o[f]||g.up){continue}if(j){j({pageX:g.pageX,pageY:g.pageY,changedTouches:[{pageX:g.pageX,pageY:g.pageY,identifier:f==="Infinity"?Infinity:f}]},"up")}g.up=true;n.fingers--}if(n.fingers!==0){return false}var d=[];n.gestureFingers=0;for(var f in n.tracker){n.gestureFingers++;d.push(f)}p.identifier=d.join(",");return true};a.getCoords=function(d){if(typeof(d.pageX)!=="undefined"){a.getCoords=function(e){return Array({type:"mouse",x:e.pageX,y:e.pageY,pageX:e.pageX,pageY:e.pageY,identifier:e.pointerId||Infinity})}}else{a.getCoords=function(e){var f=document.documentElement;e=e||window.event;return Array({type:"mouse",x:e.clientX+f.scrollLeft,y:e.clientY+f.scrollTop,pageX:e.clientX+f.scrollLeft,pageY:e.clientY+f.scrollTop,identifier:Infinity})}}return a.getCoords(d)};a.getCoord=function(f){if("ontouchstart" in window){var e=0;var d=0;a.getCoord=function(g){var h=g.changedTouches;if(h&&h.length){return{x:e=h[0].pageX,y:d=h[0].pageY}}else{return{x:e,y:d}}}}else{if(typeof(f.pageX)!=="undefined"&&typeof(f.pageY)!=="undefined"){a.getCoord=function(g){return{x:g.pageX,y:g.pageY}}}else{a.getCoord=function(g){var h=document.documentElement;g=g||window.event;return{x:g.clientX+h.scrollLeft,y:g.clientY+h.scrollTop}}}}return a.getCoord(f)};var c=function(e,d){var f=parseFloat(e.getPropertyValue(d),10);return isFinite(f)?f:0};a.getBoundingBox=function(g){if(g===window||g===document){g=document.body}var n={};var m=g.getBoundingClientRect();n.width=m.width;n.height=m.height;n.x1=m.left;n.y1=m.top;n.scaleX=m.width/g.offsetWidth||1;n.scaleY=m.height/g.offsetHeight||1;n.scrollLeft=0;n.scrollTop=0;var f=window.getComputedStyle(g);var e=f.getPropertyValue("box-sizing")==="border-box";if(e===false){var h=c(f,"border-left-width");var l=c(f,"border-right-width");var d=c(f,"border-bottom-width");var k=c(f,"border-top-width");n.border=[h,l,k,d];n.x1+=h;n.y1+=k;n.width-=l+h;n.height-=d+k}n.x2=n.x1+n.width;n.y2=n.y1+n.height;var j=f.getPropertyValue("position");var i=j==="fixed"?g:g.parentNode;while(i!==null){if(i===document.body){break}if(i.scrollTop===undefined){break}var f=window.getComputedStyle(i);var j=f.getPropertyValue("position");if(j==="absolute"){}else{if(j==="fixed"){n.scrollTop-=i.parentNode.scrollTop;n.scrollLeft-=i.parentNode.scrollLeft;break}else{n.scrollLeft+=i.scrollLeft;n.scrollTop+=i.scrollTop}}i=i.parentNode}n.scrollBodyLeft=(window.pageXOffset!==undefined)?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft;n.scrollBodyTop=(window.pageYOffset!==undefined)?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;n.scrollLeft-=n.scrollBodyLeft;n.scrollTop-=n.scrollBodyTop;return n};(function(){var e=navigator.userAgent.toLowerCase();var f=e.indexOf("macintosh")!==-1;var d;if(f&&e.indexOf("khtml")!==-1){d={91:true,93:true}}else{if(f&&e.indexOf("firefox")!==-1){d={224:true}}else{d={17:true}}}(a.metaTrackerReset=function(){eventjs.fnKey=a.fnKey=false;eventjs.metaKey=a.metaKey=false;eventjs.escKey=a.escKey=false;eventjs.ctrlKey=a.ctrlKey=false;eventjs.shiftKey=a.shiftKey=false;eventjs.altKey=a.altKey=false})();a.metaTracker=function(h){var g=h.type==="keydown";if(h.keyCode===27){eventjs.escKey=a.escKey=g}if(d[h.keyCode]){eventjs.metaKey=a.metaKey=g}eventjs.ctrlKey=a.ctrlKey=h.ctrlKey;eventjs.shiftKey=a.shiftKey=h.shiftKey;eventjs.altKey=a.altKey=h.altKey}})();return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}eventjs.MutationObserver=(function(){var b=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;var a=!b&&(function(){var e=document.createElement("p");var c=false;var d=function(){c=true};if(e.addEventListener){e.addEventListener("DOMAttrModified",d,false)}else{if(e.attachEvent){e.attachEvent("onDOMAttrModified",d)}else{return false}}e.setAttribute("id","target");return c})();return function(c,f){if(b){var e={subtree:false,attributes:true};var d=new b(function(g){g.forEach(function(h){f.call(h.target,h.attributeName)})});d.observe(c,e)}else{if(a){eventjs.add(c,"DOMAttrModified",function(g){f.call(c,g.attrName)})}else{if("onpropertychange" in document.body){eventjs.add(c,"propertychange",function(g){f.call(c,window.event.propertyName)})}}}}})();if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.click=function(c){c.gesture=c.gesture||"click";c.maxFingers=c.maxFingers||c.fingers||1;c.onPointerDown=function(d){if(a.pointerStart(d,b,c)){eventjs.add(c.target,"mouseup",c.onPointerUp)}};c.onPointerUp=function(e){if(a.pointerEnd(e,b,c)){eventjs.remove(c.target,"mouseup",c.onPointerUp);var k=e.changedTouches||a.getCoords(e);var d=k[0];var l=c.bbox;var f=a.getBoundingBox(c.target);var g=d.pageY-f.scrollBodyTop;var h=d.pageX-f.scrollBodyLeft;if(h>l.x1&&g>l.y1&&h<l.x2&&g<l.y2&&l.scrollTop===f.scrollTop){for(var j in c.tracker){break}var i=c.tracker[j];b.x=i.start.x;b.y=i.start.y;c.listener(e,b)}}};var b=a.pointerSetup(c);b.state="click";eventjs.add(c.target,"mousedown",c.onPointerDown);return b};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.click=a.click;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.dbltap=a.dblclick=function(f){f.gesture=f.gesture||"dbltap";f.maxFingers=f.maxFingers||f.fingers||1;var e=700;var i,h,g;var d,c;f.onPointerDown=function(k){var j=k.changedTouches||a.getCoords(k);if(i&&!h){c=j[0];h=(new Date()).getTime()-i}else{d=j[0];i=(new Date()).getTime();h=0;clearTimeout(g);g=setTimeout(function(){i=0},e)}if(a.pointerStart(k,b,f)){eventjs.add(f.target,"mousemove",f.onPointerMove).listener(k);eventjs.add(f.target,"mouseup",f.onPointerUp)}};f.onPointerMove=function(l){if(i&&!h){var j=l.changedTouches||a.getCoords(l);c=j[0]}var n=f.bbox;var m=(c.pageX-n.x1);var k=(c.pageY-n.y1);if(!(m>0&&m<n.width&&k>0&&k<n.height&&Math.abs(c.pageX-d.pageX)<=25&&Math.abs(c.pageY-d.pageY)<=25)){eventjs.remove(f.target,"mousemove",f.onPointerMove);clearTimeout(g);i=h=0}};f.onPointerUp=function(l){if(a.pointerEnd(l,b,f)){eventjs.remove(f.target,"mousemove",f.onPointerMove);eventjs.remove(f.target,"mouseup",f.onPointerUp)}if(i&&h){if(h<=e){b.state=f.gesture;for(var k in f.tracker){break}var j=f.tracker[k];b.x=j.start.x;b.y=j.start.y;f.listener(l,b)}clearTimeout(g);i=h=0}};var b=a.pointerSetup(f);b.state="dblclick";eventjs.add(f.target,"mousedown",f.onPointerDown);return b};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.dbltap=a.dbltap;eventjs.Gesture._gestureHandlers.dblclick=a.dblclick;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.dragElement=function(c,b){a.drag({event:b,target:c,position:"move",listener:function(e,d){c.style.left=d.x+"px";c.style.top=d.y+"px";eventjs.prevent(e)}})};a.drag=function(c){c.gesture="drag";c.onPointerDown=function(d){if(a.pointerStart(d,b,c)){if(!c.monitor){eventjs.add(c.doc,"mousemove",c.onPointerMove);eventjs.add(c.doc,"mouseup",c.onPointerUp)}}c.onPointerMove(d,"down")};c.onPointerMove=function(e,d){if(!c.tracker){return c.onPointerDown(e)}var l=c.bbox;var j=e.changedTouches||a.getCoords(e);var f=j.length;for(var h=0;h<f;h++){var g=j[h];var k=g.identifier||Infinity;var m=c.tracker[k];if(!m){continue}m.pageX=g.pageX;m.pageY=g.pageY;b.state=d||"move";b.identifier=k;b.start=m.start;b.fingers=c.fingers;if(c.position==="differenceFromLast"){b.x=(m.pageX-m.offsetX);b.y=(m.pageY-m.offsetY);m.offsetX=m.pageX;m.offsetY=m.pageY}else{b.x=(m.pageX-m.offsetX);b.y=(m.pageY-m.offsetY)}c.listener(e,b)}};c.onPointerUp=function(d){if(a.pointerEnd(d,b,c,c.onPointerMove)){if(!c.monitor){eventjs.remove(c.doc,"mousemove",c.onPointerMove);eventjs.remove(c.doc,"mouseup",c.onPointerUp)}}};var b=a.pointerSetup(c);if(c.event){c.onPointerDown(c.event)}else{eventjs.add(c.target,"mousedown",c.onPointerDown);if(c.monitor){eventjs.add(c.doc,"mousemove",c.onPointerMove);eventjs.add(c.doc,"mouseup",c.onPointerUp)}}return b};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.drag=a.drag;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(b){var c=Math.PI/180;var a=function(g,h){var f=0;var e=0;var i=0;for(var d in h){var j=h[d];if(j.up){continue}f+=j.move.x;e+=j.move.y;i++}g.x=f/=i;g.y=e/=i;return g};b.gesture=function(e){e.gesture=e.gesture||"gesture";e.minFingers=e.minFingers||e.fingers||2;e.onPointerDown=function(i){var g=e.fingers;if(b.pointerStart(i,d,e)){eventjs.add(e.doc,"mousemove",e.onPointerMove);eventjs.add(e.doc,"mouseup",e.onPointerUp)}if(e.fingers===e.minFingers&&g!==e.fingers){d.fingers=e.minFingers;d.scale=1;d.rotation=0;d.state="start";var f="";for(var h in e.tracker){f+=h}d.identifier=parseInt(f);a(d,e.tracker);e.listener(i,d)}};e.onPointerMove=function(s,l){var f=e.bbox;var u=e.tracker;var p=s.changedTouches||b.getCoords(s);var g=p.length;for(var v=0;v<g;v++){var m=p[v];var j=m.identifier||Infinity;var q=u[j];if(!q){continue}q.move.x=(m.pageX-f.x1);q.move.y=(m.pageY-f.y1)}if(e.fingers<e.minFingers){return}var p=[];var x=0;var r=0;a(d,u);for(var j in u){var m=u[j];if(m.up){continue}var k=m.start;if(!k.distance){var o=k.x-d.x;var n=k.y-d.y;k.distance=Math.sqrt(o*o+n*n);k.angle=Math.atan2(o,n)/c}var o=m.move.x-d.x;var n=m.move.y-d.y;var h=Math.sqrt(o*o+n*n);x+=h/k.distance;var w=Math.atan2(o,n)/c;var t=(k.angle-w+360)%360-180;m.DEG2=m.DEG1;m.DEG1=t>0?t:-t;if(typeof(m.DEG2)!=="undefined"){if(t>0){m.rotation+=m.DEG1-m.DEG2}else{m.rotation-=m.DEG1-m.DEG2}r+=m.rotation}p.push(m.move)}d.touches=p;d.fingers=e.fingers;d.scale=x/e.fingers;d.rotation=r/e.fingers;d.state="change";e.listener(s,d)};e.onPointerUp=function(g){var f=e.fingers;if(b.pointerEnd(g,d,e)){eventjs.remove(e.doc,"mousemove",e.onPointerMove);eventjs.remove(e.doc,"mouseup",e.onPointerUp)}if(f===e.minFingers&&e.fingers<e.minFingers){d.fingers=e.fingers;d.state="end";e.listener(g,d)}};var d=b.pointerSetup(e);eventjs.add(e.target,"mousedown",e.onPointerDown);return d};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.gesture=b.gesture;return b})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.pointerdown=a.pointermove=a.pointerup=function(d){d.gesture=d.gesture||"pointer";if(d.target.isPointerEmitter){return}var b=true;d.onPointerDown=function(e){b=false;c.gesture="pointerdown";d.listener(e,c)};d.onPointerMove=function(e){c.gesture="pointermove";d.listener(e,c,b)};d.onPointerUp=function(e){b=true;c.gesture="pointerup";d.listener(e,c,true)};var c=a.pointerSetup(d);eventjs.add(d.target,"mousedown",d.onPointerDown);eventjs.add(d.target,"mousemove",d.onPointerMove);eventjs.add(d.doc,"mouseup",d.onPointerUp);d.target.isPointerEmitter=true;return c};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.pointerdown=a.pointerdown;eventjs.Gesture._gestureHandlers.pointermove=a.pointermove;eventjs.Gesture._gestureHandlers.pointerup=a.pointerup;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.shake=function(f){var k={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:f.target,listener:f.listener,remove:function(){window.removeEventListener("devicemotion",e,false)}};var d=4;var g=1000;var h=200;var b=3;var c=(new Date()).getTime();var j={x:0,y:0,z:0};var i={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}};var e=function(w){var s=0.8;var m=w.accelerationIncludingGravity;j.x=s*j.x+(1-s)*m.x;j.y=s*j.y+(1-s)*m.y;j.z=s*j.z+(1-s)*m.z;k.accelerationIncludingGravity=j;k.acceleration.x=m.x-j.x;k.acceleration.y=m.y-j.y;k.acceleration.z=m.z-j.z;if(f.gesture==="devicemotion"){f.listener(w,k);return}var t="xyz";var l=(new Date()).getTime();for(var q=0,p=t.length;q<p;q++){var r=t[q];var v=k.acceleration[r];var u=i[r];var z=Math.abs(v);if(l-c<g){continue}if(z>d){var y=l*v/z;var x=Math.abs(y+u.value);if(u.value&&x<h){u.value=y;u.count++;if(u.count===b){f.listener(w,k);c=l;u.value=0;u.count=0}}else{u.value=y;u.count=1}}}};if(!window.addEventListener){return}window.addEventListener("devicemotion",e,false);return k};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.shake=a.shake;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){var b=Math.PI/180;a.swipe=function(d){d.snap=d.snap||90;d.threshold=d.threshold||1;d.gesture=d.gesture||"swipe";d.onPointerDown=function(e){if(a.pointerStart(e,c,d)){eventjs.add(d.doc,"mousemove",d.onPointerMove).listener(e);eventjs.add(d.doc,"mouseup",d.onPointerUp)}};d.onPointerMove=function(h){var j=h.changedTouches||a.getCoords(h);var g=j.length;for(var f=0;f<g;f++){var l=j[f];var e=l.identifier||Infinity;var k=d.tracker[e];if(!k){continue}k.move.x=l.pageX;k.move.y=l.pageY;k.moveTime=(new Date()).getTime()}};d.onPointerUp=function(g){if(a.pointerEnd(g,c,d)){eventjs.remove(d.doc,"mousemove",d.onPointerMove);eventjs.remove(d.doc,"mouseup",d.onPointerUp);var r;var q;var m;var j;var i={x:0,y:0};var t=0;var s=0;var l=0;for(var h in d.tracker){var p=d.tracker[h];var n=p.move.x-p.start.x;var k=p.move.y-p.start.y;t+=p.move.x;s+=p.move.y;i.x+=p.start.x;i.y+=p.start.y;l++;var f=Math.sqrt(n*n+k*k);var e=p.moveTime-p.startTime;var j=Math.atan2(n,k)/b+180;var q=e?f/e:0;if(typeof(m)==="undefined"){m=j;r=q}else{if(Math.abs(j-m)<=20){m=(m+j)/2;r=(r+q)/2}else{return}}}var o=d.gestureFingers;if(d.minFingers<=o&&d.maxFingers>=o){if(r>d.threshold){i.x/=l;i.y/=l;c.start=i;c.x=t/l;c.y=s/l;c.angle=-((((m/d.snap+0.5)>>0)*d.snap||360)-360);c.velocity=r;c.fingers=o;c.state="swipe";d.listener(g,c)}}}};var c=a.pointerSetup(d);eventjs.add(d.target,"mousedown",d.onPointerDown);return c};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.swipe=a.swipe;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.longpress=function(b){b.gesture="longpress";return a.tap(b)};a.tap=function(c){c.delay=c.delay||500;c.timeout=c.timeout||250;c.driftDeviance=c.driftDeviance||10;c.gesture=c.gesture||"tap";var e,d;c.onPointerDown=function(f){if(a.pointerStart(f,b,c)){e=(new Date()).getTime();eventjs.add(c.doc,"mousemove",c.onPointerMove).listener(f);eventjs.add(c.doc,"mouseup",c.onPointerUp);if(c.gesture!=="longpress"){return}d=setTimeout(function(){if(f.cancelBubble&&++f.cancelBubbleCount>1){return}var h=0;for(var i in c.tracker){var g=c.tracker[i];if(g.end===true){return}if(c.cancel){return}h++}if(c.minFingers<=h&&c.maxFingers>=h){b.state="start";b.fingers=h;b.x=g.start.x;b.y=g.start.y;c.listener(f,b)}},c.delay)}};c.onPointerMove=function(g){var p=c.bbox;var l=g.changedTouches||a.getCoords(g);var h=l.length;for(var k=0;k<h;k++){var j=l[k];var m=j.identifier||Infinity;var s=c.tracker[m];if(!s){continue}var o=(j.pageX-p.x1);var n=(j.pageY-p.y1);var r=o-s.start.x;var q=n-s.start.y;var f=Math.sqrt(r*r+q*q);if(!(o>0&&o<p.width&&n>0&&n<p.height&&f<=c.driftDeviance)){eventjs.remove(c.doc,"mousemove",c.onPointerMove);c.cancel=true;return}}};c.onPointerUp=function(g){if(a.pointerEnd(g,b,c)){clearTimeout(d);eventjs.remove(c.doc,"mousemove",c.onPointerMove);eventjs.remove(c.doc,"mouseup",c.onPointerUp);if(g.cancelBubble&&++g.cancelBubbleCount>1){return}if(c.gesture==="longpress"){if(b.state==="start"){b.state="end";c.listener(g,b)}return}if(c.cancel){return}if((new Date()).getTime()-e>c.timeout){return}var f=c.gestureFingers;if(c.minFingers<=f&&c.maxFingers>=f){b.state="tap";b.fingers=c.gestureFingers;c.listener(g,b)}}};var b=a.pointerSetup(c);eventjs.add(c.target,"mousedown",c.onPointerDown);return b};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.tap=a.tap;eventjs.Gesture._gestureHandlers.longpress=a.longpress;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.wheelPreventElasticBounce=function(b){if(!b){return}if(typeof(b)==="string"){b=document.querySelector(b)}eventjs.add(b,"wheel",function(d,c){c.preventElasticBounce();eventjs.stop(d)})};a.wheel=function(f){var c;var h=f.timeout||150;var e=0;var j={gesture:"wheel",state:"start",wheelDelta:0,target:f.target,listener:f.listener,preventElasticBounce:function(l){var o=this.target;var n=o.scrollTop;var m=n+o.offsetHeight;var k=o.scrollHeight;if(m===k&&this.wheelDelta<=0){eventjs.cancel(l)}else{if(n===0&&this.wheelDelta>=0){eventjs.cancel(l)}}eventjs.stop(l)},add:function(){f.target[i](g,b,false)},remove:function(){f.target[d](g,b,false)}};var b=function(k){k=k||window.event;j.state=e++?"change":"start";j.wheelDelta=k.detail?k.detail*-20:k.wheelDelta;f.listener(k,j);clearTimeout(c);c=setTimeout(function(){e=0;j.state="end";j.wheelDelta=0;f.listener(k,j)},h)};var i=document.addEventListener?"addEventListener":"attachEvent";var d=document.removeEventListener?"removeEventListener":"detachEvent";var g=eventjs.getEventSupport("mousewheel")?"mousewheel":"DOMMouseScroll";f.target[i](g,b,false);return j};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.wheel=a.wheel;return a})(eventjs.proxy);if(typeof(Event)==="undefined"){var Event={}}if(typeof(Event.proxy)==="undefined"){Event.proxy={}}Event.proxy=(function(a){a.orientation=function(c){var b={gesture:"orientationchange",previous:null,current:window.orientation,target:c.target,listener:c.listener,remove:function(){window.removeEventListener("orientationchange",d,false)}};var d=function(f){b.previous=b.current;b.current=window.orientation;if(b.previous!==null&&b.previous!=b.current){c.listener(f,b);return}};if(window.DeviceOrientationEvent){window.addEventListener("orientationchange",d,false)}return b};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.orientation=a.orientation;return a})(Event.proxy);(function(b){var o=Math.sqrt,p=Math.atan2,g=Math.pow,d=Math.PI/180,m=Math.PI/2;var q=/\{ *([\w_ -]+) *\}/g;var a=0;function f(r){return window["webkit"+r]||window["moz"+r]||window["ms"+r]}function h(s,t){var u=Array.prototype.slice;if(s.bind){return s.bind.apply(s,u.call(arguments,1))}var r=u.call(arguments,2);return function(){return s.apply(t,r.length?r.concat(u.call(arguments)):arguments)}}function l(r){var t=+new Date(),s=Math.max(0,16-(t-a));a=t+s;return window.setTimeout(r,s)}var k=window.requestAnimationFrame||f("RequestAnimationFrame")||l;var n=window.cancelAnimationFrame||f("CancelAnimationFrame")||f("CancelRequestAnimationFrame")||function(r){window.clearTimeout(r)};function j(t,s,r){if(r&&k===l){t.call(s)}else{return k.call(window,h(t,s))}}function c(r){if(r){n.call(window,r)}}function e(r){r=r.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+r+"=([^&#]*)"),s=t.exec(window.location.search);return s==null?"":decodeURIComponent(s[1].replace(/\+/g," "))}function i(A){if(A&&A.length>0){var C=A[0][0],B=A[0][1],v=C,u=B;for(var s=0,r=A.length;s<r;s++){var t=A[s];C=Math.min(C,t[0]);v=Math.max(v,t[0]);B=Math.min(B,t[1]);u=Math.max(u,t[1])}var z=(C+v)/2,w=(B+u)/2;return[z,w]}return null}geomap.util={formatNum:function(r,t){var s=Math.pow(10,(t===undefined?6:t));return Math.round(r*s)/s},isArray:Array.isArray||function(r){return(Object.prototype.toString.call(r)==="[object Array]")},template:function(s,r){return s.replace(q,function(v,t){var u=r[t];if(u===undefined){u="{"+t+"}"}else{if(typeof u==="function"){u=u(r)}}return u})},requestAnimFrame:j,cancelAnimFrame:c,getUrlParam:e,coordCenter:i}})(typeof exports!=="undefined"?exports:this);(function(){var f=Array.prototype.slice;function b(m,l){var j=f.call(arguments,2),h=[];for(var k=0,g=m.length;k<g;k++){h[k]=j.length?m[k][l].apply(m[k],j):m[k][l].call(m[k])}return h}function a(h,g){return e(h,g,function(j,i){return j>=i})}function c(h,g){return e(h,g,function(j,i){return j<i})}function d(i,h){var g=i.length;while(g--){i[g]=h}return i}function e(l,j,k){if(!l||l.length===0){return}var h=l.length-1,g=j?l[h][j]:l[h];if(j){while(h--){if(k(l[h][j],g)){g=l[h][j]}}}else{while(h--){if(k(l[h],g)){g=l[h]}}}return g}geomap.util.array={fill:d,invoke:b,min:c,max:a}})();(function(){function d(f,g){if(!this.__eventListeners[f]){return}var e=this.__eventListeners[f];if(g){e[e.indexOf(g)]=false}else{geomap.util.array.fill(e,false)}}function a(e,f){if(!this.__eventListeners){this.__eventListeners={}}if(arguments.length===1){for(var g in e){this.on(g,e[g])}}else{if(!this.__eventListeners[e]){this.__eventListeners[e]=[]}this.__eventListeners[e].push(f)}return this}function c(e,f){if(!this.__eventListeners){return this}if(arguments.length===0){for(e in this.__eventListeners){d.call(this,e)}}else{if(arguments.length===1&&typeof arguments[0]==="object"){for(var g in e){d.call(this,g,e[g])}}else{d.call(this,e,f)}}return this}function b(g,h){if(!this.__eventListeners){return this}var f=this.__eventListeners[g];if(!f){return this}for(var j=0,e=f.length;j<e;j++){f[j]&&f[j].call(this,h||{})}this.__eventListeners[g]=f.filter(function(i){return i!==false});return this}geomap.Observable={fire:b,on:a,off:c,}})();geomap.CommonMethods={_setOptions:function(a){for(var b in a){this.set(b,a[b])}},_setObject:function(a){for(var b in a){this._set(b,a[b])}},set:function(a,b){if(typeof a==="object"){this._setObject(a)}else{this._set(a,b)}return this},_set:function(a,b){this[a]=b},toggle:function(b){var a=this.get(b);if(typeof a==="boolean"){this.set(b,!a)}return this},get:function(a){return this[a]}};(function(){function b(d,h,e){if(e){if(!geomap.isLikelyNode&&h instanceof Element){d=h}else{if(h instanceof Array){d=[];for(var f=0,c=h.length;f<c;f++){d[f]=b({},h[f],e)}}else{if(h&&typeof h==="object"){for(var g in h){if(g==="canvas"||g==="group"){d[g]=null}else{if(h.hasOwnProperty(g)){d[g]=b({},h[g],e)}}}}else{d=h}}}}else{for(var g in h){d[g]=h[g]}}return d}function a(d,c){return b({},d,c)}geomap.util.object={extend:b,clone:a};geomap.util.object.extend(geomap.util,geomap.Observable)})();(function(){function b(j,k,m){k||(k={});m||(m={});var l=geomap.document.createElement(j);f(l,k);d(l,m);return l}function d(k,j){for(var l in j){k.style[l]=j[l]}}function f(k,j){for(var l in j){k[l]=j[l]}}function g(k,j,n,m){var l=(function(){var r=document.createElement("canvas"),o=r.getContext("2d"),p=window.devicePixelRatio||1,q=o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1;return p/q})();if(!m){m=l}k.width=j*m;k.height=n*m;k.style.width=j+"px";k.style.height=n+"px";k.getContext("2d").setTransform(m,0,0,m,0,0);return k}function a(k,j){j=j||"";if(j.replace(/\s/g,"").length==0){return false}return new RegExp(" "+j+" ").test(" "+k.className+" ")}function e(k,j){if(!a(k,j)){k.className+=" "+j}}function h(k,j){if(a(k,j)){var l=" "+k.className.replace(/[\t\r\n]/g,"")+" ";while(l.indexOf(" "+j+" ")>=0){l=l.replace(" "+j+" "," ")}k.className=l.replace(/^\s+|\s+$/g,"")}}function i(j){var s=new Object();var n=j.getElementsByTagName("input");for(var o=0;o<n.length;o++){var m=n[o];var r=m.name;var q="";if(m.type==="radio"){if(s[r]===undefined){s[r]=""}if(m.checked){q=m.value;s[r]=q}}else{if(m.type==="checkbox"){if(s[r]===undefined){s[r]=[]}if(m.checked){q=m.value;s[r].push(q)}}else{if(m.type!="button"&&m.type!="submit"){q=m.value;s[r]=q}}}}var k=j.getElementsByTagName("select");for(var o=0;o<k.length;o++){var m=k[o];var r=m.name;var l=m.selectedIndex;q=m.options[l].value;s[r]=q}var p=j.getElementsByTagName("textarea");for(var o=0;o<p.length;o++){var m=p[o];s[m.name]=m.value}return s}function c(l){var D=l.id||("form_"+new Date());var v=geomap.element.create("form",{id:D},{marginTop:"10px"});if(l.properties){var C={height:"30px"};for(var x=0,y=l.properties.length;x<y;x++){var q=l.properties[x];if(q.type==="text"){var u=geomap.element.create("div",{},C);var E=geomap.element.create("span",{},{minWidth:"100px",display:"inline-block",textAlign:"right"});E.innerText=q.title;var r=geomap.element.create("input",{type:"text",name:q.id});r.value=q.value;u.appendChild(E);u.appendChild(r);v.appendChild(u)}else{if(q.type==="hidden"){var r=geomap.element.create("input",{type:"hidden",name:q.id});r.value=q.value;v.appendChild(r)}else{if(q.type==="radio"||q.type==="checkbox"){var u=geomap.element.create("div",{},C);var E=geomap.element.create("span",{},{minWidth:"100px",display:"inline-block",textAlign:"right"});E.innerText=q.title;u.appendChild(E);for(var t in q.option){var p=geomap.element.create("label");var s=geomap.element.create("input",{type:q.type,name:q.id});s.value=t;var A=geomap.element.create("a");A.innerText=q.option[t];p.appendChild(s);p.appendChild(A);u.appendChild(p);if(q.value===t){s.checked=true}}v.appendChild(u)}else{if(q.type==="select"){var u=geomap.element.create("div",{},C);var E=geomap.element.create("span",{},{minWidth:"100px",display:"inline-block",textAlign:"right"});E.innerText=q.title;var n=geomap.element.create("select",{name:q.id});for(var t in q.option){var B=geomap.element.create("option",{type:"checkbox",name:q.id});B.value=t;B.innerText=q.option[t];n.appendChild(B);if(q.value===q.option[t]){s.selected=true}}u.appendChild(E);u.appendChild(n);v.appendChild(u)}else{if(q.type==="button"){var u=geomap.element.create("div",{},C);var E=geomap.element.create("span",{},{minWidth:"100px",display:"inline-block",textAlign:"right"});E.innerHTML="&nbsp;";u.appendChild(E);var o=geomap.element.create("input",{type:"button",className:"btn",name:q.id});o.value=q.value;u.appendChild(o);v.appendChild(u);if(q.click){eventjs.add(o,"click",q.click)}}else{if(q.type==="buttons"){var u=geomap.element.create("div",{},C);var E=geomap.element.create("span",{},{minWidth:"100px",display:"inline-block",textAlign:"right"});E.innerHTML="&nbsp;";u.appendChild(E);for(var z=0,w=q.group.length;z<w;z++){var m=q.group[z];var o=geomap.element.create("input",{type:"button",className:"btn",name:m.id});o.value=m.value;u.appendChild(o);if(m.click){eventjs.add(o,"click",m.click)}}v.appendChild(u)}}}}}}}}if(l.buttons){var u=geomap.element.create("div",{},C);var E=geomap.element.create("span",{},{minWidth:"100px",display:"inline-block",textAlign:"right"});E.innerHTML="&nbsp;";u.appendChild(E);for(var z=0,w=l.buttons.length;z<w;z++){var m=l.buttons[z];var o=geomap.element.create("input",{type:"button",className:"btn",name:m.id});o.value=m.value;u.appendChild(o);if(m.click){eventjs.add(o,"click",m.click)}}v.appendChild(u)}return v}geomap.element={create:b,setStyle:d,setOptions:f,hasClass:a,addClass:e,removeClass:h,formToJson:i,parseToForm:c,createHiDPICanvas:g}})();(function(){geomap.util.event={_ev_xy_now:[0,0],_ev_xy_last:[0,0],_ev_smooth:[[0,0]],_ev_speed:[0,0],_ev_inertance:-1,_ev_speed_down:0.9,speedStart:function(a,c){this._ev_inertance=1;this._ev_speed=[0,0];this._ev_xy_last=[a,c];var b=[0,0];this._ev_smooth=[b,b,b,b,b,b,b,b,b,b,b,b]},speedEnd:function(){this._ev_inertance=-1},moving:function(a,b){this._ev_xy_now=[a,b]},speeding:function(){if(this._ev_inertance==1){var f=geomap.util.matrixSubtract(this._ev_xy_now,this._ev_xy_last);this._ev_smooth.push(f);this._ev_smooth.shift();var c=[0,0];var e=this._ev_smooth;var b=e.length;for(var d=0;d<b;d++){c=geomap.util.matrixAdd(c,e[d])}c[0]=c[0]/b;c[1]=c[1]/b;this._ev_speed=[Math.round(c[0]),Math.round(c[1])];this._ev_xy_last=this._ev_xy_now}else{var e=this._ev_speed,a=this._ev_speed_down;e=geomap.util.matrixMultiply(e,[a,a]);this._ev_speed=geomap.util.posFloor(e)}return this._ev_speed}}})();(function(){var g=Array.prototype.slice,f=function(){},d=(function(){for(var h in {toString:1}){if(h==="toString"){return false}}return true})(),c=function(h,k,i){for(var j in k){if(j in h.prototype&&typeof h.prototype[j]==="function"&&(k[j]+"").indexOf("callSuper")>-1){h.prototype[j]=(function(l){return function(){var n=this.constructor.superclass;this.constructor.superclass=i;var m=k[l].apply(this,arguments);this.constructor.superclass=n;if(l!=="initialize"){return m}}})(j)}else{h.prototype[j]=k[j]}if(d){if(k.toString!==Object.prototype.toString){h.prototype.toString=k.toString}if(k.valueOf!==Object.prototype.valueOf){h.prototype.valueOf=k.valueOf}}}};function b(){}function a(h){var i=null,k=this;while(k.constructor.superclass){var j=k.constructor.superclass.prototype[h];if(k[h]!==j){i=j;break}k=k.constructor.superclass.prototype}if(!i){return console.log("tried to callSuper "+h+", method not found in prototype chain",this)}return(arguments.length>1)?i.apply(this,g.call(arguments,1)):i.call(this)}function e(){var l=null,k=g.call(arguments,0);if(typeof k[0]==="function"){l=k.shift()}function h(){this.initialize.apply(this,arguments)}h.superclass=l;h.subclasses=[];if(l){b.prototype=l.prototype;h.prototype=new b();l.subclasses.push(h)}for(var j=0,m=k.length;j<m;j++){c(h,k[j],l)}if(!h.prototype.initialize){h.prototype.initialize=f}h.prototype.constructor=h;h.prototype.callSuper=a;return h}geomap.Class=e})();(function(a){if(!a.geomap){a.geomap={}}if(a.geomap.DBStore){geomap.warn("geomap.Image is already defined.");return}geomap.DBStore=geomap.Class(geomap.CommonMethods,geomap.Observable,{type:"DBStore",indexedDB:null,dbVersion:1,dbFile:"geomapFile",dbRequest:null,db:null,openSuccess:false,openError:false,dbInitStatus:false,dbNames:["geomap"],initialize:function(c){c||(c={});this._setOptions(c);var b=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB;this.indexedDB=b;this.openStore()},createStore:function(f){console.log("Creating objectStore");var c=f.target.result;for(var d=0,b=this.dbNames.length;d<b;d++){var e=this.dbNames[d];if(!c.objectStoreNames.contains(e)){c.createObjectStore(e)}}this.dbInitStatus=true},openStore:function(){var b=this.indexedDB.open(this.dbFile,this.dbVersion);this.dbRequest=b;b.onerror=this.openStoreError.bind(this);b.onsuccess=this.openStoreSuccess.bind(this);b.onupgradeneeded=this.createStore.bind(this)},openStoreError:function(c){console.log("Error creating/accessing IndexedDB database");this.openError=true;this.dbInitStatus=true;var b=this;this.fire("open_error",b)},openStoreSuccess:function(f){console.log("Success creating/accessing IndexedDB database");this.openSuccess=true;var e=this.dbRequest;var c=e.result;this.db=c;c.onerror=function(g){console.log("Error creating/accessing IndexedDB database")};if(c.setVersion){if(c.version!=dbVersion){var b=c.setVersion(dbVersion);b.onsuccess=this.createStore.bind(this)}else{this.dbInitStatus=true}}else{this.dbInitStatus=true}var d=this;this.fire("open_success",d)},clearData:function(d){if(this.openSuccess){var f=this.db.transaction(d,"readwrite");var e=f.objectStore(d);var b=e.clear();var c=this;b.onsuccess=function(g){c.fire("clear_success",c);geomap.log("表名["+d+"]数据清理成功")}}},deleteDb:function(b){this.indexedDB.deleteDatabase(b)},putStore:function(c,b,d){if(this.openSuccess){try{var h=this.db.transaction(c,"readwrite");var g=h.objectStore(c);g.put(d,b);return true}catch(f){geomap.log("保存数据库失败");geomap.warn(f);return false}}return false},getStore:function(c,b){if(this.openSuccess){try{var g=this.db.transaction(c,"readwrite");var f=g.objectStore(c);return new Promise(function(h,e){f.get(b).onsuccess=h})}catch(d){geomap.log("获取数据库数据失败");geomap.warn(d)}}return null}});geomap.GlobalDBStore=function(b,g,c){if(g==undefined){g="geomap"}if(c==undefined){c=1}if(!geomap._GLOBAL_DB_STORE){geomap._GLOBAL_DB_STORE={}}var d=g;if(!geomap._GLOBAL_DB_STORE[d]){var f=new geomap.DBStore({dbNames:b,dbFile:g,dbVersion:c});var e={dbStore:f,open:false};geomap._GLOBAL_DB_STORE[d]=e;f.on("open_success",function(){e.open=true})}return geomap._GLOBAL_DB_STORE[d]}})(typeof exports!=="undefined"?exports:this);(function(){geomap.PosAnimation=geomap.Class(geomap.CommonMethods,geomap.Observable,{easeLinearity:0.5,initialize:function(a){a||(a={});this.fnContext=this;this._setOptions(a)},run:function(c,e,d,b,a){this.stop();this._callback=e;this._callbackContext=a||this;this._inProgress=true;this._duration=b||0.25;this._easeOutPower=1/Math.max(this.easeLinearity,0.2);this._pos=d;this._startPos=d[0];this._offset=d[1].subtract(this._startPos);this._startTime=+new Date();this.fire("start");this._animate();this.loopTarget=c;this._timerId=this._animate.bind(this);this.loopTarget.on("looptime",this._timerId)},stop:function(){if(!this._inProgress){return}this._step(true);this._complete()},_animate:function(){this._step()},_step:function(b){var a=(+new Date())-this._startTime,c=this._duration*1000;if(a<c){this._runFrame(this._easeOut(a/c),b)}else{this._runFrame(1);this._complete()}},_runFrame:function(c,b){var a=this._offset.multiplyBy(c);var f=this._startPos.add(a);if(b){f._round()}var d={animationTarget:this,step:a,offset:this._offset,progress:c,pos:this._pos};this._callback.call(this._callbackContext,f,d);this.fire("step")},_complete:function(){this.loopTarget.off("looptime",this._timerId);this._inProgress=false;this.fire("end")},_easeOut:function(a){return 1-Math.pow(1-a,this._easeOutPower)}})})();(function(b){var c=geomap.util.object.extend;if(!b.geomap){b.geomap={}}if(b.geomap.Image){geomap.warn("geomap.Image is already defined.");return}var a={cacheImage:function(d){if(!this.__cache_imgs){this.__cache_imgs={}}var e=d.src;this.__cache_imgs[e]=d;return d},getCache:function(d){if(!this.__cache_imgs){return null}if(this.__cache_imgs[d]){return this.__cache_imgs[d]}return null},hasKey:function(d){if(!this.__load_img_key){this.__load_img_key={};this.__load_img_key[d]=1;return false}if(this.__load_img_key[d]){this.__load_img_key[d]=this.__load_img_key[d]+1;return true}else{this.__load_img_key[d]=1;return false}}};geomap.Image=geomap.Class(geomap.CommonMethods,geomap.Observable,{type:"image",x:0,y:0,z:0,left:0,top:0,cacheTime:0,lockKey:1,tileKey:null,tableKey:null,image:null,loaded:false,ctx:undefined,tag:0,tileSize:256,headers:{},useCache:false,dbName:"tile",dbFile:"geomap",dbStore:undefined,layer:null,initialize:function(d){d||(d={});this._setOptions(d);this.image=window.document.createElement("img");this._onloadHandle=this.onLoad.bind(this);this.image.onload=this._onloadHandle;this.getDBStore()},isTile:function(d){return(d.x===this.x&&d.y===this.y&&d.z===this.z&&d.cacheTime==this.cacheTime)},getTileUrl:function(d,e){var f=geomap.util.template(d+(/\?/.test(d)?"&":"?")+"cacheTime={cacheTime}",e);return f},loadTile:function(d,f){this._setOptions(f);var e=this.getTileUrl(d,f);if(this.getSrc()===e){this.drawCanvas()}else{this.setSrc(e)}},drawCanvas:function(){if(this.loaded&&this.ctx!=undefined){if(this.layer&&this.layer._drawLock==this.lockKey){this.ctx.drawImage(this.image,this.left,this.top);var d=this;this.fire("drawend",this)}}},draw:function(e){if(this.loaded){e.drawImage(this.image,this.x,this.y);if(this.drawCallback){var d=this;this.drawCallback(d)}}},onLoad:function(d){this.loaded=true;this.drawCanvas();this.fire("onload")},getDBStore:function(){if(!this.dbStore){var d=geomap.GlobalDBStore([this.dbName],this.dbFile);if(d.open){this.useCache=true}else{var e=this;d.dbStore.on("open_success",function(f){d.dbStore.clearData(e.dbName);e.useCache=true})}this.dbStore=d.dbStore}return this.dbStore},saveCache:function(e,d){if(this.useCache){this.dbStore.putStore(this.dbName,e,d)}},setSrc:function(g){this.loaded=false;this.imgSrc=g;var f=this.image;var d=this;if(this.useCache){var e=this.dbStore.getStore(this.dbName,g);if(e!=null){e.then(function(j){var i=j.target.result;if(i!=undefined){var h=window.URL.createObjectURL(i);f.src=h}else{d.reqImageData(g).then(function(k){if(k!=undefined&&k!=""){var l=window.URL.createObjectURL(k);f.src=l;d.saveCache(g,k)}})}})}else{this.reqImageData(g).then(function(h){var i=window.URL.createObjectURL(h);f.src=i})}}else{this.reqImageData(g).then(function(h){var i=window.URL.createObjectURL(h);f.src=i})}},getSrc:function(){return this.imgSrc},reqImageData:function(d){var e=this.headers;return new Promise(function(i,h){var g=new XMLHttpRequest();g.open("GET",d);g.responseType="blob";g.onload=function(){if(g.status===200){i(g.response)}else{h(Error("Image didn't load successfully; error code:"+g.statusText))}};g.onerror=function(){h(Error("There was a network error."))};for(var f in e){g.setRequestHeader(f,e[f])}g.send()})},fromURL:function(e,d,f){if(d!=undefined&&f!=undefined){this.x=d;this.y=f}if(this.loaded&&this.image.src===e){this.onLoad(this.image)}else{this.image.src=e}}})})(typeof exports!=="undefined"?exports:this);(function(){function c(d,e){return d+(/\?/.test(d)?"&":"?")+e}function a(){}function b(e,l){l||(l={});var d=l.method?l.method.toUpperCase():"GET",g=l.onComplete||function(){},k=new geomap.window.XMLHttpRequest(),h=l.body||l.parameters,j=(l.contentType===undefined)?"application/x-www-form-urlencoded":l.contentType,f=l.header||{};k.onreadystatechange=function(){if(k.readyState===4){g(k);k.onreadystatechange=a}};if(d==="GET"){h=null;if(typeof l.parameters==="string"){e=c(e,l.parameters)}}if(d==="JSON"){k.open("POST",e,true)}else{k.open(d,e,true)}for(var i in f){k.setRequestHeader(i,f[i])}if(d==="JSON"){k.setRequestHeader("Content-Type","application/json;charset=UTF-8")}else{if(d!="GET"){if(j&&j.length>0){k.setRequestHeader("Content-Type",j)}}}if(h!=undefined&&d==="JSON"&&h!=null){k.send(JSON.stringify(h))}else{k.send(h)}return k}geomap.request=b})();(function(){function f(g,h){if(typeof g=="string"){g=Number(g)}if(typeof h=="string"){h=Number(h)}this.x=g;this.y=h}var e=Math.trunc||function(g){return g>0?Math.floor(g):Math.ceil(g)};f.prototype={clone:function(){return new f(this.x,this.y)},zero:function(){this.x=0;this.y=0;return this},add:function(g){return this.clone()._add(g)},_add:function(g){this.x+=g.x;this.y+=g.y;return this},subtract:function(g){return this.clone()._subtract(g)},_subtract:function(g){this.x-=g.x;this.y-=g.y;return this},divideBy:function(g){return this.clone()._divideBy(g)},_divideBy:function(g){this.x/=g;this.y/=g;return this},multiplyBy:function(g){return this.clone()._multiplyBy(g)},_multiplyBy:function(g){this.x*=g;this.y*=g;return this},scaleBy:function(g){return this.clone()._scaleBy(g)},_scaleBy:function(g){this.x*=g.x;this.y*=g.y;return this},unscaleBy:function(g){return this.clone()._unscaleBy(g)},_unscaleBy:function(g){this.x=this.x/g.x;this.y=this.y/g.y;return this},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},floor:function(){return this.clone()._floor()},_floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){return this.clone()._ceil()},_ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},trunc:function(){return this.clone()._trunc()},_trunc:function(){this.x=e(this.x);this.y=e(this.y);return this},distanceTo:function(h){var g=h.x-this.x,i=h.y-this.y;return Math.sqrt(g*g+i*i)},equals:function(g){g=d(g);return g.x===this.x&&g.y===this.y},toString:function(){return"POINT("+this.x+" "+this.y+")"}};function d(g,h){if(g instanceof f){return g}if(geomap.util.isArray(g)){return new f(g[0],g[1])}if(typeof g==="object"&&"x" in g&&"y" in g){return new f(g.x,g.y)}return new f(g,h)}function b(g){if(g instanceof f){return true}return false}function a(g){return(g.x==0&&g.y==0)}function c(g){if(!g){return false}if(b(g)){return true}if(typeof g==="object"&&"x" in g&&"y" in g){return true}return false}geomap.Point=f;geomap.util.toPoint=d;geomap.util.isPoint=b;geomap.util.hasXY=c;geomap.util.isZeroPoint=a})();(function(){var b=geomap.Point;function a(f,e,h,g){this._a=f;this._b=e;this._c=h;this._d=g}a.prototype={setOrigin:function(c,e){this._b=c;this._d=e;return this},transform:function(c,d){return this._transform(c,d)},_transform:function(c,d){d=d||1;c.x=d*(this._a*c.x+this._b);c.y=d*(this._c*c.y+this._d);return c},untransform:function(c,d){d=d||1;return new b((c.x/d-this._b)/this._a,(c.y/d-this._d)/this._c)}};geomap.Transformtion=a})();(function(){var d=geomap.Point;function b(f){this._map=f}b.prototype={addEvent:function(f){eventjs.add(f,"gesture",this.handle.bind(this))},handle:function(g,f){eventjs.cancel(g);if(f.state=="start"){this._zooming=true;this._moved=false;this._zoom=this._map.zoom;return}else{if(f.state=="end"){this._map._touchZoomStatus=false;if(!this._moved||!this._zooming){this._zooming=false;return this}this._zooming=false;this._map.touchZoomEnd(g,this._centerPos,f.scale);return}else{if(!this._zooming){this._zooming=false;return this}if(!this._moved){var j=new d(f.touches[0].x,f.touches[0].y);var h=new d(f.touches[1].x,f.touches[1].y);var i=j.add(h)._divideBy(2);this._centerPos=i;this._map.touchZoomStart(g,this._centerPos);this._moved=true;return}this._map.touchZoom(g,this._centerPos,f.scale);return}}}};function a(f){this._map=f;this._inertia=true;this._inertia_speed=[0,0]}a.prototype={addEvent:function(f){eventjs.add(f,"drag gesture",this.handle.bind(this));if(this.dragingSpeedTimeId===undefined){this.dragingSpeedTimeId=this.dragingSpeed.bind(this);this._map.on("looptime",this.dragingSpeedTimeId)}},dragingSpeed:function(){if(this._drag_speed&&this._draging){var n=this._drag_nowpos[0]-this._drag_lastpos[0];var m=this._drag_nowpos[1]-this._drag_lastpos[1];this._drag_speed.push([n,m]);this._drag_speed.shift();var l=[0,0];var j=this._drag_speed.length;for(var g=0;g<j;g++){l[0]=l[0]+this._drag_speed[g][0];l[1]=l[1]+this._drag_speed[g][1]}var k=Math.round(l[0]/j);var h=Math.round(l[1]/j);this._inertia_speed=[k,h];this._drag_lastpos=this._drag_nowpos}else{var f=this._inertia_speed,o=f;if(Math.abs(o[0])<0){f[0]=0}if(Math.abs(o[1])<0){f[1]=0}f[0]=o[0]*0.97;f[1]=o[1]*0.97;this._inertia_speed=f}},handle:function(h,g){if(!g.fingers||g.fingers==1){eventjs.cancel(h);h.openInertia=this._inertia;if(g.state=="down"){this._draging=true;this._moved=false;if(this._inertia){var j=[0,0];this._drag_speed=[j,j,j,j,j,j,j,j];this._inertia_speed=[0,0];this._drag_lastpos=[g.x,g.y];this._drag_nowpos=[g.x,g.y]}return}else{if(g.state=="up"){if(!this._moved||!this._draging){this._draging=false;this._moved=false;return this}this._traging=false;var f=h;f.inertiaSpeed=this._inertia_speed;var i=new d(g.x,g.y);this._map.dragEnd(f,i);return this}else{if(!this._draging||this._map._touchZoomStatus){this._draging=false;return this}if(!this._moved){this._map.dragStart(h,new d(g.x,g.y));this._moved=true;return this}if(this._inertia){this._drag_nowpos=[g.x,g.y]}var i=new d(g.x,g.y);this._map.dragChange(h,i)}}}}};function e(f){this._map=f;this.wheelDebounceTime=40;this.wheelPxPerZoomLevel=60}function c(f){return navigator.userAgent.toLowerCase().indexOf(f)>=0}e.prototype={addEvent:function(f){eventjs.add(f,"wheel",this.handle.bind(this))},getWheelDelta:function(q){var g="ActiveXObject" in window;var k=g&&!document.addEventListener;var r=c("webkit");var l=c("android");var o=c("android 2")||c("android 3");var m=!!window.opera;var h=!n&&c("safari");var f=typeof orientation!=="undefined"||c("mobile");var j="msLaunchUri" in navigator&&!("documentMode" in document);var n=!j&&c("chrome");var p=navigator.platform.indexOf("Win")===0;var i=c("gecko")&&!r&&!m&&!g;var s=(p&&n)?2*window.devicePixelRatio:i?window.devicePixelRatio:1;return j?q.wheelDeltaY/2:(q.deltaY&&q.deltaMode===0)?-q.deltaY/s:(q.deltaY&&q.deltaMode===1)?-q.deltaY*20:(q.deltaY&&q.deltaMode===2)?-q.deltaY*60:(q.deltaX||q.deltaZ)?0:q.wheelDelta?(q.wheelDeltaY||q.wheelDelta)/2:(q.detail&&Math.abs(q.detail)<32765)?-q.detail*20:q.detail?q.detail/-32765*60:0},handle:function(h,g){eventjs.cancel(h);var i=g.wheelDelta;if(g.state=="start"){this._zooming=true;this._zooming_start=false}else{if(g.state=="end"){if(!this._zooming){this._zooming_start=false;this._zooming=false;return this}this._map.wheelZoomEnd(h,new d(h.offsetX,h.offsetY),i)}else{if(!this._zooming){return this}if(!this._zooming_start){this._zooming_start=true;this._map.wheelZoomStart(h,new d(h.offsetX,h.offsetY));return}var f=new d(h.offsetX,h.offsetY);this._map.wheelZoom(h,f,i)}}},_preformWheelZoom:function(g,f,h){this._map.wheelZoom(g,f,h)}};geomap.Event={TouchZoom:b,Drag:a,ScrollWheelZoom:e}})();(function(){var b=geomap.Point;function a(e,d){this.min=e;this.max=d}a.prototype={clone:function(){return new a(this.min.clone(),this.max.clone())},getCenter:function(){return new b((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2)},getBottomLeft:function(){return new b(this.min.x,this.max.y)},getTopRigth:function(){return new b(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(f){var e,d;f=geomap.util.toPoint(f);e=f.min;d=f.max;return(e.x>=this.min.x)&&(d.x<=this.max.x)&&(e.y>=this.min.y)&&(d.y<=this.max.y)},intersects:function(i){var g=this.min,d=this.max,h=i.min,e=i.max,f=(e.x>=g.x)&&(h.x<=d.y),j=(e.y>=g.y)&&(h.y<=d.y);return f&&j},overlaps:function(j){var g=this.min,d=this.max,i=j.min,e=j.max,h=(e.x>g.x)&&(i.x<d.y),f=(e.y>g.y)&&(i.y<d.y);return h&&f},toString:function(){return"Bounds("+this.min.x+","+this.min.y+","+this.max.x+","+this.max.y+")"}};function c(e,d,j,i){var f=geomap.util.isPoint,g=geomap.util.hasXY,h=geomap.util.toPoint;if(!e||e instanceof a){return e}if(d&&f(e)&&f(d)){return new a(e,d)}if(g(e)&&g(d)){return new a(h(e),h(d))}return new a(h(e,d),h(j,i))}geomap.Bounds=a;geomap.util.toBounds=c})();(function(a){if(!a.geomap){a.geomap={}}if(a.geomap.view){geomap.warn("geomap.Map is already defined.");return}geomap.view={}})(typeof exports!=="undefined"?exports:this);(function(){var b=geomap.util.object.extend;var a=geomap.Point;geomap.view.Frame=geomap.Class(geomap.CommonMethods,geomap.Observable,{type:"BaseFrame",container:undefined,headBar:undefined,bodyBar:undefined,rootFrame:undefined,closeBtn:undefined,x:0,y:0,w:200,h:120,pos:"center",posPad:10,headHeight:26,bodyheight:50,closeBtnSize:20,padding:4,title:"",body:undefined,radius:6,closeType:1,showBody:true,canHeadDblClick:true,boxShadow:"2px 2px 4px #888888",background:"rgba(255,255,255,0.97)",closeIcon:'<svg t="1619335973042" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1119" width="20" height="20"><path d="M391.68 667.306667a34.133333 34.133333 0 0 1-24.132267-58.2656L464.571733 512l-97.024-97.041067a34.133333 34.133333 0 1 1 48.264534-48.264533l97.041066 97.041067 96.187734-96.170667a34.133333 34.133333 0 1 1 48.264533 48.264533l-96.1024 96.1024 96.017067 95.3344a34.133333 34.133333 0 1 1-48.093867 48.4352l-96.187733-95.505066-97.109334 97.109333c-6.673067 6.656-15.4112 10.001067-24.149333 10.001067z" p-id="1120"></path></svg>',initialize:function(c,d){d||(d={});this._setOptions(d);this.container=c;this.rootFrame=geomap.element.create("div",{className:"rootFrame"},{zIndex:"1000",position:"absolute",top:"0px",left:"0px",border:"0px solid #989898",background:this.background,borderRadius:this.radius+"px",boxShadow:this.boxShadow});this.headBar=geomap.element.create("div",{className:"headBar"},{position:"absolute",top:"0px",left:"0px",borderBottom:"1px solid #b9b9b9"});this.bodyBar=geomap.element.create("div",{className:"body"},{position:"absolute",top:this.headHeight+"px",left:"0px"});var f=this.w-this.closeBtnSize-this.padding,e=this.padding;this.closeBtn=geomap.element.create("div",{className:"closeBtn"},{position:"absolute",top:e+"px",left:f+"px",width:this.closeBtnSize+"px",height:this.closeBtnSize+"px"});this.closeBtn.innerHTML=this.closeIcon;this.rootFrame.appendChild(this.headBar);this.rootFrame.appendChild(this.bodyBar);this.rootFrame.appendChild(this.closeBtn);this.container.appendChild(this.rootFrame);this.resetPos();this.resetStyle();this.resetBody();this._resize=this.resetStyle.bind(this);var h=this.close.bind(this);this._close=h;var g;eventjs.add(this.closeBtn,"click touch",this._close);eventjs.add(this.headBar,"drag gesture",this.dragHeadBarEv.bind(this));if(this.canHeadDblClick){eventjs.add(this.headBar,"dblclick",this.displayBodyToggle.bind(this))}eventjs.add(this.rootFrame,"click touch",this.rootFrameClickEv.bind(this));this.rootFrameClickEv()},rootFrameClickEv:function(d,c){if(d){eventjs.cancel(d)}if(geomap._FrameLayerZIndex){geomap._FrameLayerZIndex+=1;this.rootFrame.style.zIndex=geomap._FrameLayerZIndex}else{geomap._FrameLayerZIndex=geomap.util.formatNum(this.rootFrame.style.zIndex);this.rootFrame.style.zIndex=geomap._FrameLayerZIndex}},dragHeadBarEv:function(e,d){eventjs.cancel(e);if(d.state=="down"){var c=d.x,i=d.y;this._start_point=new a(c,i);this._status_drag=true;this.rootFrameClickEv(e,d)}else{if(d.state=="up"){this._status_drag=false;var h=new a(d.x,d.y);h._subtract(this._start_point);var g=this.x+h.x,f=this.y+h.y;if(g<(this.closeBtnSize-this.w)){g=this.closeBtnSize-this.w}else{if(g>(window.innerWidth-5)){g=window.innerWidth-5}}if(f<0){f=0}else{if(f>(window.innerHeight-this.headHeight)){f=window.innerHeight-this.headHeight}}this.x=g;this.y=f;this.resetStyle()}else{if(this._status_drag){var h=new a(d.x,d.y);h._subtract(this._start_point);var g=this.x+h.x,f=this.y+h.y;if(g<(this.closeBtnSize-this.w)){g=(this.closeBtnSize-this.w)}else{if(g>(window.innerWidth-5)){g=window.innerWidth-5}}if(f<0){f=0}else{if(f>(window.innerHeight-this.headHeight)){f=window.innerHeight-this.headHeight}}this.rootFrame.style.left=g+"px";this.rootFrame.style.top=f+"px"}}}},resetPos:function(){var c=this.container.clientWidth||window.clientWidth,d=this.container.clientHeight||window.innerHeight;var e=this.posPad;if(this.pos==="center"){this.x=Math.floor((c-this.w)/2);this.y=Math.floor((d-this.h)/2);return this}if(this.pos==="rc"){this.x=Math.floor((c-this.w))-e;this.y=Math.floor((d-this.h)/2);return this}if(this.pos==="lc"){this.x=e;this.y=Math.floor((d-this.h)/2);return this}if(this.pos==="lb"){this.x=e;this.y=d-this.h-e;return this}if(this.pos==="rb"){this.x=c-this.w-e;this.y=d-this.h-e;return this}if(this.pos==="rt"){this.x=c-this.w-e;this.y=e;return this}if(this.pos==="lt"){this.y=e;this.x=e;return this}},resetStyle:function(){this.bodyheight=this.h-this.headHeight;var c=window.innerWidth,g=window.innerHeight;this.w=Math.min(this.w,c);this.h=Math.min(this.h,g);var f=this.w-this.closeBtnSize-this.padding,e=this.padding;var d=this.headHeight-this.padding;geomap.element.setStyle(this.closeBtn,{width:this.closeBtnSize+"px",height:this.closeBtnSize+"px",left:f+"px",top:e+"px"});geomap.element.setStyle(this.headBar,{width:(this.w-this.padding)+"px",height:d+"px",paddingLeft:this.padding+"px",paddingTop:this.padding+"px"});if(this.showBody){geomap.element.setStyle(this.bodyBar,{width:this.w+"px",height:this.bodyheight+"px",top:this.headHeight+"px",display:""});geomap.element.setStyle(this.rootFrame,{width:this.w+"px",height:this.h+"px",top:this.y+"px",left:this.x+"px"})}else{geomap.element.setStyle(this.bodyBar,{width:this.w+"px",height:"0px",top:this.headHeight+"px",display:"none"});geomap.element.setStyle(this.rootFrame,{width:this.w+"px",height:this.headHeight+"px",top:this.y+"px",left:this.x+"px"})}return this},resetBody:function(){this.setTitle(this.title);this.setBody(this.body);return this},setTitle:function(c){this.title=c;this.headBar.innerHTML=this.title;return this},setBody:function(c){this.body=c;if(this.body===undefined){this.bodyBar.innerHTML=""}else{if(typeof this.body==="string"){this.bodyBar.innerHTML=this.body}else{this.bodyBar.innerHTML="";this.bodyBar.appendChild(this.body)}}if(this._loadBody){this.fire("datachange")}this._loadBody=true;return this},setData:function(e,c,d){this.setTitle(e);this.setBody(c);if(d!=undefined){this._setOptions(d);this.resetStyle()}},close:function(){if(this.closeType===1){this.fire("closestart");this.body=null;this.container.removeChild(this.rootFrame);this.fire("close");delete this}else{this.hide();this.fire("close")}},show:function(){if(this.rootFrame.style.display==="none"){this.rootFrame.style.display="";this.fire("show")}this.rootFrameClickEv();return this},hide:function(){if(this.rootFrame.style.display!="none"){this.rootFrame.style.display="none";this.fire("hide")}return this},displayToggle:function(){if(this.rootFrame.style.display==="none"){this.show()}else{this.hide()}},displayBodyToggle:function(){this.showBody=!this.showBody;this.resetStyle()}})})();(function(b){if(!b.geomap){b.geomap={}}if(b.geomap.Projection){geomap.warn("geomap.Map is already defined.");return}var a=geomap.Point;geomap.Projection=geomap.Class(geomap.CommonMethods,geomap.Observable,{transformtion:null,bounds:null,extent:[-180,-90,180,90],resolutions:[],initialize:function(c){c||(c={});this.transformtion=new geomap.Transformtion(2,0,-1,0);this._setOptions(c);var e=new a(this.extent[0],this.extent[1]);var d=new a(this.extent[2],this.extent[3]);this.bounds=new geomap.Bounds(e,d)},getBounds:function(){return this.bounds},resolution:function(e){var c=this.resolutions[e];if(!c){var d=1/Math.pow(2,e);c=this.resolutions[e]=d}return c},screenToCoord:function(d,c){this.transformtion.untransform(d,c)},coordToScreen:function(d,c){this.transformtion.transform(d,c)},getTransformtion:function(){return this.transformtion}})})(typeof exports!=="undefined"?exports:this);(function(){var c=geomap.Point;var a=geomap.Bounds;var b=geomap.util.toPoint;var d=new geomap.Projection({});geomap.Model={origin:new c(0,0),tileSize:256,res:undefined,bounds:undefined,center:new c(0,0),viewSize:undefined,zoom:0,projection:d,resolution:function(f){var e=this.projection.resolution(f);var g=this.projection.getTransformtion().transform(new c(e,e),1);return g},getScale:function(e){return Math.pow(2,e)},transform:function(e,f){return this.projection.getTransformtion().transform(e,f)},getBounds:function(){return this._getBounds().clone()},_getBounds:function(){if(!this._bounds||this._boundsChanged){var f,i,k,j,h,e;j=this.center;f=this.resolution(this.zoom);i=this.getSize().divideBy(2);k=f._scaleBy(i);var g=k;h=j.subtract(g);e=j.add(g);this._bounds=new a(h,e);this._boundsChanged=false}return this._bounds},setZoom:function(e){if(this.zoom!=e){this._boundsChanged=true}this.zoom=e;return this},setZoomCoord:function(i,g){if(this.zoom==g){return this}var h=this.coordToScreen(i);var e=this.resolution(g);var f=i.subtract(h._scaleBy(e));this.center=this.getSize().divideBy(2)._scaleBy(e).add(f);this.zoom=g;this._boundsChanged=true;return this},setZoomScreen:function(e,f){var g=b(e);r1=this.resolution(f),coord=this.screenToCoord(g),viewHalf=this.getSize().divideBy(2),centerOffset=viewHalf.subtract(g);this.center=coord._add(centerOffset._scaleBy(r1));this.zoom=f;this._boundsChanged=true;return this},panScreen:function(g){var h=b(g);var f=this.zoom;var e=this.resolution(f);this.center._subtract(h.scaleBy(e));this._boundsChanged=true},screenToCoord:function(h){var f=this.getBounds();var e=this.resolution(this.zoom),g=e._scaleBy(h);return f.min._add(g)},coordToScreen:function(h){var f=this.getBounds();var e=this.resolution(this.zoom),g=h.subtract(f.min);return g._unscaleBy(e)}}})();(function(){var c=geomap.Point;var a=geomap.Bounds;var b=geomap.util.toPoint;geomap.Caliper={capliperPos:[5,5],capliperHeight:150,capliperWidth:3,caliperDraw:function(t){var u=this.maxZoom;var e=this.minZoom;var m=this.zoom,j=u-e+1;var q=this.capliperPos[0],o=this.capliperPos[1],s=this.capliperHeight,g=Math.ceil(s/j),l=this.capliperWidth;s=g*(j-1);var f=m-e,k=o+f*g;t.fillStyle="#009688";t.strokeStyle="#009688";this.drawTriangle(t,q,k,l,q,o,g,l,f);if((f+1)==j){t.strokeStyle="#009688"}else{var r=(k-o+1)/s;r=r>1?1:r;var d=t.createLinearGradient(q,o,q,o+s);d.addColorStop(0,"#009688");d.addColorStop(r,"#009688");d.addColorStop(r,"#000000");d.addColorStop(1,"#000000");t.strokeStyle=d}t.beginPath();t.moveTo(q,o);t.lineTo(q,o+s);for(var h=0;h<j;h++){var n=h*g;var p=(h%2)*l+l;t.moveTo(q,o+n);t.lineTo(q+p,o+n)}t.stroke()},drawTriangle:function(q,p,o,e,n,m,g,k,j){q.fillStyle="#009688";q.strokeStyle="#009688";q.beginPath();q.moveTo(n,m);q.lineTo(n,o);for(var h=0;h<j;h++){var l=h*g;var f=(h%2)*k+k;q.moveTo(n,m+l);q.lineTo(n+f,m+l)}var d=j%2*k+k;q.moveTo(p,o);q.lineTo(p+d,o);q.stroke();q.moveTo(p,p);q.arc(p,o,e,0,Math.PI*2,true);q.fill()}}})();(function(){var a=geomap.Point;geomap.MapEvent={wheelDebounceTime:40,wheelPxPerZoomLevel:60,_preformWheelZoom:function(d,g){var h=this._wheel_delta,i=this.zoom,k=this.zoom,f=0,b=h/(this.wheelPxPerZoomLevel*4),l=4*Math.log(2/(1+Math.exp(-Math.abs(b))))/Math.LN2,j=f?Math.ceil(l/f)*f:l,c=this._limitZoom(k+(this._wheel_delta>0?j:-j))-k;if(this._wheel_delta>0){if(this._wheel_d0>=0){if(this._wheel_d0<this._wheel_delta){this._wheel_d0=this._wheel_delta;this._wheel_d1=0}else{if(this._wheel_d1==0){this._wheel_d1=1;var i=this.zoom;var k=this._limitZoom(i+1);this.setZoomScreen(g,k);this.fire("zoom",{event:d,point:g,delta:this._wheel_delta});this.fire("wheelzoom",{event:d,point:g,delta:this._wheel_delta,startZoom:i,endZoom:k})}else{this._wheel_d0=this._wheel_delta}}}}else{if(this._wheel_d2<=0){if(this._wheel_d2<=this._wheel_delta){this._wheel_d2=this._wheel_delta;this._wheel_d1=0}else{if(this._wheel_d1==0){this._wheel_d1=1;var i=this.zoom;var k=this._limitZoom(i-1);this.setZoomScreen(g,k);this.fire("zoom",{event:d,point:g,delta:this._wheel_delta});this.fire("wheelzoom",{event:d,point:g,delta:this._wheel_delta,startZoom:i,endZoom:k})}else{this._wheel_d2=this._wheel_delta}}}}this.__wheel_startTime=null;if(!c){return}var e=Math.ceil(k+c)},wheelZoomStart:function(c,b,d){this._wheel_d0=0;this._wheel_d1=0;this._wheel_d2=0;this._wheel_delta=0;this.fire("zoomstart",{event:c,point:b,delta:d,zoom:this.zoom})},wheelZoom:function(d,c,f){this._wheel_delta=f;if(!this.__wheel_startTime){this.__wheel_startTime=+new Date()}var b=Math.max(this.wheelDebounceTime-(+new Date()-this.__wheel_startTime),0);if(this.__wheeltimer){clearTimeout(this.__wheeltimer);this.__wheeltimer=null}this.__wheeltimer=setTimeout(this._preformWheelZoom.bind(this,d,c),b)},wheelZoomEnd:function(c,b,d){this._wheel_d0=0;this._wheel_d1=0;this._wheel_d2=0;this._wheel_delta=0;this.fire("zoomend",{event:c,point:b,delta:d})},dragStart:function(c,b){this.__startPos=b;this.__bounds_changed=(!c.ctrlKey&&!c.altKey);this.fire("dragstart",{event:c,point:b,boundsChanged:this.__bounds_changed})},dragChange:function(c,b){if(this.__bounds_changed){this.panScreen(b.subtract(this.__startPos))}this.fire("drag",{event:c,point:b,boundsChanged:this.__bounds_changed});this.__startPos=b},dragEndWithInertiaSpeed:function(b){var c=b.event;if(this._dragEndSpeedAnimFn){this._dragEndSpeedAnimFn.stop()}else{this._dragEndSpeedAnimFn=new geomap.PosAnimation({easeLinearity:0.1});this._dragEndSpeedAnimFn.on("end",function(){var g=this.other;var f=this.arg;g.fire("dragend",f);g.__bounds_changed=true}.bind({other:this,args:b}))}var e=b.point;var d=new a(b.event.inertiaSpeed[0],b.event.inertiaSpeed[1]);this._dragEndSpeedAnimFn.run(this,function(i,h){this.other.panScreen(i);var g=this.startP.add(i);this.startP=g;var f=this.arg;f.point=g;this.other.fire("drag",f)},[d,new a(0,0)],0.4,{startP:e,other:this,arg:b})},dragEnd:function(c,b){if(c.openInertia){this.dragEndWithInertiaSpeed({event:c,point:b,boundsChanged:this.__bounds_changed})}else{this.fire("dragend",{event:c,point:b,boundsChanged:this.__bounds_changed});this.__bounds_changed=true}},touchZoomStart:function(c,b){this.__touch_point=b;this.__touch_zoom=this.zoom;this.fire("touchzoomstart",{event:c,point:this.__touch_point})},touchZoom:function(g,f,i){var b=this.getScale(this.__touch_zoom);var d=b*i;var c=Math.round(Math.log(d)/Math.LN2);var h=this._limitZoom(c);this.setZoomScreen(this.__touch_point,h);this.zoom=h;this.fire("touchzoom",{event:g,scale:i,point:f})},touchZoomEnd:function(g,f,i){var b=this.getScale(this.__touch_zoom);var d=b*i;var c=Math.round(Math.log(d)/Math.LN2);var h=c;this.setZoomScreen(this.__touch_point,h);this.zoom=h;this.fire("touchzoomend",{event:g,scale:i,point:this.__touch_point})}}})();(function(){var c=geomap.Point;var a=geomap.Bounds;var b=geomap.util.toPoint;geomap.MapRectSelect={_rectPoints:[],_movingPos:[0,0],RectSelectBindEvent:function(d){if(!this._RectSelectDrawDownID){this._RectSelectDrawDownID=this.RectSelectDrawDown.bind(this);this._RectSelectDrawUpID=this.RectSelectDrawUp.bind(this);this._RectSelectDrawMovingID=this.RectSelectDrawMoving.bind(this);this._RectSelectDrawID=this.RectSelectDraw.bind(this);d.on("mousedown",this._RectSelectDrawDownID);d.on("mouseup",this._RectSelectDrawUpID);d.on("mousemove",this._RectSelectDrawMovingID);d.on("drawingCanvas",this._RectSelectDrawID)}},RectSelectDrawDown:function(d){if(d.event.altKey){this.__status_draw=true;this.__status_draw_p0=d.point;this._movingPos=d.point;this.fire("drawCanvas")}},RectSelectDrawMoving:function(d){this._movingPos=d.point},RectSelectDrawUp:function(h){if(this.__status_draw&&this.__status_draw_p0){if(this.__status_draw_p0.equals(h.point)){var i=this.screenToCoord(h.point);var d={event:h,coord:i};this.fire("pointcoord",d);this.__status_draw=false;return}else{this.__status_draw_p1=h.point;var g=this.screenToCoord(this.__status_draw_p0);var f=this.screenToCoord(this.__status_draw_p1);var d={event:h,minx:Math.min(g.x,f.x),miny:Math.min(g.y,f.y),maxx:Math.max(g.x,f.x),maxy:Math.max(g.y,f.y)};this.fire("rectcoord",d);this.__status_draw=false}}},RectSelectDraw:function(d){if(this.__status_draw&&this._movingPos){var f=this.__status_draw_p0,e=this._movingPos;d.setLineDash([]);d.fillStyle="rgba(255, 255, 255, 0.4)";d.strokeStyle="#fff";d.beginPath();d.moveTo(f.x,f.y);d.lineTo(f.x,e.y);d.lineTo(e.x,e.y);d.lineTo(e.x,f.y);d.closePath();d.closePath();d.fill();d.stroke();this.fire("drawCanvas")}}}})();(function(c){if(!c.geomap){c.geomap={}}if(c.geomap.Map){geomap.warn("geomap.Map is already defined.");return}var d=geomap.util;var e=d.object.extend;var b=geomap.Point;var a=geomap.util.toPoint;geomap.Map=geomap.Class(geomap.CommonMethods,geomap.Observable,geomap.Model,geomap.MapEvent,geomap.Caliper,geomap.MapRectSelect,{type:"object",width:100,height:1000,viewOrigin:{x:0,y:0},center:undefined,canvas:undefined,canvasCtx:undefined,bgCanvas:undefined,bgCanvasCtx:undefined,zoom:2,maxZoom:11,minZoom:0,layers:[],_global_interval:null,_canrender:true,_container:undefined,_geometrys:[],model:undefined,loopTime:40,canvasRatio:1,initialize:function(f,g){g||(g={});this._setOptions(g);this._sizeChanged=true;if(g.debug){geomap.debug=g.debug}if(this.center===undefined){this.center=new b(0,0)}else{this.center=a(this.center)}this._container=f;this._initElement();this.FNID_draw=this.draw.bind(this);this.FNID_fireAnimmoveEnd=this.FireAnimmoveEnd.bind(this);this.on("drawmap",this.drawMap.bind(this));this.on("drawCanvas",this.FNID_draw);this.on("clear_geometry",this.clearGeometry.bind(this));this.LoopTime()},_dispose:function(){geomap.util.cancelAnimFrame(this._global_interval);this._global_interval=null},_initElement:function(){this._container.style.position="absolute";this._container.style.overflow="hidden";var i=this.getSize();var j=i.x,f=i.y;var k=geomap.element.create("canvas",{id:"_map_canvas",width:j,height:f},{zIndex:2,border:"0px solid red",backgroundColor:"#e4e4e4",position:"absolute",width:j+"px",height:f+"px"});geomap.element.createHiDPICanvas(k,j,f,this.canvasRatio);var h=geomap.element.create("canvas",{width:j,height:f},{backgroundColor:"#e4e4e4",position:"absolute",width:j+"px",height:f+"px"});this.bgCanvas=h;this.bgCanvasCtx=h.getContext("2d");this._container.appendChild(k);this.canvas=k;const g=k.getContext("2d");this.canvasCtx=g;this._eventDrag=new geomap.Event.Drag(this);this._eventTouchZoom=new geomap.Event.TouchZoom(this);this._eventWheelZoom=new geomap.Event.ScrollWheelZoom(this);this._eventDrag.addEvent(this.canvas);this._eventTouchZoom.addEvent(this.canvas);this._eventWheelZoom.addEvent(this.canvas);this.RectSelectBindEvent(this);eventjs.add(this.canvas,"contextmenu",eventjs.cancel);eventjs.add(this.canvas,"click touch",function(n,m){var l=new b(n.offsetX||m.x,n.offsetY||m.y);var p=this.screenToCoord(l);var o=e({},{target:this,coord:p,point:l,event:n});this.fire("click",o)}.bind(this));eventjs.add(this.canvas,"mousedown",function(o,n){var m=new b(o.offsetX,o.offsetY);var l={event:o,point:m};this.fire("mousedown",l)}.bind(this));eventjs.add(this.canvas,"mousemove",function(o,n){var m=new b(o.offsetX,o.offsetY);var l={event:o,point:m};this.fire("mousemove",{event:o,point:m})}.bind(this));eventjs.add(this.canvas,"mouseup",function(o,n){var m=new b(o.offsetX,o.offsetY);var l={event:o,point:m};this.fire("mouseup",l)}.bind(this))},_limitZoom:function(f){if(this.maxZoom<f){return this.maxZoom}else{if(this.minZoom>f){return this.minZoom}}return f},LoopTime:function(){this.fire("looptime");for(var h=0,f=this.layers.length;h<f;h++){var g=this.layers[h];g.OnLoopTime()}this._redrawingCanvas.call(this);geomap.util.requestAnimFrame(this.LoopTime,this)},_redrawingCanvas:function(){if(this._redrawing==true||this._move_type==1){this._redrawing=false;const g=this.canvasCtx;var m=this.getSize();g.clearRect(0,0,m.x,m.y);for(var l=0,h=this.layers.length;l<h;l++){var j=this.layers[l];j.drawingCanvas(g)}var f=this._geometrys.length;if(f>0){for(var l=0;l<f;l++){var n=this._geometrys[l];n.render(g);if(n.loopRender){this._redrawing=true}}}this.caliperDraw(g);this.fire("drawingCanvas",g)}},animated:function(){this.fire("animated")},drawMap:function(){this.fire("viewreset");this._redrawing=true},draw:function(){this._redrawing=true},_loadLayer:function(f){f.on("drawCanvas",this.FNID_draw);f.initLayer(this.canvas,this)},addLayer:function(f){this._loadLayer(f);this.layers.push(f);this.fire("drawmap")},setCenter:function(g,f){g=a(g);this.center=g;this._boundsChanged=true;if(f!=undefined&&typeof f=="number"){this.setZoom(f)}},FireAnimmoveEnd:function(f){this.fire("animmove_end",this._event_animMove_arg)},animMove:function(h,p){h=a(h);var k,q=this.getSize(),j=this.coordToScreen(h).round();var m=q.divideBy(2).round();var i=Math.round(j.distanceTo(m));var g=Math.round(Math.sqrt(q.x*q.x+q.y*q.y));if(i>g){var f=i/g;var o,l;o=j.x-(j.x-m.x)*f;l=j.y+(m.y-j.y)*f;j=this.transformtion.transform(new b(o,l).round(),1);k=this.screenToCoord(j)}else{k=this.center}if(!h.equals(this.center)){if(this._animMoveFn){this._animMoveFn.stop()}else{this._animMoveFn=new geomap.PosAnimation();var n=this;this._animMoveFn.on("end",this.FNID_fireAnimmoveEnd)}var n=this;this._event_animMove_arg={map:n,coord:h,feature:p};this._animMoveFn.run(this,function(r){this.setCenter(r);this.fire("drawmap")},[k,h],1,this)}},moveTo:function(h,f,g){this.setCenter(a(h));if(f===undefined){}else{if(typeof f=="string"){f=Number(f)}this.setZoom(f)}this.fire("drawmap")},getSize:function(){if(!this._size||this._sizeChanged){this._size=new b(this._container.clientWidth||this.width,this._container.clientHeight||this.height);this._sizeChanged=false}return this._size.clone()},resize:function(){this._sizeChanged=true;var f=this.getSize();geomap.element.createHiDPICanvas(this.canvas,f.x,f.y,this.canvasRatio);geomap.element.createHiDPICanvas(this.bgCanvas,f.x,f.y,this.canvasRatio);this._boundsChanged=true;this._redrawing=true;this.fire("resize");this.fire("drawmap")},getCoord:function(f){return this.model.screenToCoord(d.toPoint(f))},addGeometry:function(f){this._geometrys.push(f);this._redrawing=true},clearGeometry:function(){this._geometrys=[];this._redrawing=true}})})(typeof exports!=="undefined"?exports:this);(function(b){function a(m,d,j){var k=j.coordinates,h=k.length;if(h>0){switch(j.type){case"Polygon":k=k[0];h=k.length;if(k.length>1){m.beginPath();var l=d.coordToScreen(k[0]).round();m.moveTo(l.x,l.y);for(var f=1;f<h;f++){var g=k[f];var e=d.coordToScreen(g).round();m.lineTo(e.x,e.y)}m.closePath();m.stroke();m.fill()}break;case"Point":var e=d.coordToScreen(k[0]).round(),c=j.r;m.fillRect(e.x-c/2,e.y-c/2,c,c);m.strokeRect(e.x-c/2,e.y-c/2,c,c);break;default:m.beginPath();var l=d.coordToScreen(k[0]).round();m.moveTo(l.x,l.y);for(var f=1;f<h;f++){var g=k[f];var e=d.coordToScreen(g).round();m.lineTo(e.x,e.y)}m.closePath();m.stroke()}}}geomap.shape={draw:a}})(typeof exports!=="undefined"?exports:this);(function(){var b=geomap.util.toPoint,c=geomap.util.object.extend;function a(){this.type="group";this._data=[]}a.prototype={add:function(f){if(f){if(typeof f=="array"){for(var e=0,d=f.length;e<d;e++){this._data.push(f[e])}}else{if(typeof f=="object"){this._data.push(f)}}}},remove:function(d){if(this._data.length<d){this._data.splice(d,1)}},draw:function(d,g){for(var f=0,e=this._data.length;f<e;f++){geomap.shape.draw(d,g,this._data[f].getGeometry())}},split:function(g,e,j){var h=[];for(var f=0,d=this._data.length;f<d;f++){this._data[f].split(g,e,j)}},bounds:function(){var g=[],e,d;for(var h=0,f=this._data.length;h<f;h++){g.push(this._data[h].bounds())}for(var h=0,f=g.length;h<f;h++){var j=g[h];if(j!=null){}}},getSize:function(){return this._data.length},getPaths:function(){return this._data},getData:function(){var f=[];for(var e=0,d=this._data.length;e<d;e++){f.push(this._data[e].getData())}return f},clear:function(){var e=this._data.length;if(e>0){while(e>0){var d=this._data.pop();delete d;e=this._data.length}}}};geomap.shape.Group=a})();(function(){var b=geomap.util.toPoint,c=geomap.util.object.extend;function a(d,e){this.type="Path";this._group=d;d.add(this);this._geometry=c({type:null,coordinates:[]},e)}a.prototype={setData:function(d,e){this._geometry.type=d;this._geometry.coordinates=e},setProp:function(d){this._properties=d},addProp:function(d,e){var f=this._properties||{};f[d]=e;this._properties=f},splitH:function(l,k,n){var p=[];var o=0;if(n!=undefined){o=n.x}if(l.length==5){var s=l[0],r=l[3],u=l[1],t=l[2];var q=r.subtract(s),d=t.subtract(u),f=k-1;var m=(q.x-f*o)/k,v=(d.x-f*n)/k;var g=s,e=u;for(var w=0;w<k;w++){var x=[];x.push(g);x.push(e);var j=e.clone();j.x+=v;x.push(j);var h=g.clone();h.x+=m;x.push(h);x.push(g);p.push(x);g=h.clone();e=j.clone();g.x+=o;e.x+=o}}return p},splitV:function(m,n,r){var s=[],q=0;if(r!=undefined){q=r.y}if(m.length==5){var d=m[0],x=m[1],h=m[3],e=m[2];var v=x.subtract(d),t=e.subtract(h),g=n-1;var p=(v.y-g*q)/n,o=(t.y-g*q)/n;var j=d,f=h;for(var u=0;u<n;u++){var w=[];w.push(j);var l=j.clone();l.y+=p;w.push(l);var k=f.clone();k.y+=o;w.push(k);w.push(f);w.push(j);s.push(w);j=l.clone();f=k.clone();j.y+=q;f.y+=q}}return s},split:function(e,u,s){var r=this._geometry,v=null,t=null,q=null,p=null,o;switch(r.type){case"Polygon":o=r.coordinates;if(o.length==1&&o[0].length==5){o=o[0];var f=[];var n=this.splitH(o,e,s);if(n.length>0){if(u!=undefined&&u>1){for(var l=0,g=n.length;l<g;l++){var d=this.splitV(n[l],u,s);for(var h=0,m=d.length;h<m;h++){f.push(d[h])}}}else{f=n}}if(f.length>0){this._geometry.coordinates=[f[0]];for(var l=1,g=f.length;l<g;l++){new a(this._group,{type:"Polygon",coordinates:[f[l]]})}}}break;default:o=r.coordinates}},bounds:function(){var h=this._geometry,e=null,d=null,m=null,l=null,j;switch(h.type){case"Polygon":j=h.coordinates;if(j.length>0){j=j[0]}break;default:j=h.coordinates}if(j.length>0){m=e=j[0].x;l=d=j[0].y;for(var g=1,f=j.length;g<f;g++){e=Math.min(e,j[g].x);d=Math.min(d,j[g].y);m=Math.max(m,j[g].x);l=Math.max(l,j[g].y)}return geomap.util.toBounds(e,d,m,l)}else{return null}},getGeometry:function(){return this._geometry},getData:function(){var g=this._geometry.coordinates,f=[];var h={type:this._geometry.type,coordinates:[]};if(h.type=="Polygon"){if(g.length>0){g=g[0]}h.coordinates=[f]}else{h.coordinates=f}if(g.length>0){for(var e=0,d=g.length;e<d;e++){f.push([g[e].x,g[e].y])}return h}else{return null}},getFeature:function(){return{geometry:this._geometry,properties:this._properties}}};geomap.shape.Path=a})();(function(){var a=geomap.util.toPoint;geomap.Geometry=geomap.Class(geomap.CommonMethods,geomap.Observable,{_coordinates:[],_map:null,_start:true,_fill:false,_pointWeight:6,_type:0,style:{fillStyle:"rgba(0, 0, 0, 0.4)",strokeStyle:"rgba(0,255,255,0.9)",lineWidth:2},lineDashOffset:0,lineDash:[],loopRender:false,initialize:function(c,b){b||(b={});this._setOptions(b);this._map=c;this._type=0},setMap:function(b){this._map=b},s2c:function(b){return this._map.screenToCoord(b)},c2s:function(b){return this._map.coordToScreen(b).round()},addCoord:function(c){var b=this._coordinates.length;if(b>0){if(!this._coordinates[b-1].equals(c)){this._coordinates.push(c)}}else{this._coordinates.push(c)}},setType:function(b,c){this.clear();this._fill=c||false;if(typeof b=="string"){if(b=="Polygon"){this._type=0}else{if(b=="Point"){this._type=1}else{if(b=="Line"){this._type=2}else{if(b=="Rect"){this._type=3}else{if(b=="Circle"){this._type=4}}}}}}else{this._type=b}},getType:function(){var b="Polygon";switch(this._type){case 1:b="Point";break;case 2:b="Line";break;case 3:b="Rect";break;case 4:b="Circle";break}return b},push:function(b){var c=this.s2c(b);this.addCoord(c)},clear:function(){var d=this._coordinates;this._coordinates=[];var b=d.length;for(var c=0;c<b;c++){d[c]=null}},moveTo:function(b){if(this._start){this._movePoint=b}},end:function(){this._movePoint=null;this._start=false;var b=this._coordinates.length;switch(this._type){case 0:if(b>2){this._coordinates.push(this._coordinates[0])}else{this.clear()}break;case 2:if(b<2){this.clear()}break;case 3:case 4:if(b!=2){this.clear()}break}},isEnd:function(){switch(this._type){case 1:return this._coordinates.length==1;case 3:case 4:return this._coordinates.length==2}return false},setStyle:function(b){var c=this.style;for(var d in c){b[d]=c[d]}},getText:function(){var b=this.getJson();return JSON.stringify(b)},getCoordJson:function(){var f=this._coordinates,c=f.length;var b={type:"",coordinates:[]};if(c<1){return b}switch(this._type){case 1:b.type="Point";b.coordinates.push(f[0]);break;case 2:b.type="Line";for(var d=0;d<c;d++){b.coordinates.push(f[d])}break;case 3:b.type="Polygon";if(c>1){var h=f[0],g=f[1],e=[];e.push(a([h.x,h.y]));e.push(a([h.x,g.y]));e.push(a([g.x,g.y]));e.push(a([g.x,h.y]));e.push(a([h.x,h.y]));b.coordinates.push(e)}break;default:b.type="Polygon";if(c>1){var h=f[0],g=f[1],e=[];for(var d=0;d<c;d++){e.push(f[d])}b.coordinates.push(e)}}return b},getJson:function(){var f=this._coordinates,c=f.length;var b={type:"",coordinates:[]};if(c<1){return b}switch(this._type){case 1:b.type="Point";b.coordinates=[f[0].x,f[0].y];break;case 2:b.type="Line";for(var d=0;d<c;d++){b.coordinates.push([f[d].x,f[d].y])}break;case 3:b.type="Polygon";if(c>1){var h=f[0],g=f[1],e=[];e.push([h.x,h.y]);e.push([h.x,g.y]);e.push([g.x,g.y]);e.push([g.x,h.y]);e.push([h.x,h.y]);b.coordinates.push(e)}break;default:b.type="Polygon";if(c>1){var h=f[0],g=f[1],e=[];for(var d=0;d<c;d++){e.push([f[d].x,f[d].y])}b.coordinates.push(e)}}return b},render:function(c){var b=this._coordinates.length;c.setLineDash([]);if(this.lineDash&&this.lineDash.length>1){c.setLineDash(this.lineDash);c.lineDashOffset=this.lineDashOffset;this.lineDashOffset+=1;this.loopRender=true}else{this.loopRender=false}if(b>0){this.setStyle(c);switch(this._type){case 0:c.beginPath();var j=this.c2s(this._coordinates[0]);c.moveTo(j.x,j.y);for(var d=1;d<b;d++){var h=this._coordinates[d];var f=this.c2s(h);c.lineTo(f.x,f.y)}if(this._start&&this._movePoint&&this._movePoint!=null){c.lineTo(this._movePoint.x,this._movePoint.y)}c.closePath();c.stroke();if(this._fill){c.fill()}break;case 1:var f=this.c2s(this._coordinates[0]),e=this._point_weight;c.fillRect(f.x-e/2,f.y-e/2,e,e);c.strokeRect(f.x-e/2,f.y-e/2,e,e);break;case 2:c.beginPath();var j=this.c2s(this._coordinates[0]);c.moveTo(j.x,j.y);for(var d=1;d<b;d++){var h=this._coordinates[d];var f=this.c2s(h);c.lineTo(f.x,f.y)}if(this._start&&this._movePoint&&this._movePoint!=null){c.lineTo(this._movePoint.x,this._movePoint.y)}c.stroke();break;case 3:var j=this.c2s(this._coordinates[0]),g;if(b==2){g=this.c2s(this._coordinates[1]).subtract(j);this._fill?c.fillRect(j.x,j.y,g.x,g.y):c.strokeRect(j.x,j.y,g.x,g.y)}else{if(this._start&&this._movePoint&&this._movePoint!=null){g=this._movePoint.subtract(j);this._fill?c.fillRect(j.x,j.y,g.x,g.y):c.strokeRect(j.x,j.y,g.x,g.y)}}}}}})})();(function(){var a=geomap.Point;geomap.Path=geomap.Class(geomap.Geometry,{lineDash:null,initialize:function(c,b){b||(b={});this.callSuper("initialize",c,b)},setData:function(e){var b=e.coordinates;this._type=0;this._coordinates=[];if(b.length>0){var f=b[0];if(f.length>0){for(var d=0,c=f.length;d<c;d++){this._coordinates.push(new a(f[d][0],f[d][1]))}}}this._map.fire("drawmap")}})})();(function(){var b=geomap.Point;var a=geomap.util.object.clone;geomap.Polygon=geomap.Class(geomap.Geometry,{initialize:function(d,c){c||(c={});this.callSuper("initialize",d,c);this._type=0},setData:function(f){var c=f.coordinates;this._type=0;this._coordinates=[];if(c.length>0){var g=c[0];if(g.length>0){for(var e=0,d=g.length;e<d;e++){this._coordinates.push(new b(g[e][0],g[e][1]))}}}this._map.fire("drawmap")}})})();(function(){var a=geomap.Point;geomap.Marker=geomap.Class(geomap.CommonMethods,geomap.Observable,geomap.Geometry,{type:"Marker",canvas:null,ctx:null,point:null,width:400,height:200,ratio:3,radius:10,lineV:20,padding:10,textRows:[],style:{fillStyle:"rgba(0, 0, 0, 0.9)"},fontStyle:{font:"bold 14px serif",fillStyle:"white"},initialize:function(e,d){this._map=e;d||(d={});if(d.style){d.style=geomap.util.object.extend(this.style,d.style)}this._setOptions(d);this._type=0;var c=geomap.element.create("canvas");var b=c.getContext("2d");geomap.element.createHiDPICanvas(c,this.width,this.height,this.ratio);this.canvas=c;this.ctx=b;this.point=new a(100,100)},setData:function(f){var g=f.geometry;var d=f.properties;this.textRows=[];if(d!=undefined){var b=this.ctx;var e=this.getRectTextSize();for(var c in d){this.drawText(b,c+":"+d[c],e[0])}}this.draw();this._map.fire("drawmap")},draw:function(){var k=this.ctx,d=this.width,j=this.height;k.clearRect(0,0,d,j);this.roundedRect(k,0,0,d,j,this.radius);var e=this.fontStyle;for(var c in e){k[c]=e[c]}var h=this.textRows.length,g=this.padding+this.lineV,i=this.padding;for(var f=0;f<h;f++){k.fillText(this.textRows[f],i,g);g+=this.lineV}},getRectTextSize:function(){var b=this.width-(this.padding*2),c=this.height-(this.padding*2);return[b,c]},drawText:function(d,f,c){var g=f.split("");var e="";for(var b=0;b<g.length;b++){if(d.measureText(e).width<c&&d.measureText(e+(g[b])).width<=c){e+=g[b]}else{this.textRows.push(e);e=g[b]}}this.textRows.push(e)},render:function(c){var b=this.width,d=this.height;c.drawImage(this.canvas,this.point.x,this.point.y,b,d)},roundedRect:function(e,d,g,f,c,b){this.setStyle(e);e.beginPath();e.moveTo(d,g+b);e.lineTo(d,g+c-b);e.quadraticCurveTo(d,g+c,d+b,g+c);e.lineTo(d+f-b,g+c);e.quadraticCurveTo(d+f,g+c,d+f,g+c-b);e.lineTo(d+f,g+b);e.quadraticCurveTo(d+f,g,d+f-b,g);e.lineTo(d+b,g);e.quadraticCurveTo(d,g,d,g+b);e.fill()}})})();(function(){var b=geomap.util.toPoint,c=geomap.util.object.extend;function a(d,f){var e=c({id:null,properties:null,geometry:{type:null,coordinates:[]}},d);this._data=e;if(f!=undefined){this._map=f}}a.prototype={drawOptions:{lineWidth:2,lineDash:[],radius:5,dashOffset:1,animated:false,strokeStyle:"rgba(3,169, 244,1)",fillStyle:"rgba(41,182,246,1)",fill:true},setMap:function(d){this._map=d},initCoords:function(){if(!this._coords){this._coords=[];var g=this._data.geometry;var f=g.coordinates;if(f&&f.length>0){if(g.type==="Polygon"){f=f[0]}for(var e=0,d=f.length;e<d;e++){this._coords.push(b(f[e]))}}}},clearCanvasOpt:function(d){d.fillStyle=null;d.strokeStyle=null;d.lineDashOffset=1;d.lineWidth=1;d.setLineDash([])},drawPolygon:function(n,e){if(!this._coords){this.initCoords()}if(this._coords.length>3){var f=this._map,o=this,k=o._coords,j=k.length;n.lineWidth=e.lineWidth;n.setLineDash(e.lineDash);n.strokeStyle=e.strokeStyle;n.fillStyle=e.fillStyle;n.lineDashOffset=(o.drawOptions.dashOffset+=0.5);n.beginPath();var l=f.coordToScreen(k[0]);n.moveTo(l.x,l.y);for(var g=1;g<j;g++){var h=k[g];var d=f.coordToScreen(h);n.lineTo(d.x,d.y)}n.closePath();n.stroke();if(e.fill){n.fill()}}},drawPoint:function(f,g){if(!this._coords){this.initCoords()}if(this._coords.length>0){var e=this._map,h=this,k=h._coords,d=k.length,i=h.radius;var j=e.coordToScreen(k[0]);f.lineWidth=g.lineWidth;f.setLineDash(g.lineDash);f.strokeStyle=g.strokeStyle;f.fillStyle=g.fillStyle;f.lineDashOffset=(h.drawOptions.dashOffset+=1);f.beginPath();f.arc(j.x,j.y,i,0,Math.PI*2,true);f.closePath();f.stroke();if(g.fill){f.fill()}}},draw:function(d,e){var h=this._data.geometry,g=e||{};var f=c({},this.drawOptions);c(f,g);this.clearCanvasOpt(d);switch(h.type){case"Polygon":this.drawPolygon(d,f);break;case"Point":this.drawPoint(d,f);break}this.clearCanvasOpt(d);if(f.animated){this._map.animated()}}};geomap.Feature=a})();(function(b){var d=geomap.util.object.extend;var a=geomap.Point;if(!b.geomap){b.geomap={}}if(b.geomap.Layer){geomap.warn("geomap.Map is already defined.");return}var c={type:"Layer",width:100,height:100,_canvas:null,_map:undefined,transformtion:null,wheelZoomChanage:false,canvas:null,canvasCtx:null,cacheTime:0,initLayer:function(e,g){this.transformtion=new geomap.Transformtion(-1,0,-1,0);this._canvas=e;this._drawLock=1;this._map=g;this.cacheTime=+new Date();var e=geomap.element.create("canvas",{},{zIndex:2,border:"1px solid blue",backgroundColor:"#e4e4e4",position:"absolute",top:"0px"});var f=e.getContext("2d");this.canvas=e;this.canvasCtx=f;this.OnResize();g.on("resize",this.OnResize.bind(this));g.on("viewreset",this.ViewReset.bind(this));g.on("dragstart",this.OnDragStart.bind(this));g.on("drag",this.OnDrag.bind(this));g.on("dragend",this.OnDragEnd.bind(this));g.on("touchzoomstart",this.OnTouchZoomStart.bind(this));g.on("touchzoom",this.OnTouchZoom.bind(this));g.on("touchzoomend",this.OnTouchZoomEnd.bind(this));g.on("wheelzoom",this.OnScrollZoom.bind(this));this.fire("initLayer");this.ViewReset()},OnResize:function(){var e=this._map.getSize();this.width=e.x;this.height=e.y;this.canvas.width=e.x;this.canvas.height=e.y;this.canvas.style.width=e.x+"px";this.canvas.style.height=e.y+"px"},OnTouchZoomStart:function(e){var f=e.event,g=e.point;this._touchZoomStart=g},OnTouchZoom:function(e){var f=e.event,g=e.scale;this._canvasScale=geomap.util.formatNum(g,4);this.fire("drawCanvas")},OnTouchZoomEnd:function(e){this._touchZoomStart=null;this.ViewReset()},scrollZoomEnd:function(e){this._canvasScale=1;this.ViewReset()},OnScrollZoom:function(e){if(e.startZoom==e.endZoom){return}if(this._animMoveFn){this._animMoveFn.stop()}else{this._animMoveFn=new geomap.PosAnimation({easeLinearity:0.1});this._animMoveFn.on("end",function(){this._touchZoomStart=null;this._canvasScale=1;this.wheelZoomChanage=false;this.ViewReset()}.bind(this))}this._touchZoomStart=e.point;this._animMoveFn.run(this._map,function(j,h){var g=this._map.getScale(h.pos[0].x);var f=this._map.getScale(j.x);var i=f/g;this._canvasScale=i;this.wheelZoomChanage=true;this.fire("drawCanvas")},[new a(e.startZoom,0),new a(e.endZoom,0)],0.4,this)},OnDragStart:function(e){this._dragStartPos=e.point},OnDrag:function(e){if(e.boundsChanged){this._dragOffset=e.point.subtract(this._dragStartPos);this.fire("drawCanvas")}},OnDragEnd:function(f){this._dragOffset=null;this.ViewReset()},ViewReset:function(){this.fire("drawCanvas")},getCanavsSize:function(){return this._map.getSize()},OnLoopTime:function(){},refreshCache:function(){this.cacheTime=+new Date();this.ViewReset()}};geomap.Layer=geomap.Class(geomap.CommonMethods,geomap.Observable,c,{initialize:function(e){e||(e={});this._setOptions(e)},drawingCanvas:function(m,f){var e=this._map,k=new a(0,0),n=this.getCanavsSize(),i=this._dragOffset||k,l=(this._touchZoomStart||k),g=(this._canvasScale||1),h=n.multiplyBy(g).round();var j=this.transformtion.transform(l.clone(),g)._add(l).add(i).round();m.drawImage(this.canvas,j.x,j.y,h.x,h.y)}})})(typeof exports!=="undefined"?exports:this);(function(c){var d=geomap.util.object.extend;var b=geomap.Point;var a=geomap.element;if(!c.geomap){c.geomap={}}if(c.geomap.TileLayer){geomap.warn("geomap.Map is already defined.");return}geomap.TileLayer=geomap.Class(geomap.Layer,{url:null,_drawLock:1,cache:true,_canvas_map_size:new b(0,0),_mapSize:null,_tiles:{},headers:{},useReqModel:false,initialize:function(e){this.callSuper("initialize",e);this.on("initLayer",this.OnInitLayer.bind(this));this.on("draw_tile",this.DrawTile.bind(this))},OnInitLayer:function(){this.getCanavsSize();this._levels={};this._tiles={}},getCanavsSize:function(){var f=this._map,e=f.getSize();if(!this._canvas_copy_size||!this._mapSize||!e.equals(this._mapSize)){this._mapSize=e.clone();this._canvas_copy_size=e.multiplyBy(3);this.canvas.width=this._canvas_copy_size.x;this.canvas.height=this._canvas_copy_size.y;this.canvas.style.width=this._canvas_copy_size.x+"px";this.canvas.style.height=this._canvas_copy_size.y+"px";this._canvas_map_size=e;this.transformtion.setOrigin(-e.x,-e.y)}return this._canvas_copy_size},InitLevels:function(){var g=this._map;var f=g.zoom;var e=g.maxZoom;var h=this._levels[f];if(!h){h=this._levels[f]={};h.zoom=f}this.UpdateLevel(h)},UpdateLevel:function(e){var J=this._map,s=e.zoom,h=J.tileSize,p=J.getBounds(),M=J.resolution(s),g=this.getCanavsSize(),F=this._canvas_map_size;var I=e.tiles;if(!I){I=e.tiles={}}for(var G in I){I[G]["tag"]=0;I[G]["cacheTime"]=this.cacheTime}var j=Math.round(F.x/h)+2;var w=Math.round(F.y/h)+2;var n=this.OriginTileInfo(M,p.min);var f=n.cell;var o=n.row;var m=n.left;var C=n.top;for(var H=-0,E=j;H<E;H++){for(var B=-0,q=w;B<q;B++){var v=1*f+H;var u=1*o+B;var D=Math.floor(m+h*H)+F.x;var A=Math.floor(C+h*B)+F.y;var L="NO"+v+"-"+u;var K=I[L];if(!K){K=I[L]={};K.x=v;K.y=u;K.z=s;K.id=L}K.left=D;K.top=A;K.tag=1;K.cacheTime=this.cacheTime}}this.LoadLevel(e)},LoadLevel:function(h){var e=h.tiles;if(e){for(var f in e){var g=e[f];if(g.tag==0){this.RemoveTile(g)}else{this.LoadTile(g)}}}},LoadTile:function(g){var i=g.image;if(!i){i=g.image=a.create("img");g.status=0;var j=this.OnloadImage;var f=this;var h=function(){j&&j.call(f,g,false)};i.onload=h;i.onerror=function(){geomap.log("Error loading "+i.src);j&&j.call(f,g,true)};i.tile=g;i.src=this.GetTileUrl(this.url,g)}else{var e=this.GetTileUrl(this.url,g);geomap.debug("newSrc="+e);if(e!=i.src){g.status=0;i.src=e}}},GetTileUrl:function(e,f){var g=geomap.util.template(e+(/\?/.test(e)?"&":"?")+"cacheTime={cacheTime}",f);return g},OnloadImage:function(f,e){if(!e){if(f.status===0){f.status=1;this.fire("draw_tile",f)}}},RemoveTile:function(e){if(e.image){e.image.remove();e.image=null}delete this._levels[e.z].tiles[e.id]},DrawTile:function(){var h=this._map,j=h.zoom;var k=this._levels[j];if(!k){return}var e=k.tiles;if(e){for(var f in e){var g=e[f];if(g.tag===1&&g.status===1&&g.image){this.canvasCtx.drawImage(g.image,g.left,g.top)}}}this.fire("drawCanvas")},ViewReset:function(){this._canvasScale=1;var j=this._map,k=j.zoom,i=j.tileSize,h=j.getBounds(),e=this.getCanavsSize(),f=this._canvas_map_size,g=this._drawLock+1;this.canvasCtx.clearRect(0,0,e.x,e.y);this.InitLevels();this.fire("draw_tile",null)},OriginTileInfo:function(i,h){var e=this._map,f=e.origin,n=e.tileSize;var l=h.x,k=h.y;var m=Math.floor((h.x-f.x)/i.x/n);var p=Math.floor((h.y-f.y)/i.y/n);var g=-(h.x-f.x)/i.x+n*m;var j=-(h.y-f.y)/i.y+n*p;return{cell:m,row:p,left:g,top:j,res:i,tsize:n}}})})(typeof exports!=="undefined"?exports:this);(function(b){var c=geomap.util.object.extend;var a=geomap.Point;if(!b.geomap){b.geomap={}}if(b.geomap.PaletteLayer){geomap.warn("geomap.Map is already defined.");return}geomap.PaletteLayer=geomap.Class(geomap.Layer,{type:"PaltteLayer",paths:[],drawType:0,fill:true,loopRender:false,_enabled:true,referenceLine:false,group:null,initialize:function(d){this.callSuper("initialize",d);this.on("initLayer",this.OnInitLayer.bind(this))},OnInitLayer:function(){this._map.on("mousedown",this.OnMouseDown.bind(this));this._map.on("mousemove",this.OnMouseMove.bind(this));this._map.on("mouseup",this.OnMouseUp.bind(this));this.transformtion.setOrigin(0,0);this.group=new geomap.shape.Group()},setType:function(d,e){this.drawType=d;if(e!=undefined){this.fill=e}if(this._pathing){this._pathing.setType(this.drawType,this.fill)}},OnMouseDown:function(g){if(!this._enabled){return}var d=g.event,f=g.point;if(d.ctrlKey){eventjs.cancel(d);this._opendraw=true;if(this._palette_drawing){this.fire("draw_point",g)}else{this._palette_drawing=true;this.fire("draw_start",g)}if(!this._pathing||this._pathing===null){this._pathing=new geomap.Path(this._map,{lineDash:[]});this._pathing.setType(this.drawType,this.fill)}}else{this._opendraw=false}},OnMouseMove:function(g){if(!this._enabled){return}var d=g.event,f=g.point;if(this._opendraw){if(!d.ctrlKey){if(this._palette_drawing){this._palette_drawing=false;this.fire("draw_end",g)}}else{if(this._palette_drawing){this.fire("draw_moving",g)}}if(this._pathing){if(!d.ctrlKey){this.PathEnd(g,f)}else{this._pathing.moveTo(f);this.ViewReset()}}}},OnMouseUp:function(g){if(!this._enabled){return}var d=g.event,f=g.point;if(!this._opendraw){this.PathEnd(g,f)}else{if(this._opendraw&&this._pathing){var f=g.point;this._pathing.push(f);this.ViewReset();if(this._pathing.isEnd()){this.PathEnd(g,f)}}}},addGeometry:function(d){this.paths.push(d);this.ViewReset()},clearGeometry:function(){this.paths=[];this.group.clear();this.ViewReset()},PathEnd:function(f,d){if(this._pathing&&this._pathing!=null){this._pathing.end();var h=this._pathing.getJson();if(h.coordinates.length>0){var g=new geomap.shape.Path(this.group,this._pathing.getCoordJson())}this.fire("geometry_change",this.group);this._pathing=null;this.ViewReset()}},OnLoopTime:function(){if(this.loopRender&&(this._canvasScale==1||this._canvasScale==undefined)){this._dragOffset=null;this.ViewReset()}},drawingCanvas:function(d){this.callSuper("drawingCanvas",d);this.drawReferenceLine(d)},ViewReset:function(){var d=this.canvasCtx;if(!this.wheelZoomChanage&&(this._canvasScale==1||this._canvasScale==undefined)){d.clearRect(0,0,this.width,this.height);d.setLineDash([]);this._canvasScale=1;var j=this._map.zoom,g=this._map.getBounds();this.loopRender=false;if(this.paths.length>0){for(var f=0,e=this.paths.length;f<e;f++){var h=this.paths[f];h.render(d);if(h.loopRender){this.loopRender=true}}}this.group.draw(d,this._map);if(this._pathing&&this._pathing!=null){this._pathing.render(d)}this.fire("drawCanvas")}},toggleReferenceLine:function(){this.toggle("referenceLine");this.fire("drawCanvas")},drawReferenceLine:function(f){if(!this.referenceLine){return}var e=this.width,j=this.height,l=20;f.strokeStyle="rgba(66, 66, 66, 0.3)";f.beginPath();for(var g=0;g<e;g++){var d=g*l,k=0;f.moveTo(d,k);f.lineTo(d,j)}for(var g=0;g<j;g++){var k=g*l,d=0;f.moveTo(d,k);f.lineTo(e,k)}f.stroke();l=10;f.strokeStyle="rgba(224, 224, 224, 0.3)";f.beginPath();for(var g=0;g<e;g++){var d=g*l,k=0;f.moveTo(d,k);f.lineTo(d,j)}for(var g=0;g<j;g++){var k=g*l,d=0;f.moveTo(d,k);f.lineTo(e,k)}f.stroke()}})})(typeof exports!=="undefined"?exports:this);(function(c){if(!c.geomap){c.geomap={}}if(c.geomap.FeatureLayer){geomap.warn("geomap.Map is already defined.");return}var d=geomap.util.object.extend;var b=geomap.Point;var a=geomap.Feature;geomap.FeatureLayer=geomap.Class(geomap.Layer,{type:"FeatureLayer",features:[],drawType:0,fill:true,loopRender:false,_enabled:true,drawOptions:{},initialize:function(e){this.callSuper("initialize",e);this.on("initLayer",this.OnInitLayer.bind(this))},OnInitLayer:function(){this.transformtion.setOrigin(0,0);this._map.on("animated",this.AnimatedTag.bind(this))},AnimatedTag:function(){this.loopRender=true},setType:function(e,f){this.drawType=e;if(f!=undefined){this.fill=f}if(this._pathing){this._pathing.setType(this.drawType,this.fill)}},setFeatures:function(j,g){this.clearData();this.drawOptions=g||{};if(typeof j=="array"){for(var h=0,f=j.length;h<f;h++){this.features.push(new a(j,this._map))}}else{if(typeof j=="object"){if(j.type&&j.type==="FeatureCollection"){var e=j.features.length;for(var h=0;h<e;h++){this.features.push(new a(j.features[h],this._map))}}else{this.features.push(new a(j,this._map))}}}this.ViewReset()},clearData:function(){if(this.features){this.features.forEach(function(f,e,g){})}this.features=[]},clear:function(){this.clearData();this.ViewReset()},OnLoopTime:function(){if(this.loopRender&&(this._canvasScale==1||this._canvasScale==undefined)){this._dragOffset=null;this.loopRender=false;this.ViewReset()}},ViewReset:function(){if(!this.wheelZoomChanage&&(this._canvasScale==1||this._canvasScale==undefined)){this.canvasCtx.clearRect(0,0,this.width,this.height);this._canvasScale=1;var h=this._map.zoom;for(var g=0,e=this.features.length;g<e;g++){var f=this.features[g];f.draw(this.canvasCtx,this.drawOptions)}this.fire("drawCanvas")}}})})(typeof exports!=="undefined"?exports:this);(function(){var b=geomap.util.toPoint;var a={x:100,y:100,vx:5,vy:2,radius:50,color:"#e57373a8",drawType:0,times:0,setMap:function(c){this._map=c;this._play=false;this._map.on("drawingCanvas",this.draw.bind(this));this._radius=0;this._dashOffset=1},play:function(f){this._radius=0;this._play=true;this._alpha=0;this.drawType=0;this.times=2,geomap.debug("====Ball do play.");if(this._coords){this._coords.forEach(function(j,i,k){delete j;k[i]=null});this._coords=[]}else{this._coords=[]}if(f!=undefined){var e=f.feature;if(e!=undefined&&e.geometry&&e.geometry.type=="Polygon"){var h=e.geometry.coordinates;if(h&&h.length>0){var g=h[0];for(var d=0,c=g.length;d<c;d++){this._coords.push(b(g[d]))}this.drawType=1}}}},drawPolygon:function(e){if(this.times>0){var g=this._coords;if(g.length>0){var d=this._map,c=g.length;e.beginPath();e.lineWidth=3;e.setLineDash([15,4]);e.lineDashOffset=(this._dashOffset+=1);var k=d.coordToScreen(g[0]);e.moveTo(k.x,k.y);for(var f=1;f<c;f++){var j=g[f];var h=d.coordToScreen(j);e.lineTo(h.x,h.y)}e.closePath();e.strokeStyle="rgba(255,87,34,"+this._alpha+")";e.stroke();e.lineWidth=1;this._alpha+=0.1;if(this._alpha<1){d.draw()}else{this._alpha=0;this.times-=1}}}},drawPoint:function(e){if(this.times>0){var d=this._map,g,c=d.center;var f=d.coordToScreen(c).round();this.x=f.x,this.y=f.y;if(this._radius<this.radius){this._radius+=1;g=this._radius;var h=(this.radius-g)/this.radius;e.beginPath();e.arc(this.x,this.y,g,0,Math.PI*2,true);e.closePath();e.fillStyle="rgba(33, 150, 243,"+h+")";e.fill();d.draw()}else{this.times-=1}}},drawLock:function(e){if(this.times>0){var d=this._map,g,c=d.center;var f=d.coordToScreen(c).round();this.x=f.x,this.y=f.y;if(this._radius<this.radius){this._radius+=1;g=this._radius;var h=(this.radius-g)/this.radius;e.beginPath();e.arc(this.x,this.y,g,0,Math.PI*2,true);e.closePath();e.fillStyle="rgba(33, 150, 243,"+h+")";e.fill();d.draw()}else{this.drawText(e,f)}}},draw:function(c){if(this.times>0){switch(this.drawType){case 1:this.drawPolygon(c);break;default:this.drawPoint(c)}}},drawText:function(l,i){if(this._alpha<=1){var e=100,d=-100,k=i.x,j=i.y,h=i.x+e,g=i.y+d,c=4,f=100;l.beginPath();l.moveTo(k,j);l.arc(k,j,c,0,Math.PI*2,true);l.closePath();l.fillStyle="rgba(103 ,58,183,"+this._alpha+")";l.fill();l.strokeStyle="rgba(103 ,58,183,"+this._alpha+")";l.lineWidth=2;l.beginPath();l.setLineDash([15,4]);l.moveTo(k,j);l.lineTo(h,g);l.lineTo(h+f,g);l.stroke();this._alpha+=0.1;if(this._alpha<1){this._map.draw()}}else{this.times-=1}}};geomap.Ball=a})();(function(a){if(!a.MapProject){a.MapProject={}}if(a.MapProject.Icons){geomap.warn("MapProject.ICON is already defined.");return}MapProject.Icons={refLine:'<svg t="1619677851087" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="19960" width="12" height="12"><path d="M277.333333 1024c-11.797333 0-21.333333-9.557333-21.333333-21.333333L256 21.333333c0-11.776 9.536-21.333333 21.333333-21.333333s21.333333 9.557333 21.333333 21.333333l0 981.333333C298.666667 1014.442667 289.130667 1024 277.333333 1024z" p-id="19961"></path><path d="M512 1024c-11.797333 0-21.333333-9.557333-21.333333-21.333333L490.666667 21.333333c0-11.776 9.536-21.333333 21.333333-21.333333s21.333333 9.557333 21.333333 21.333333l0 981.333333C533.333333 1014.442667 523.797333 1024 512 1024z" p-id="19962"></path><path d="M746.666667 1024c-11.797333 0-21.333333-9.557333-21.333333-21.333333L725.333333 21.333333c0-11.776 9.536-21.333333 21.333333-21.333333s21.333333 9.557333 21.333333 21.333333l0 981.333333C768 1014.442667 758.464 1024 746.666667 1024z" p-id="19963"></path><path d="M1002.666667 298.666667 21.333333 298.666667c-11.797333 0-21.333333-9.557333-21.333333-21.333333s9.536-21.333333 21.333333-21.333333l981.333333 0c11.797333 0 21.333333 9.557333 21.333333 21.333333S1014.464 298.666667 1002.666667 298.666667z" p-id="19964"></path><path d="M1002.666667 533.333333 21.333333 533.333333c-11.797333 0-21.333333-9.557333-21.333333-21.333333s9.536-21.333333 21.333333-21.333333l981.333333 0c11.797333 0 21.333333 9.557333 21.333333 21.333333S1014.464 533.333333 1002.666667 533.333333z" p-id="19965"></path><path d="M1002.666667 768 21.333333 768c-11.797333 0-21.333333-9.557333-21.333333-21.333333s9.536-21.333333 21.333333-21.333333l981.333333 0c11.797333 0 21.333333 9.557333 21.333333 21.333333S1014.464 768 1002.666667 768z" p-id="19966"></path></svg>',layerInfo:'<svg t="1619426085418" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1848" width="12" height="12"><path d="M512 78.769231l433.230769 315.076923-433.230769 315.076923L78.769231 393.846154 512 78.769231z m352 492.307692L945.230769 630.153846 512 945.230769 78.769231 630.153846l81.230769-59.076923L512 827.076923l352-256z" fill="#333333" p-id="1849"></path></svg>',query:'<svg t="1619668960772" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1404" width="12" height="12"><path d="M654.1 608.9c20.4-24.7 37-52.1 49.5-81.7 17.3-40.9 26.1-84.4 26.1-129.1s-8.8-88.2-26.1-129.1c-16.7-39.5-40.6-75-71.1-105.4-30.5-30.5-65.9-54.4-105.4-71.1C486.2 75 442.8 66.2 398 66.2S309.8 75 268.8 92.3c-39.5 16.7-75 40.6-105.4 71.1-30.5 30.5-54.4 65.9-71.1 105.4-17.3 41-26.1 84.4-26.1 129.2s8.8 88.2 26.1 129.1c16.7 39.5 40.6 75 71.1 105.4 30.5 30.5 65.9 54.4 105.4 71.1 40.9 17.3 84.4 26.1 129.1 26.1s88.2-8.8 129.1-26.1c29.7-12.5 57-29.2 81.7-49.5l296.8 296.8 22.6-22.6 22.6-22.6-296.6-296.8zM665.8 398c0 147.6-120.1 267.8-267.8 267.8-147.6 0-267.8-120.1-267.8-267.8 0-147.6 120.1-267.8 267.8-267.8 147.6 0 267.8 120.1 267.8 267.8z" p-id="1405"></path></svg>',queryRect:'<svg t="1619669003834" class="icon" viewBox="0 0 1170 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="12" height="12"><path d="M550.4 268.8c155.52 0 281.6 126.08 281.6 281.6 0 63.9104-21.2992 122.8544-57.1776 170.112l103.3472 103.3472a38.4 38.4 0 0 1-52.4672 56.0384l-1.8432-1.728-103.3344-103.3472A280.3584 280.3584 0 0 1 550.4 832c-155.52 0-281.6-126.08-281.6-281.6s126.08-281.6 281.6-281.6z m0 76.8c-113.1136 0-204.8 91.6864-204.8 204.8s91.6864 204.8 204.8 204.8 204.8-91.6864 204.8-204.8-91.6864-204.8-204.8-204.8z" fill="#2c2c2c" p-id="1731"></path><path d="M806.4 0a89.6 89.6 0 0 1 89.5488 86.528L896 89.6v145.0624a38.4 38.4 0 0 1-76.736 2.2656L819.2 234.6624V89.6a12.8 12.8 0 0 0-11.3024-12.7104L806.4 76.8H89.6a12.8 12.8 0 0 0-12.7104 11.3024L76.8 89.6v716.8a12.8 12.8 0 0 0 11.3024 12.7104L89.6 819.2h120.2432a38.4 38.4 0 0 1 2.2528 76.736l-2.2528 0.064H89.6a89.6 89.6 0 0 1-89.5488-86.528L0 806.4V89.6a89.6 89.6 0 0 1 86.528-89.5488L89.6 0h716.8z" fill="#2c2c2c" p-id="1732"></path></svg>',query2:'<svg t="1619677276831" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3496" width="12" height="12"><path d="M910.1312 102.912h-195.4304a33.4336 33.4336 0 0 0 0 66.816h162.0992V331.776a33.4336 33.4336 0 0 0 66.816 0V136.192a33.536 33.536 0 0 0-33.4848-33.3824zM136.6528 365.1584c18.432 0 33.4336-15.0016 33.4336-33.3824V169.728h162.0992a33.4336 33.4336 0 0 0 0-66.8672H136.6528a33.4336 33.4336 0 0 0-33.3824 33.4336V331.776c0 18.432 14.848 33.3824 33.3824 33.3824z m195.4304 534.784H170.0864v-162.0992a33.4336 33.4336 0 0 0-66.816 0v195.5328c0 18.432 15.0016 33.4336 33.3824 33.4336h195.5328a33.4336 33.4336 0 1 0-0.1024-66.8672z m578.048-195.4816a33.4336 33.4336 0 0 0-33.4336 33.3824v162.0992H714.752a33.4336 33.4336 0 0 0 0 66.8672h195.5328c18.432 0 33.3824-15.0016 33.3824-33.4336v-195.5328a33.536 33.536 0 0 0-33.4848-33.3824z m-141.312 100.2496a33.3312 33.3312 0 0 0 23.04-57.6l-84.224-80.384a245.248 245.248 0 1 0-445.7472-156.16 245.3504 245.3504 0 0 0 400.3328 205.1584l83.5072 79.7184a33.28 33.28 0 0 0 23.0912 9.216z m-83.8656-267.6224a177.92 177.92 0 0 1-56.1664 119.1424 177.5616 177.5616 0 0 1-133.2736 47.8208 177.3056 177.3056 0 0 1-122.7776-60.1088 177.7664 177.7664 0 0 1-44.288-129.28 177.92 177.92 0 0 1 56.1664-119.1424 177.5616 177.5616 0 0 1 133.12-47.8208c47.6672 2.9696 91.1872 24.32 122.8288 60.16 31.6928 35.6864 47.4112 81.6128 44.3904 129.2288z" p-id="3497"></path></svg>',draw:'<svg t="1619677506373" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="13383" width="12" height="12"><path d="M942.654832 687.605483L519.250636 435.700243c-15.44783-9.18929-25.37697-2.171456-22.100344 15.59007l90.028433 487.136729c3.28379 17.756409 14.403035 20.215414 24.74252 5.442966 0 0 57.520041-82.45699 104.696504-132.795469l90.49813 134.79194c8.637728 12.8384 26.065655 16.188704 38.752606 7.466042l30.379915-20.999267c12.669554-8.740058 15.966647-26.434046 7.351431-39.299051l-90.458221-134.697795c60.47842-25.067932 145.927557-46.214555 145.927557-46.214555 17.426905-4.300956 19.038612-15.331173 3.585665-24.51637z" fill="" p-id="13384"></path><path d="M511.999488 887.554398l-0.290619 0.167822-324.629565-187.749058 0.288573-375.021255L512.290107 137.688919l324.629565 187.759291-0.185218 250.299673h64.100924l0.210801-287.259446L512.344343 63.671135 123.294582 287.893896l-0.342807 449.039039 388.702859 224.808093 0.344854-0.198522z" fill="" p-id="13385"></path></svg>'}})(typeof exports!=="undefined"?exports:this);var MapProject=MapProject||{version:"1.0.0"};if(typeof exports!=="undefined"){exports.MapProject=MapProject}else{if(typeof define==="function"&&define.amd){define([],function(){return MapProject})}}(function(e){if(!e.MapProject){e.MapProject={}}if(e.MapProject.Map){geomap.warn("MapProject.Map is already defined.");return}var f=geomap.util,a=geomap.request,d=f.template,b=f.toPoint;var g=f.object.extend;var c=geomap.Point;MapProject.Map=geomap.Class(geomap.Map,{mapId:undefined,server:{project:"",mapInfo:"",display:"",tile:"",addLayer:"",deleteLayer:"",orderChange:"",addParking:"",queryParking:"",deleteParking:"",},_server:{},_server_layers:[],codeOk:0,reqHead:{},_mapInfo:{},_projectMap:[],_init_map_status:false,drawType:"Rect",mapQuery:null,mapDraw:null,title:"",initialize:function(h,i){var j;if(typeof h==="string"){j=document.getElementById(h)}else{j=h}this.callSuper("initialize",j,i);this._init_reqcb();this._init_fireEv();this._reset_map_conf();this.loadProject()},_init_reqcb:function(){this._clearDrawGeometry=this.clearDrawGeometry.bind(this);this._drawMapGeom=this.__drawMapGeom.bind(this);this._queryCoordData=this.__queryCoordData.bind(this);this._reqcb_queryCoordData=this.__reqcb_queryCoordData.bind(this);this._reqcb_loadProject=this.__reqcb_loadProject.bind(this);this._reqcb_loadServerLayers=this.__reqcb_loadServerLayers.bind(this)},_init_fireEv:function(){this.on("req_project_ok",this._reqcb_loadProject_ok.bind(this))},loadProject:function(){a(this._server.project,{method:"POST",header:this.reqHead,onComplete:this._reqcb_loadProject});this.loadServerLayers()},__reqcb_loadProject:function(k){var i=k.status;if(i==200){var h=JSON.parse(k.response);if(h.code===this.codeOk){var j=h.data;if(j.projectMap){this._projectMap=j.projectMap}if(j.mapInfo){this._mapInfo=j.mapInfo;this.fire("req_project_ok",j.mapInfo);return}}this.fire("req_project_fail")}else{this.fire("req_error",k)}},_reqcb_loadProject_ok:function(){this.loadMapInfo(this._mapInfo)},_reset_server:function(){var j=this.mapId;for(var i in this.server){var h=this.server[i];this._server[i]=d(h,{mapId:j})}},__queryCoordData:function(j){var i=this.get("mapQuery");if(i){var h=d(i.url,{mapId:this.mapId});a(h,{method:"POST",body:"p="+j,header:this.reqHead,onComplete:this._reqcb_queryCoordData})}},__reqcb_queryCoordData:function(n){var j=n.response,i=n.status;if(i==200){var l=this.get("mapQuery");var m=null;var h=JSON.parse(n.response);if(h.code===this.codeOk){if(l){m={type:"FeatureCollection",features:h.data};l.fire("coord_data",m)}}else{var k=this;this.fire("request_faile",{target:k,result:h,tag:"mapQuery"})}}},__drawMapGeom:function(k){var j=this.get("mapDraw");if(j){var i=this;var h={geometry:k,layer:this.paletteLayer,clearDraw:this._clearDrawGeometry,map:i};j.fire("geom_data",h)}},clearDrawGeometry:function(){this.paletteLayer.clearGeometry()},_reset_map_conf:function(){this._reset_server();if(!this._init_map_status){this._init_map_status=true;var i=new geomap.TileLayer({url:this._server.tile,headers:this.reqHead});this.parkingLayer=i;var k=new geomap.FeatureLayer();this.featrueLayer=k;var j=new geomap.PaletteLayer({drawType:this.drawType});this.paletteLayer=j;j.on("geometry_change",this._drawMapGeom);this.addLayer(i);this.addLayer(k);this.addLayer(j);var h=this._queryCoordData;this.on("pointcoord",function(m){var l=m.coord.x+","+m.coord.y;h(l)});this.on("rectcoord",function(m){var l=m.minx+","+m.miny+","+m.maxx+","+m.maxy;h(l)})}else{this.parkingLayer.url=this._server.tile;this.parkingLayer.refreshCache();this.featrueLayer.clear();this.fire("drawmap")}this.fire("map_complete",this)},loadServerLayers:function(){a(this._server.mapInfo,{method:"POST",header:this.reqHead,onComplete:this._reqcb_loadServerLayers})},__reqcb_loadServerLayers:function(l){var i=l.status;if(i==200){var h=JSON.parse(l.response);if(h.code===this.codeOk){var k=h.data;if(k.layers){this._server_layers=k.layers;this.fire("server_layer_ok",this._server_layers);return}}else{var j=this;this.fire("request_faile",{target:j,result:h,url:this._server.mapInfo,tag:"loadServerLayers"})}this.fire("req_project_fail")}else{this.fire("req_error",l)}},loadMapInfo:function(h){if(h){this._mapInfo=h;this.mapId=h.mapId;this.set("title",h.title);this._reset_map_conf()}this.fire("loadmapinfo_end",h)},mapChange:function(h){if(this._projectMap&&this._projectMap.length>h){var i=this._projectMap[h];this.loadMapInfo(i);this.loadProject()}},orderChangeFn:function(j,h){var i=this;a(this._server.orderChange,{method:"JSON",body:{oldIndex:j,newIndex:h},header:i.reqHead,onComplete:function(m){var k=m.response,l=m.status;if(l==200){i.refresh()}}})},displayServerLayer:function(h,k){var j=this;var i=this._server.displayLayer;a(i,{method:"JSON",body:{layerId:h,display:k},header:j.reqHead,onComplete:function(o){var m=o.response,n=o.status;if(n==200){var l=JSON.parse(m);if(l.code===j.codeOk){j.refresh()}else{j.fire("request_faile",{target:j,result:l,url:i,tag:"displayServerLayer"});alert(l.msg)}}}})},deleteServerLayer:function(h){var j=this;var i=this._server.deleteLayer;a(i,{method:"JSON",body:{id:h},header:j.reqHead,onComplete:function(n){var l=n.response,m=n.status;if(m==200){var k=JSON.parse(l);if(k.code===j.codeOk){j.refresh()}else{j.fire("request_faile",{target:j,result:k,url:i,tag:"deleteServerLayer"});alert(k.msg)}}}})},addServerLayer:function(j){var i=this;var h=this._server.addLayer;a(h,{method:"JSON",body:j,header:i.reqHead,onComplete:function(n){var l=n.response,m=n.status;if(m==200){var k=JSON.parse(l);if(k.code===i.codeOk){i.refresh()}else{i.fire("request_faile",{target:i,result:k,url:h,tag:"addServerLayer"});alert(k.msg)}}}})},setMapQuery:function(h){this.set("mapQuery",h)},setMapDraw:function(h){this.set("mapDraw",h);this.paletteLayer.setType(h.drawType,h.fill)},setFeatures:function(i,h){this.featrueLayer.setFeatures(i,h);this.fire("drawmap")},jsonReq:function(h,k,j,i){var m=d(h,{mapId:this.mapId});if(i===undefined){i={}}var l={method:"JSON",body:k,header:this.reqHead,onComplete:j};g(l,i);a(m,l)},toggleReferenceLine:function(){this.paletteLayer.toggleReferenceLine()},refresh:function(){this.loadProject()}})})(typeof exports!=="undefined"?exports:this);(function(f){if(!f.MapProject){f.MapProject={}}if(f.MapProject.LayerInfo){geomap.warn("MapProject.Menu is already defined.");return}var g=geomap.util,b=geomap.request,e=g.template,c=g.toPoint,a=geomap.element;var h=g.object.extend;var d=geomap.Point;MapProject.LayerInfo=geomap.Class(geomap.CommonMethods,geomap.Observable,{map:undefined,root:undefined,toolBar:undefined,tbOpt:{className:"toolBar"},tbStyle:{width:"100%",height:"50px"},layers:[],menu:undefined,title:"图层信息",type:"layerInfo",id:0,icon:null,initialize:function(i){i||(i={});this.id=+new Date();this.icon=MapProject.Icons.layerInfo;this._setOptions(i);this.root=a.create("div");this.toolBar=a.create("div",this.tbOpt,this.tbStyle);this.tableDiv=a.create("div");this.detailDiv=a.create("div",{},{padding:"20px"});this.root.appendChild(this.toolBar);this.root.appendChild(this.tableDiv);this.root.appendChild(this.detailDiv);this.addToolBar();if(this.map!=undefined){this.setMap(this.map)}},setMap:function(i){this.map=i;this.createMapLayerTable();this.map.on("server_layer_ok",this._loadMapLayer.bind(this))},addToMenu:function(i){this.menu=i;this.menu.on("menu_click",this.menuClick.bind(this));this.menu.addMenu({mapMenu:true,type:this.type,text:this.title,icon:this.icon,id:this.id})},menuClick:function(i){var k=i.menu,j=k.data;if(j.mapMenu&&j.type===this.type&&j.id&&j.id===this.id){if(this.viewFrame){this.viewFrame.show()}else{this.viewFrame=new geomap.view.Frame(document.body,{title:this.title,body:this.getElement(),w:600,h:450,closeType:2})}}},getElement:function(){return this.root},addToolBar:function(){var j=this.editForm.bind(this);var i=a.create("input",{value:"添加",type:"button",className:"btn"});eventjs.add(i,"click",j);this.toolBar.appendChild(i)},_loadMapLayer:function(){this.layers=this.map._server_layers;this.createMapLayerTable()},createMapLayerTable:function(){var v={opt:"操作"};var r=[{text:"删除",tag:"a",id:"delete",style:{cursor:"pointer"}},{text:"显隐",tag:"a",id:"display"}];var m={layerOrder:"序号",layerType:"类型",display:"状态",title:"图层说明",layerSource:"图层源"};var w=document.createElement("thead");var x=document.createElement("tr");for(var y in m){var n=document.createElement("td");n.innerText=m[y];x.appendChild(n)}for(var y in v){var n=document.createElement("td");n.innerText=v[y];x.appendChild(n)}w.appendChild(x);var s=document.createElement("tbody");if(this.layers!=undefined&&this.layers.length>0){for(var q=0,o=this.layers.length;q<o;q++){var u=this.layers[q];var x=document.createElement("tr");for(var y in m){var n=document.createElement("td");n.innerText=u[y];x.appendChild(n)}if(r.length>0){var n=document.createElement("td");x.appendChild(n);for(var p=0,t=r.length;p<t;p++){var z=r[p];var l=a.create(z.tag,{},z.style||{paddingLeft:"10px",cursor:"pointer"});l.innerText=z.text;l._rowIndex=q;l._data=z;l._myself=this;eventjs.add(l,"click",function(j,i){eventjs.cancel(j);this.eventFn(j,i)}.bind(this));n.appendChild(l)}}s.appendChild(x)}}if(!this.table){this.table=document.createElement("table");eventjs.add(this.table,"drag",this.dragTableEvent.bind(this));eventjs.add(this.table,"mouseOver",this.mouseOverEvent.bind(this));this.tableDiv.appendChild(this.table)}this.table.innerHTML="";this.table.appendChild(w);this.table.appendChild(s)},dragTableEvent:function(j,t){var o=t.target,m=j.target;if(t.state==="down"){eventjs.cancel(j);var q=m;if(m.nodeName=="TD"){q=m.parentElement||m.parentNode;this._drag_tr=q;this._drag_rowIndex=q.rowIndex}}else{if(t.state==="up"){if(this._drag_on_tr&&this._drag_tr!=undefined){if(this._drag_on_tr.rowIndex==this._drag_rowIndex){}else{if(this._drag_tr.querySelectorAll){var s=this._drag_tr.querySelectorAll("td");this.table.deleteRow(this._drag_rowIndex);var u=null;var p=this._drag_rowIndex;var r=this._drag_on_tr.rowIndex;if(this._drag_rowIndex<this._drag_on_tr.rowIndex){r+=1;u=this.table.insertRow(r)}else{u=this.table.insertRow(r)}for(var n=0,l=s.length;n<l;n++){u.appendChild(s[n])}this.orderChangeFn(p-1,r-1)}}}this._drag_tr=undefined}}},mouseOverEvent:function(q,n){var j=q.target;var p=j;if(j.nodeName=="TD"){p=j.parentElement||j.parentNode;this._drag_on_tr=p;var l=this.table.querySelectorAll("tr.selected");for(var o=0,m=l.length;o<m;o++){var r=l[o];a.removeClass(r,"selected")}if(this._drag_tr){a.addClass(this._drag_on_tr,"selected")}}},editForm:function(){var i=this.addLayerFn.bind(this);var j={name:"车位",id:"form_edit_parking",properties:[{id:"title",type:"text",title:"图层说明",value:"",required:false},{id:"layerSource",type:"text",title:"数据源",value:"",required:false},{id:"layerType",type:"radio",title:"类型",value:"POLYGON",option:{POLYGON:"面",POINT:"点",RASTER:"栅格图    "},required:false},{id:"display",type:"radio",title:"状态",value:"1",option:{"1":"可见","2":"不可见"},required:true},{id:"styleId",type:"text",title:"样式编号",value:"parking_polygon",required:true}],buttons:[{title:"确定",type:"button",value:"确定",click:i}]};var k=a.parseToForm(j);this.addFormEl=k;this.detailDiv.innerHTML="";this.detailDiv.appendChild(k)},orderChangeFn:function(k,i){var j=this;j.map.orderChangeFn(k,i)},addLayerFn:function(){var j=a.formToJson(this.addFormEl);var i=this;i.map.addServerLayer(j)},eventFn:function(j,r){var k=r.target,q=k._myself,l=k._data,o=k._rowIndex;if(l.id=="delete"){var m=typeof o==="string"?Number(o):o;if(q.layers.length>m){var n=q.layers[m];q.map.deleteServerLayer(n.id)}}else{if(l.id=="display"){var m=typeof o==="string"?Number(o):o;if(q.layers.length>m){var n=q.layers[m];var p=n.display==1?0:1;q.map.displayServerLayer(n.id,p)}}}},})})(typeof exports!=="undefined"?exports:this);(function(f){if(!f.MapProject){f.MapProject={}}if(f.MapProject.Menu){geomap.warn("MapProject.Menu is already defined.");return}var g=geomap.util,b=geomap.request,e=g.template,c=g.toPoint,a=geomap.element;var h=g.object.extend;var d=geomap.Point;MapProject.Menu=geomap.Class(geomap.CommonMethods,geomap.Observable,{map:undefined,container:undefined,toolBar:undefined,tbOpt:{className:"menu-nav"},tbStyle:{},memuOpt:{className:"menu-item"},menu:[],mapmenu:[{mapMenu:true,type:"reference_line",icon:MapProject.Icons.refLine,text:"参考线",id:"map_reference_Line"}],_mapmenu:[],initialize:function(i,j){j||(j={});this._setOptions(j);if(typeof i==="string"){this.container=document.getElementById(i)}else{this.container=i}this.toolBar=a.create("ul",this.tbOpt,this.tbStyle);eventjs.add(this.toolBar,"click",this._ev_menu_item);this.container.appendChild(this.toolBar);this._init_handle_ev();if(this.map!=undefined){this.setMap(this.map)}this._init_menu()},_init_handle_ev:function(){this._init_map_menu=this.__init_map_menu.bind(this)},setMap:function(i){this.map=i;this.__init_map_menu();this.map.on("map_complete",this._init_map_menu)},addMenu:function(i){this.menu.push(i);this.__init_map_menu()},__init_map_menu:function(){this._mapmenu=[];var j=this.mapmenu;for(var o=0,n=j.length;o<n;o++){var p=j[o];this._mapmenu.push(p)}if(this.map&&this.map._projectMap){var l=this.map._projectMap;for(var o=0,n=l.length;o<n;o++){var r=l[o];var q="map_"+o;this._mapmenu.push({mapMenu:true,type:"layer",id:q,text:r.subTitle,layerIndex:o})}}this._init_menu()},_init_menu:function(){this.toolBar.innerHTML="";for(var l=0,j=this._mapmenu.length;l<j;l++){var n=this._mapmenu[l];var m=this._create_menu_item(n);this.toolBar.appendChild(m)}for(var l=0,j=this.menu.length;l<j;l++){var n=this.menu[l];var m=this._create_menu_item(n);this.toolBar.appendChild(m)}},_create_menu_item:function(m){var j=a.create("li",this.memuOpt);var k=a.create("a");var i="";if(m.icon!=undefined&&m.icon!=""){i=m.icon}if(!m.onlyIcon){i+=("&nbsp;"+m.text)}k.innerHTML=i;var l=this;j.__menu_item=true;j._data={data:m,target:l};j.appendChild(k);return j},_ev_menu_item:function(k,i){var m=k.target;if(m!=undefined){var n=m;while(n.__menu_item==undefined&&n.nodeName!="BODY"){n=n.parentElement||n.parentNode}if(n._data&&n._data.target&&n._data.target._ev_menu_map(n._data)){var j=n._data.target;var l={event:k,self:i,menu:{target:n,data:n._data.data,self:j}};j.fire("menu_click",l)}}},_ev_menu_map:function(j){var i=true,k=j.target,l=j.data;if(k&&k.map&&l.id){if(l.mapMenu){if(l.type==="layer"){if(l.layerIndex!=undefined){k.map.mapChange(l.layerIndex);i=false}}else{if(l.type==="reference_line"){k.map.toggleReferenceLine();i=false}}}}return i}})})(typeof exports!=="undefined"?exports:this);(function(f){if(!f.MapProject){f.MapProject={}}if(f.MapProject.MapQuery){geomap.warn("MapProject.MapQuery is already defined.");return}var g=geomap.util,b=geomap.request,e=g.template,c=g.toPoint,a=geomap.element;var h=g.object.extend;var d=geomap.Point;MapProject.MapQuery=geomap.Class(geomap.CommonMethods,geomap.Observable,{type:"MapQuery",id:0,title:"查询结果",icon:null,onlyIcon:false,url:undefined,root:undefined,width:600,height:400,tbOpt:{},tbStyle:{width:"100%"},map:undefined,table:undefined,buttons:[{text:"删除",tag:"a",style:{cursor:"pointer"}}],menu:undefined,geomOption:{},initialize:function(i){i||(i={});this.id=+new Date();this._setOptions(i);this.root=a.create("div");this._eventFn=this.eventFn.bind(this);this.on("coord_data",this.coord_data.bind(this))},addToMenu:function(i){this.menu=i;this.menu.on("menu_click",this.menuClick.bind(this));this.menu.addMenu({mapMenu:true,type:this.type,text:this.title,icon:this.icon,id:this.id,onlyIcon:this.onlyIcon})},menuClick:function(i){var k=i.menu,j=k.data;if(j.mapMenu&&j.type===this.type&&j.id&&j.id===this.id){this.map.setMapQuery(this)}},coord_data:function(i){this.viewData(i);this.showFrame()},viewData:function(n){var y=[],t=null;if(!this.table){this.table=a.create("table",this.tbOpt,this.tbStyle);this.root.appendChild(this.table)}this.table.innerHTML="";this.map.setFeatures([],this.geomOption);if(n&&n.type=="FeatureCollection"){var r=n.features.length;for(var C=0;C<r;C++){var s=n.features[C];var v=s.properties;var o=s.id.split(".");if(o.length>1){v.id=o[1]}else{v.id=s.id}y.push(v)}t=n.features}else{if(n.type=="Feature"){var v=n.properties;var o=n.id.split(".");if(o.length>1){v.id=o[1]}else{v.id=n.id}y.push(v);t=[n]}}if(y.length>0){if(n&&n.type=="FeatureCollection"){this.map.setFeatures(n,this.geomOption)}var F=this.table;var E=a.create("thead");F.appendChild(E);var x=a.create("tr");E.appendChild(x);for(var G in y[0]){var u=a.create("th");u.innerText=G;x.appendChild(u)}if(this.buttons.length>0){var z=a.create("th");z.innerText="操作";x.appendChild(z)}var m=a.create("tbody");F.appendChild(m);for(var C=0,A=y.length;C<A;C++){var p=a.create("tr");m.appendChild(p);for(var G in y[0]){var u=a.create("td");y[C][G]!=undefined?(u.innerText=y[C][G]):"";p.appendChild(u)}if(this.buttons.length>0){var w=a.create("td");p.appendChild(w);for(var B=0,D=this.buttons.length;B<D;B++){var l=this.buttons[B];var q=a.create(l.tag,l.opt||{},l.style||{});q.innerText=l.text;q._data=y[C];q._features=t[C];q.self=l;eventjs.add(q,"click",this._eventFn);w.appendChild(q)}}}}},eventFn:function(l,i){var n=i.target,m=n._data,k=n.self;console.log("td===,id="+m.parking_id);if(k&&k.fn){var j={data:m,self:k,target:n,features:n._features};k.fn(l,j)}},removeRow:function(i){var j=i;while(j&&j.tagName.toString()!="TR"&&j.tagName.toString()!="tr"){j=j.parentElement||j.parentNode}if(j&&j.tagName=="TR"){j.remove()}},showFrame:function(){if(this.viewFrame){this.viewFrame.show()}else{this.viewFrame=new geomap.view.Frame(document.body,{title:this.title,body:this.root,w:this.width,h:this.height,closeType:2,pos:"rc"})}}})})(typeof exports!=="undefined"?exports:this);(function(f){if(!f.MapProject){f.MapProject={}}if(f.MapProject.MapDraw){geomap.warn("MapProject.MapDraw is already defined.");return}var g=geomap.util,b=geomap.request,e=g.template,c=g.toPoint,a=geomap.element;var h=g.object.extend;var d=geomap.Point;MapProject.MapDraw=geomap.Class(geomap.CommonMethods,geomap.Observable,{type:"MapDraw",id:0,title:"绘图",icon:null,onlyIcon:false,url:undefined,root:undefined,toolEl:undefined,formEl:undefined,width:600,height:400,tbOpt:{},tbStyle:{width:"100%"},map:undefined,table:undefined,drawType:"Rect",fill:true,buttons:[{text:"删除",tag:"a",style:{cursor:"pointer"}}],form:{},menu:undefined,initialize:function(j){j||(j={});this.set("id",+new Date());this._setOptions(j);this._saveGeomEv=this.saveGeomEv.bind(this);this._closeFrameEv=this.closeFrameEv.bind(this);this.root=a.create("div");this.on("geom_data",this.geomDataCallback.bind(this));var i=a.create("div",{className:"tooldiv"},{margin:"20px"});this.toolEl=i;this.formEl=a.create("div");this.root.appendChild(this.toolEl);this.root.appendChild(this.formEl);this.creatTools()},creatTools:function(){var p={width:"80px"};var o=a.create("input",{type:"text",id:"tool_xnum"},p);var r=a.create("input",{type:"text",id:"tool_ynum"},p);var j=a.create("input",{type:"text",id:"tool_pnum"},p);var i=a.create("input",{type:"button",value:"确定",id:"tool_btn"},{marginLeft:"10px"});this.geomInfoDiv=a.create("div",{},{color:"gray"});this._xnumEl=o;this._ynumEl=r;this._pnumEl=j;var l={display:"initial"};var m=a.create("div",{},l);m.innerHTML="拆分矩行操作<br>";var k=a.create("div",{},l);k.innerText="水平:";var n=a.create("div",{},l);n.innerText="垂直:";var q=a.create("div",{},l);q.innerText="间距:";this.toolEl.appendChild(m);this.toolEl.appendChild(k);this.toolEl.appendChild(o);this.toolEl.appendChild(n);this.toolEl.appendChild(r);this.toolEl.appendChild(q);this.toolEl.appendChild(j);this.toolEl.appendChild(i);this.toolEl.appendChild(this.geomInfoDiv);eventjs.add(i,"click",this.editGeometry.bind(this))},editGeometry:function(){if(this._group){var j=this._xnumEl.value;var i=this._ynumEl.value;var l=this._pnumEl.value;var k=this.map.transform(new d(l,l),1);this._group.split(Number(j),Number(i),k);this.map.drawMap()}},addToMenu:function(i){this.menu=i;this.menu.on("menu_click",this.menuClick.bind(this));this.menu.addMenu({mapMenu:true,type:this.type,text:this.title,icon:this.icon,onlyIcon:this.onlyIcon,id:this.id})},menuClick:function(i){var k=i.menu,j=k.data;if(j.mapMenu&&j.type===this.type&&j.id&&j.id===this.id){this.map.setMapDraw(this)}},closeFrameEv:function(j,i){this.map.clearDrawGeometry()},saveGeomEv:function(){if(this.form&&this.form.id&&this._group){var p=a.formToJson(document.getElementById(this.form.id));var t=this._group.getData();var j=null;if(t.length==0){return}var n="";for(var s in p){if(s==="id"){n=p[s];delete p[s]}}var q=[],l=Number(n);for(var o=0,m=t.length;o<m;o++){var j=JSON.stringify(t[o]);q.push({geometry:j,properties:p,id:l});l+=1}var r=this;r.map.jsonReq(this.url,q,function(v){var k=v.response,u=v.status;if(u==200){var i=JSON.parse(k);if(i.code===r.map.codeOk){r.map.clearDrawGeometry();r.map.refresh();r.hideFrame()}else{alert(i.msg)}}})}},getViewForm:function(){var i=this.form;var k=i.id;i.buttons=[{id:"ok",type:"button",title:"",value:"确定",click:this._saveGeomEv}];var j=a.parseToForm(i);this.formEl.appendChild(j);return this.root},geomDataCallback:function(i){var l=i.geometry;this._group=l;var j=this._group.getSize();if(j>0){if(this._group.getPaths().length==1){var k=this._group.getPaths()[0].bounds().getSize();this.geomInfoDiv.innerText="Size="+k.x+","+k.y}this.showFrame()}},showFrame:function(){if(this.viewFrame){this.viewFrame.show()}else{this.viewFrame=new geomap.view.Frame(document.body,{title:this.title,body:this.getViewForm(),w:this.width,h:this.height,closeType:2});this.viewFrame.on("hide",this._closeFrameEv)}},hideFrame:function(){if(this.viewFrame){this.viewFrame.hide()}}})})(typeof exports!=="undefined"?exports:this);(function(f){if(!f.MapProject){f.MapProject={}}if(f.MapProject.DataListFrame){geomap.warn("MapProject.MapQuery is already defined.");return}var g=geomap.util,b=geomap.request,e=g.template,c=g.toPoint,a=geomap.element;var h=g.object.extend;var d=geomap.Point;MapProject.DataListFrame=geomap.Class(geomap.CommonMethods,geomap.Observable,{type:"DataListFrame",id:100,title:"数据列表",icon:null,onlyIcon:false,url:undefined,root:undefined,width:200,height:400,framePos:"rb",tbOpt:{className:"datalist"},tbStyle:{width:"100%"},map:undefined,table:undefined,buttons:[],paramData:{},headColumn:[],menu:undefined,elOpt:{className:"datalist"},elStyle:{},geomOption:{style:{fillStyle:"rgba(0,0,200,0.5)",strokeStyle:"#fff",lineWidth:2},_fill:true,lineDash:[4,2]},initialize:function(i){i||(i={});this.id=+new Date();this._setOptions(i);this.root=a.create("div",this.elOpt,this.elStyle);this._eventFn=this.eventFn.bind(this)},addToMenu:function(i){this.menu=i;this.menu.on("menu_click",this.menuClick.bind(this));this.menu.addMenu({mapMenu:true,type:this.type,text:this.title,icon:this.icon,id:this.id,onlyIcon:this.onlyIcon})},menuClick:function(i){var l=i.menu,k=l.data;if(k.mapMenu&&k.type===this.type&&k.id&&k.id===this.get("id")){var j=this;j.map.jsonReq(this.url,this.paramData,function(n){if(n.status==200){var m=JSON.parse(n.response);if(m.code===j.map.codeOk){j.showData(m.data)}else{alert(m.msg)}}})}},showData:function(i){this.viewData(i);this.showFrame()},viewData:function(E){var u=E,q=null;if(!this.table){this.table=a.create("table",this.tbOpt,this.tbStyle);this.root.appendChild(this.table)}this.table.innerHTML="";if(E&&this.headColumn.length>0){var p=[];for(var z=0,x=this.headColumn.length;z<x;z++){var D=h({text:"",type:"text",fn:null,id:""},this.headColumn[z]);p.push(D)}var C=this.table;var B=a.create("thead");C.appendChild(B);var t=a.create("tr");B.appendChild(t);for(var z=0,x=p.length;z<x;z++){var r=a.create("th");r.innerText=p[z].text;t.appendChild(r)}if(this.buttons.length>0){var v=a.create("th");v.innerText="操作";t.appendChild(v)}var m=a.create("tbody");C.appendChild(m);for(var z=0,x=u.length;z<x;z++){var n=a.create("tr");m.appendChild(n);for(var y=0,A=p.length;y<A;y++){var r=a.create("td");if(p[y].type=="fn"){var w=p[y].fn(u[z]);if(typeof w!=undefined){if(typeof w==="string"){r.innerHTML=w}else{r.appendChild(w)}}}else{var F=p[y].id;if(u[z].properties){u[z].properties[F]!=undefined?(r.innerText=u[z].properties[F]):""}else{u[z][F]!=undefined?(r.innerText=u[z][F]):""}}n.appendChild(r)}if(this.buttons.length>0){var s=a.create("td");n.appendChild(s);for(var y=0,A=this.buttons.length;y<A;y++){var l=this.buttons[y];var o=a.create(l.tag,l.opt||{},l.style||{});o.innerText=l.text;o._data=u[z];o._features=q[z];o.self=l;eventjs.add(o,"click",this._eventFn);s.appendChild(o)}}}}},eventFn:function(l,i){var n=i.target,m=n._data,k=n.self;console.log("td===,id="+m.parking_id);if(k&&k.fn){var j={data:m,self:k,target:n,features:n._features};k.fn(l,j)}},removeRow:function(i){var j=i;while(j&&j.tagName.toString()!="TR"&&j.tagName.toString()!="tr"){j=j.parentElement||j.parentNode}if(j&&j.tagName=="TR"){j.remove()}},showFrame:function(){if(this.viewFrame){this.viewFrame.show()}else{this.viewFrame=new geomap.view.Frame(document.body,{title:this.title,body:this.root,w:this.width,h:this.height,closeType:2,pos:this.framePos})}}})})(typeof exports!=="undefined"?exports:this);