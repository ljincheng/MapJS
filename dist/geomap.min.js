var geomap=geomap||{version:"1.0.0"};if(typeof exports!=="undefined"){exports.geomap=geomap}if(typeof document!=="undefined"&&typeof window!=="undefined"){if(document instanceof (typeof HTMLDocument!=="undefined"?HTMLDocument:Document)){geomap.document=document}else{geomap.document=document.implementation.createHTMLDocument("")}geomap.window=window;geomap.log=console.log;geomap.warn=console.warn;geomap.debug=console.log}else{var jsdom=require("jsdom");var virtualWindow=new jsdom.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;geomap.document=virtualWindow.document;geomap.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper;geomap.nodeCanvas=require("jsdom/lib/jsdom/utils").Canvas;geomap.window=virtualWindow;geomap.log=console.log;geomap.warn=console.warn;geomap.debug=console.log;DOMParser=geomap.window.DOMParser}if(typeof document!=="undefined"&&typeof window!=="undefined"){window.geomap=geomap}if(typeof(eventjs)==="undefined"){var eventjs={}}(function(n){n.modifyEventListener=false;n.modifySelectors=false;n.configure=function(s){if(isFinite(s.modifyEventListener)){n.modifyEventListener=s.modifyEventListener}if(isFinite(s.modifySelectors)){n.modifySelectors=s.modifySelectors}if(e===false&&n.modifyEventListener){l()}if(f===false&&n.modifySelectors){o()}};n.add=function(v,t,u,s){return d(v,t,u,s,"add")};n.remove=function(v,t,u,s){return d(v,t,u,s,"remove")};n.returnFalse=function(s){return false};n.stop=function(s){if(!s){return}if(s.stopPropagation){s.stopPropagation()}s.cancelBubble=true;s.cancelBubbleCount=0};n.prevent=function(s){if(!s){return}if(s.preventDefault){s.preventDefault()}else{if(s.preventManipulation){s.preventManipulation()}else{s.returnValue=false}}};n.cancel=function(s){n.stop(s);n.prevent(s)};n.blur=function(){var s=document.activeElement;if(!s){return}var t=document.activeElement.nodeName;if(t==="INPUT"||t==="TEXTAREA"||s.contentEditable==="true"){if(s.blur){s.blur()}}};n.getEventSupport=function(u,t){if(typeof(u)==="string"){t=u;u=window}t="on"+t;if(t in u){return true}if(!u.setAttribute){u=document.createElement("div")}if(u.setAttribute&&u.removeAttribute){u.setAttribute(t,"");var s=typeof u[t]==="function";if(typeof u[t]!=="undefined"){u[t]=null}u.removeAttribute(t);return s}};var q=function(u){if(!u||typeof(u)!=="object"){return u}var s=new u.constructor();for(var t in u){if(!u[t]||typeof(u[t])!=="object"){s[t]=u[t]}else{s[t]=q(u[t])}}return s};var d=function(S,u,v,R,D,N){R=R||{};if(String(S)==="[object Object]"){var U=S;S=U.target;delete U.target;if(U.type&&U.listener){u=U.type;delete U.type;v=U.listener;delete U.listener;for(var V in U){R[V]=U[V]}}else{for(var w in U){var K=U[w];if(typeof(K)==="function"){continue}R[w]=K}var T={};for(var V in U){var w=V.split(",");var H=U[V];var B={};for(var L in R){B[L]=R[L]}if(typeof(H)==="function"){var v=H}else{if(typeof(H.listener)==="function"){var v=H.listener;for(var L in H){if(typeof(H[L])==="function"){continue}B[L]=H[L]}}else{continue}}for(var J=0;J<w.length;J++){T[V]=eventjs.add(S,w[J],v,B,D)}}return T}}if(!S||!u||!v){return}if(typeof(S)==="string"&&u==="ready"){if(window.eventjs_stallOnReady){u="load";S=window}else{var x=(new Date()).getTime();var A=R.timeout;var I=R.interval||1000/60;var O=window.setInterval(function(){if((new Date()).getTime()-x>A){window.clearInterval(O)}if(document.querySelector(S)){window.clearInterval(O);setTimeout(v,1)}},I);return}}if(typeof(S)==="string"){S=document.querySelectorAll(S);if(S.length===0){return b("Missing target on listener!",arguments)}if(S.length===1){S=S[0]}}var M;var s={};if(S.length>0&&S!==window){for(var z=0,G=S.length;z<G;z++){M=d(S[z],u,v,q(R),D);if(M){s[z]=M}}return i(s)}if(typeof(u)==="string"){u=u.toLowerCase();if(u.indexOf(" ")!==-1){u=u.split(" ")}else{if(u.indexOf(",")!==-1){u=u.split(",")}}}if(typeof(u)!=="string"){if(typeof(u.length)==="number"){for(var y=0,E=u.length;y<E;y++){M=d(S,u[y],v,q(R),D);if(M){s[u[y]]=M}}}else{for(var V in u){if(typeof(u[V])==="function"){M=d(S,V,u[V],q(R),D)}else{M=d(S,V,u[V].listener,q(u[V]),D)}if(M){s[V]=M}}}return i(s)}else{if(u.indexOf("on")===0){u=u.substr(2)}}if(typeof(S)!=="object"){return b("Target is not defined!",arguments)}if(typeof(v)!=="function"){return b("Listener is not a function!",arguments)}var Q=R.useCapture||false;var F=c(S)+"."+c(v)+"."+(Q?1:0);if(n.Gesture&&n.Gesture._gestureHandlers[u]){F=u+F;if(D==="remove"){if(!j[F]){return}j[F].remove();delete j[F]}else{if(D==="add"){if(j[F]){j[F].add();return j[F]}if(R.useCall&&!n.modifyEventListener){var P=v;v=function(Y,W){for(var X in W){Y[X]=W[X]}return P.call(S,Y)}}R.gesture=u;R.target=S;R.listener=v;R.fromOverwrite=N;j[F]=n.proxy[u](R)}}return j[F]}else{var t=g(u);for(var J=0,C;J<t.length;J++){u=t[J];C=u+"."+F;if(D==="remove"){if(!j[C]){continue}S[r](u,v,Q);delete j[C]}else{if(D==="add"){if(j[C]){return j[C]}S[m](u,v,Q);j[C]={id:C,type:u,target:S,listener:v,remove:function(){for(var W=0;W<t.length;W++){n.remove(S,t[W],v,R)}}}}}}return j[C]}};var i=function(s){return{remove:function(){for(var t in s){s[t].remove()}},add:function(){for(var t in s){s[t].add()}}}};var b=function(s,t){if(typeof(console)==="undefined"){return}if(typeof(console.error)==="undefined"){return}console.error(s,t)};var p={msPointer:["MSPointerDown","MSPointerMove","MSPointerUp"],touch:["touchstart","touchmove","touchend"],mouse:["mousedown","mousemove","mouseup"]};var h={MSPointerDown:0,MSPointerMove:1,MSPointerUp:2,touchstart:0,touchmove:1,touchend:2,mousedown:0,mousemove:1,mouseup:2};var a=(function(){n.supports={};if(window.navigator.msPointerEnabled){n.supports.msPointer=true}if(n.getEventSupport("touchstart")){n.supports.touch=true}if(n.getEventSupport("mousedown")){n.supports.mouse=true}})();var g=(function(){return function(v){var w=document.addEventListener?"":"on";var s=h[v];if(isFinite(s)){var u=[];for(var t in n.supports){u.push(w+p[t][s])}return u}else{return[w+v]}}})();var j={};var k=0;var c=function(s){if(s===window){return"#window"}if(s===document){return"#document"}if(!s.uniqueID){s.uniqueID="e"+k++}return s.uniqueID};var m=document.addEventListener?"addEventListener":"attachEvent";var r=document.removeEventListener?"removeEventListener":"detachEvent";n.createPointerEvent=function(t,z,s){var w=z.gesture;var x=z.target;var A=t.changedTouches||n.proxy.getCoords(t);if(A.length){var B=A[0];z.pointers=s?[]:A;z.pageX=B.pageX;z.pageY=B.pageY;z.x=z.pageX;z.y=z.pageY}var v=document.createEvent("Event");v.initEvent(w,true,true);v.originalEvent=t;for(var u in z){if(u==="target"){continue}v[u]=z[u]}var y=v.type;if(n.Gesture&&n.Gesture._gestureHandlers[y]){z.oldListener.call(x,v,z,false)}};var e=false;var l=function(){if(!window.HTMLElement){return}var s=function(u){var t=function(v){var x=v+"EventListener";var w=u[x];u[x]=function(B,C,y){if(n.Gesture&&n.Gesture._gestureHandlers[B]){var z=y;if(typeof(y)==="object"){z.useCall=true}else{z={useCall:true,useCapture:y}}d(this,B,C,z,v,true)}else{var A=g(B);for(var D=0;D<A.length;D++){w.call(this,A[D],C,y)}}}};t("add");t("remove")};if(navigator.userAgent.match(/Firefox/)){s(HTMLDivElement.prototype);s(HTMLCanvasElement.prototype)}else{s(HTMLElement.prototype)}s(document);s(window)};var f=false;var o=function(){var s=NodeList.prototype;s.removeEventListener=function(u,w,t){for(var x=0,v=this.length;x<v;x++){this[x].removeEventListener(u,w,t)}};s.addEventListener=function(u,w,t){for(var x=0,v=this.length;x<v;x++){this[x].addEventListener(u,w,t)}}};return n})(eventjs);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.pointerSetup=function(f,e){f.target=f.target||window;f.doc=f.target.ownerDocument||f.target;f.minFingers=f.minFingers||f.fingers||1;f.maxFingers=f.maxFingers||f.fingers||Infinity;f.position=f.position||"relative";delete f.fingers;e=e||{};e.enabled=true;e.gesture=f.gesture;e.target=f.target;e.env=f.env;if(eventjs.modifyEventListener&&f.fromOverwrite){f.oldListener=f.listener;f.listener=eventjs.createPointerEvent}var d=0;var g=e.gesture.indexOf("pointer")===0&&eventjs.modifyEventListener?"pointer":"mouse";if(f.oldListener){e.oldListener=f.oldListener}e.listener=f.listener;e.proxy=function(h){e.defaultListener=f.listener;f.listener=h;h(f.event,e)};e.add=function(){if(e.enabled===true){return}if(f.onPointerDown){eventjs.add(f.target,g+"down",f.onPointerDown)}if(f.onPointerMove){eventjs.add(f.doc,g+"move",f.onPointerMove)}if(f.onPointerUp){eventjs.add(f.doc,g+"up",f.onPointerUp)}e.enabled=true};e.remove=function(){if(e.enabled===false){return}if(f.onPointerDown){eventjs.remove(f.target,g+"down",f.onPointerDown)}if(f.onPointerMove){eventjs.remove(f.doc,g+"move",f.onPointerMove)}if(f.onPointerUp){eventjs.remove(f.doc,g+"up",f.onPointerUp)}e.reset();e.enabled=false};e.pause=function(h){if(f.onPointerMove&&(!h||h.move)){eventjs.remove(f.doc,g+"move",f.onPointerMove)}if(f.onPointerUp&&(!h||h.up)){eventjs.remove(f.doc,g+"up",f.onPointerUp)}d=f.fingers;f.fingers=0};e.resume=function(h){if(f.onPointerMove&&(!h||h.move)){eventjs.add(f.doc,g+"move",f.onPointerMove)}if(f.onPointerUp&&(!h||h.up)){eventjs.add(f.doc,g+"up",f.onPointerUp)}f.fingers=d};e.reset=function(){f.tracker={};f.fingers=0};return e};var b=eventjs.supports;eventjs.isMouse=!!b.mouse;eventjs.isMSPointer=!!b.touch;eventjs.isTouch=!!b.msPointer;a.pointerStart=function(e,r,o){var p=(e.type||"mousedown").toUpperCase();if(p.indexOf("MOUSE")===0){eventjs.isMouse=true;eventjs.isTouch=false;eventjs.isMSPointer=false}else{if(p.indexOf("TOUCH")===0){eventjs.isMouse=false;eventjs.isTouch=true;eventjs.isMSPointer=false}else{if(p.indexOf("MSPOINTER")===0){eventjs.isMouse=false;eventjs.isTouch=false;eventjs.isMSPointer=true}}}var k=function(z,t){var v=o.bbox;var u=h[t]={};switch(o.position){case"absolute":u.offsetX=0;u.offsetY=0;break;case"differenceFromLast":u.offsetX=z.pageX;u.offsetY=z.pageY;break;case"difference":u.offsetX=z.pageX;u.offsetY=z.pageY;break;case"move":u.offsetX=z.pageX-v.x1;u.offsetY=z.pageY-v.y1;break;default:u.offsetX=v.x1-v.scrollLeft;u.offsetY=v.y1-v.scrollTop;break}var i=z.pageX-u.offsetX;var w=z.pageY-u.offsetY;u.rotation=0;u.scale=1;u.startTime=u.moveTime=(new Date()).getTime();u.move={x:i,y:w};u.start={x:i,y:w};o.fingers++};o.event=e;if(r.defaultListener){o.listener=r.defaultListener;delete r.defaultListener}var s=!o.fingers;var h=o.tracker;var n=e.changedTouches||a.getCoords(e);var g=n.length;for(var m=0;m<g;m++){var l=n[m];var f=l.identifier||Infinity;if(o.fingers){if(o.fingers>=o.maxFingers){var d=[];for(var f in o.tracker){d.push(f)}r.identifier=d.join(",");return s}var j=0;for(var q in h){if(h[q].up){delete h[q];k(l,f);o.cancel=true;break}j++}if(h[f]){continue}k(l,f)}else{h=o.tracker={};r.bbox=o.bbox=a.getBoundingBox(o.target);o.fingers=0;o.cancel=false;k(l,f)}}var d=[];for(var f in o.tracker){d.push(f)}r.identifier=d.join(",");return s};a.pointerEnd=function(e,p,n,j){var m=e.touches||[];var h=m.length;var o={};for(var l=0;l<h;l++){var k=m[l];var f=k.identifier;o[f||Infinity]=true}for(var f in n.tracker){var g=n.tracker[f];if(o[f]||g.up){continue}if(j){j({pageX:g.pageX,pageY:g.pageY,changedTouches:[{pageX:g.pageX,pageY:g.pageY,identifier:f==="Infinity"?Infinity:f}]},"up")}g.up=true;n.fingers--}if(n.fingers!==0){return false}var d=[];n.gestureFingers=0;for(var f in n.tracker){n.gestureFingers++;d.push(f)}p.identifier=d.join(",");return true};a.getCoords=function(d){if(typeof(d.pageX)!=="undefined"){a.getCoords=function(e){return Array({type:"mouse",x:e.pageX,y:e.pageY,pageX:e.pageX,pageY:e.pageY,identifier:e.pointerId||Infinity})}}else{a.getCoords=function(e){var f=document.documentElement;e=e||window.event;return Array({type:"mouse",x:e.clientX+f.scrollLeft,y:e.clientY+f.scrollTop,pageX:e.clientX+f.scrollLeft,pageY:e.clientY+f.scrollTop,identifier:Infinity})}}return a.getCoords(d)};a.getCoord=function(f){if("ontouchstart" in window){var e=0;var d=0;a.getCoord=function(g){var h=g.changedTouches;if(h&&h.length){return{x:e=h[0].pageX,y:d=h[0].pageY}}else{return{x:e,y:d}}}}else{if(typeof(f.pageX)!=="undefined"&&typeof(f.pageY)!=="undefined"){a.getCoord=function(g){return{x:g.pageX,y:g.pageY}}}else{a.getCoord=function(g){var h=document.documentElement;g=g||window.event;return{x:g.clientX+h.scrollLeft,y:g.clientY+h.scrollTop}}}}return a.getCoord(f)};var c=function(e,d){var f=parseFloat(e.getPropertyValue(d),10);return isFinite(f)?f:0};a.getBoundingBox=function(g){if(g===window||g===document){g=document.body}var n={};var m=g.getBoundingClientRect();n.width=m.width;n.height=m.height;n.x1=m.left;n.y1=m.top;n.scaleX=m.width/g.offsetWidth||1;n.scaleY=m.height/g.offsetHeight||1;n.scrollLeft=0;n.scrollTop=0;var f=window.getComputedStyle(g);var e=f.getPropertyValue("box-sizing")==="border-box";if(e===false){var h=c(f,"border-left-width");var l=c(f,"border-right-width");var d=c(f,"border-bottom-width");var k=c(f,"border-top-width");n.border=[h,l,k,d];n.x1+=h;n.y1+=k;n.width-=l+h;n.height-=d+k}n.x2=n.x1+n.width;n.y2=n.y1+n.height;var j=f.getPropertyValue("position");var i=j==="fixed"?g:g.parentNode;while(i!==null){if(i===document.body){break}if(i.scrollTop===undefined){break}var f=window.getComputedStyle(i);var j=f.getPropertyValue("position");if(j==="absolute"){}else{if(j==="fixed"){n.scrollTop-=i.parentNode.scrollTop;n.scrollLeft-=i.parentNode.scrollLeft;break}else{n.scrollLeft+=i.scrollLeft;n.scrollTop+=i.scrollTop}}i=i.parentNode}n.scrollBodyLeft=(window.pageXOffset!==undefined)?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft;n.scrollBodyTop=(window.pageYOffset!==undefined)?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;n.scrollLeft-=n.scrollBodyLeft;n.scrollTop-=n.scrollBodyTop;return n};(function(){var e=navigator.userAgent.toLowerCase();var f=e.indexOf("macintosh")!==-1;var d;if(f&&e.indexOf("khtml")!==-1){d={91:true,93:true}}else{if(f&&e.indexOf("firefox")!==-1){d={224:true}}else{d={17:true}}}(a.metaTrackerReset=function(){eventjs.fnKey=a.fnKey=false;eventjs.metaKey=a.metaKey=false;eventjs.escKey=a.escKey=false;eventjs.ctrlKey=a.ctrlKey=false;eventjs.shiftKey=a.shiftKey=false;eventjs.altKey=a.altKey=false})();a.metaTracker=function(h){var g=h.type==="keydown";if(h.keyCode===27){eventjs.escKey=a.escKey=g}if(d[h.keyCode]){eventjs.metaKey=a.metaKey=g}eventjs.ctrlKey=a.ctrlKey=h.ctrlKey;eventjs.shiftKey=a.shiftKey=h.shiftKey;eventjs.altKey=a.altKey=h.altKey}})();return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}eventjs.MutationObserver=(function(){var b=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;var a=!b&&(function(){var e=document.createElement("p");var c=false;var d=function(){c=true};if(e.addEventListener){e.addEventListener("DOMAttrModified",d,false)}else{if(e.attachEvent){e.attachEvent("onDOMAttrModified",d)}else{return false}}e.setAttribute("id","target");return c})();return function(c,f){if(b){var e={subtree:false,attributes:true};var d=new b(function(g){g.forEach(function(h){f.call(h.target,h.attributeName)})});d.observe(c,e)}else{if(a){eventjs.add(c,"DOMAttrModified",function(g){f.call(c,g.attrName)})}else{if("onpropertychange" in document.body){eventjs.add(c,"propertychange",function(g){f.call(c,window.event.propertyName)})}}}}})();if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.click=function(c){c.gesture=c.gesture||"click";c.maxFingers=c.maxFingers||c.fingers||1;c.onPointerDown=function(d){if(a.pointerStart(d,b,c)){eventjs.add(c.target,"mouseup",c.onPointerUp)}};c.onPointerUp=function(e){if(a.pointerEnd(e,b,c)){eventjs.remove(c.target,"mouseup",c.onPointerUp);var k=e.changedTouches||a.getCoords(e);var d=k[0];var l=c.bbox;var f=a.getBoundingBox(c.target);var g=d.pageY-f.scrollBodyTop;var h=d.pageX-f.scrollBodyLeft;if(h>l.x1&&g>l.y1&&h<l.x2&&g<l.y2&&l.scrollTop===f.scrollTop){for(var j in c.tracker){break}var i=c.tracker[j];b.x=i.start.x;b.y=i.start.y;c.listener(e,b)}}};var b=a.pointerSetup(c);b.state="click";eventjs.add(c.target,"mousedown",c.onPointerDown);return b};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.click=a.click;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.dbltap=a.dblclick=function(f){f.gesture=f.gesture||"dbltap";f.maxFingers=f.maxFingers||f.fingers||1;var e=700;var i,h,g;var d,c;f.onPointerDown=function(k){var j=k.changedTouches||a.getCoords(k);if(i&&!h){c=j[0];h=(new Date()).getTime()-i}else{d=j[0];i=(new Date()).getTime();h=0;clearTimeout(g);g=setTimeout(function(){i=0},e)}if(a.pointerStart(k,b,f)){eventjs.add(f.target,"mousemove",f.onPointerMove).listener(k);eventjs.add(f.target,"mouseup",f.onPointerUp)}};f.onPointerMove=function(l){if(i&&!h){var j=l.changedTouches||a.getCoords(l);c=j[0]}var n=f.bbox;var m=(c.pageX-n.x1);var k=(c.pageY-n.y1);if(!(m>0&&m<n.width&&k>0&&k<n.height&&Math.abs(c.pageX-d.pageX)<=25&&Math.abs(c.pageY-d.pageY)<=25)){eventjs.remove(f.target,"mousemove",f.onPointerMove);clearTimeout(g);i=h=0}};f.onPointerUp=function(l){if(a.pointerEnd(l,b,f)){eventjs.remove(f.target,"mousemove",f.onPointerMove);eventjs.remove(f.target,"mouseup",f.onPointerUp)}if(i&&h){if(h<=e){b.state=f.gesture;for(var k in f.tracker){break}var j=f.tracker[k];b.x=j.start.x;b.y=j.start.y;f.listener(l,b)}clearTimeout(g);i=h=0}};var b=a.pointerSetup(f);b.state="dblclick";eventjs.add(f.target,"mousedown",f.onPointerDown);return b};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.dbltap=a.dbltap;eventjs.Gesture._gestureHandlers.dblclick=a.dblclick;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.dragElement=function(c,b){a.drag({event:b,target:c,position:"move",listener:function(e,d){c.style.left=d.x+"px";c.style.top=d.y+"px";eventjs.prevent(e)}})};a.drag=function(c){c.gesture="drag";c.onPointerDown=function(d){if(a.pointerStart(d,b,c)){if(!c.monitor){eventjs.add(c.doc,"mousemove",c.onPointerMove);eventjs.add(c.doc,"mouseup",c.onPointerUp)}}c.onPointerMove(d,"down")};c.onPointerMove=function(e,d){if(!c.tracker){return c.onPointerDown(e)}var l=c.bbox;var j=e.changedTouches||a.getCoords(e);var f=j.length;for(var h=0;h<f;h++){var g=j[h];var k=g.identifier||Infinity;var m=c.tracker[k];if(!m){continue}m.pageX=g.pageX;m.pageY=g.pageY;b.state=d||"move";b.identifier=k;b.start=m.start;b.fingers=c.fingers;if(c.position==="differenceFromLast"){b.x=(m.pageX-m.offsetX);b.y=(m.pageY-m.offsetY);m.offsetX=m.pageX;m.offsetY=m.pageY}else{b.x=(m.pageX-m.offsetX);b.y=(m.pageY-m.offsetY)}c.listener(e,b)}};c.onPointerUp=function(d){if(a.pointerEnd(d,b,c,c.onPointerMove)){if(!c.monitor){eventjs.remove(c.doc,"mousemove",c.onPointerMove);eventjs.remove(c.doc,"mouseup",c.onPointerUp)}}};var b=a.pointerSetup(c);if(c.event){c.onPointerDown(c.event)}else{eventjs.add(c.target,"mousedown",c.onPointerDown);if(c.monitor){eventjs.add(c.doc,"mousemove",c.onPointerMove);eventjs.add(c.doc,"mouseup",c.onPointerUp)}}return b};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.drag=a.drag;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(b){var c=Math.PI/180;var a=function(g,h){var f=0;var e=0;var i=0;for(var d in h){var j=h[d];if(j.up){continue}f+=j.move.x;e+=j.move.y;i++}g.x=f/=i;g.y=e/=i;return g};b.gesture=function(e){e.gesture=e.gesture||"gesture";e.minFingers=e.minFingers||e.fingers||2;e.onPointerDown=function(i){var g=e.fingers;if(b.pointerStart(i,d,e)){eventjs.add(e.doc,"mousemove",e.onPointerMove);eventjs.add(e.doc,"mouseup",e.onPointerUp)}if(e.fingers===e.minFingers&&g!==e.fingers){d.fingers=e.minFingers;d.scale=1;d.rotation=0;d.state="start";var f="";for(var h in e.tracker){f+=h}d.identifier=parseInt(f);a(d,e.tracker);e.listener(i,d)}};e.onPointerMove=function(s,l){var f=e.bbox;var u=e.tracker;var p=s.changedTouches||b.getCoords(s);var g=p.length;for(var v=0;v<g;v++){var m=p[v];var j=m.identifier||Infinity;var q=u[j];if(!q){continue}q.move.x=(m.pageX-f.x1);q.move.y=(m.pageY-f.y1)}if(e.fingers<e.minFingers){return}var p=[];var x=0;var r=0;a(d,u);for(var j in u){var m=u[j];if(m.up){continue}var k=m.start;if(!k.distance){var o=k.x-d.x;var n=k.y-d.y;k.distance=Math.sqrt(o*o+n*n);k.angle=Math.atan2(o,n)/c}var o=m.move.x-d.x;var n=m.move.y-d.y;var h=Math.sqrt(o*o+n*n);x+=h/k.distance;var w=Math.atan2(o,n)/c;var t=(k.angle-w+360)%360-180;m.DEG2=m.DEG1;m.DEG1=t>0?t:-t;if(typeof(m.DEG2)!=="undefined"){if(t>0){m.rotation+=m.DEG1-m.DEG2}else{m.rotation-=m.DEG1-m.DEG2}r+=m.rotation}p.push(m.move)}d.touches=p;d.fingers=e.fingers;d.scale=x/e.fingers;d.rotation=r/e.fingers;d.state="change";e.listener(s,d)};e.onPointerUp=function(g){var f=e.fingers;if(b.pointerEnd(g,d,e)){eventjs.remove(e.doc,"mousemove",e.onPointerMove);eventjs.remove(e.doc,"mouseup",e.onPointerUp)}if(f===e.minFingers&&e.fingers<e.minFingers){d.fingers=e.fingers;d.state="end";e.listener(g,d)}};var d=b.pointerSetup(e);eventjs.add(e.target,"mousedown",e.onPointerDown);return d};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.gesture=b.gesture;return b})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.pointerdown=a.pointermove=a.pointerup=function(d){d.gesture=d.gesture||"pointer";if(d.target.isPointerEmitter){return}var b=true;d.onPointerDown=function(e){b=false;c.gesture="pointerdown";d.listener(e,c)};d.onPointerMove=function(e){c.gesture="pointermove";d.listener(e,c,b)};d.onPointerUp=function(e){b=true;c.gesture="pointerup";d.listener(e,c,true)};var c=a.pointerSetup(d);eventjs.add(d.target,"mousedown",d.onPointerDown);eventjs.add(d.target,"mousemove",d.onPointerMove);eventjs.add(d.doc,"mouseup",d.onPointerUp);d.target.isPointerEmitter=true;return c};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.pointerdown=a.pointerdown;eventjs.Gesture._gestureHandlers.pointermove=a.pointermove;eventjs.Gesture._gestureHandlers.pointerup=a.pointerup;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.shake=function(f){var k={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:f.target,listener:f.listener,remove:function(){window.removeEventListener("devicemotion",e,false)}};var d=4;var g=1000;var h=200;var b=3;var c=(new Date()).getTime();var j={x:0,y:0,z:0};var i={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}};var e=function(w){var s=0.8;var m=w.accelerationIncludingGravity;j.x=s*j.x+(1-s)*m.x;j.y=s*j.y+(1-s)*m.y;j.z=s*j.z+(1-s)*m.z;k.accelerationIncludingGravity=j;k.acceleration.x=m.x-j.x;k.acceleration.y=m.y-j.y;k.acceleration.z=m.z-j.z;if(f.gesture==="devicemotion"){f.listener(w,k);return}var t="xyz";var l=(new Date()).getTime();for(var q=0,p=t.length;q<p;q++){var r=t[q];var v=k.acceleration[r];var u=i[r];var z=Math.abs(v);if(l-c<g){continue}if(z>d){var y=l*v/z;var x=Math.abs(y+u.value);if(u.value&&x<h){u.value=y;u.count++;if(u.count===b){f.listener(w,k);c=l;u.value=0;u.count=0}}else{u.value=y;u.count=1}}}};if(!window.addEventListener){return}window.addEventListener("devicemotion",e,false);return k};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.shake=a.shake;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){var b=Math.PI/180;a.swipe=function(d){d.snap=d.snap||90;d.threshold=d.threshold||1;d.gesture=d.gesture||"swipe";d.onPointerDown=function(e){if(a.pointerStart(e,c,d)){eventjs.add(d.doc,"mousemove",d.onPointerMove).listener(e);eventjs.add(d.doc,"mouseup",d.onPointerUp)}};d.onPointerMove=function(h){var j=h.changedTouches||a.getCoords(h);var g=j.length;for(var f=0;f<g;f++){var l=j[f];var e=l.identifier||Infinity;var k=d.tracker[e];if(!k){continue}k.move.x=l.pageX;k.move.y=l.pageY;k.moveTime=(new Date()).getTime()}};d.onPointerUp=function(g){if(a.pointerEnd(g,c,d)){eventjs.remove(d.doc,"mousemove",d.onPointerMove);eventjs.remove(d.doc,"mouseup",d.onPointerUp);var r;var q;var m;var j;var i={x:0,y:0};var t=0;var s=0;var l=0;for(var h in d.tracker){var p=d.tracker[h];var n=p.move.x-p.start.x;var k=p.move.y-p.start.y;t+=p.move.x;s+=p.move.y;i.x+=p.start.x;i.y+=p.start.y;l++;var f=Math.sqrt(n*n+k*k);var e=p.moveTime-p.startTime;var j=Math.atan2(n,k)/b+180;var q=e?f/e:0;if(typeof(m)==="undefined"){m=j;r=q}else{if(Math.abs(j-m)<=20){m=(m+j)/2;r=(r+q)/2}else{return}}}var o=d.gestureFingers;if(d.minFingers<=o&&d.maxFingers>=o){if(r>d.threshold){i.x/=l;i.y/=l;c.start=i;c.x=t/l;c.y=s/l;c.angle=-((((m/d.snap+0.5)>>0)*d.snap||360)-360);c.velocity=r;c.fingers=o;c.state="swipe";d.listener(g,c)}}}};var c=a.pointerSetup(d);eventjs.add(d.target,"mousedown",d.onPointerDown);return c};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.swipe=a.swipe;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.longpress=function(b){b.gesture="longpress";return a.tap(b)};a.tap=function(c){c.delay=c.delay||500;c.timeout=c.timeout||250;c.driftDeviance=c.driftDeviance||10;c.gesture=c.gesture||"tap";var e,d;c.onPointerDown=function(f){if(a.pointerStart(f,b,c)){e=(new Date()).getTime();eventjs.add(c.doc,"mousemove",c.onPointerMove).listener(f);eventjs.add(c.doc,"mouseup",c.onPointerUp);if(c.gesture!=="longpress"){return}d=setTimeout(function(){if(f.cancelBubble&&++f.cancelBubbleCount>1){return}var h=0;for(var i in c.tracker){var g=c.tracker[i];if(g.end===true){return}if(c.cancel){return}h++}if(c.minFingers<=h&&c.maxFingers>=h){b.state="start";b.fingers=h;b.x=g.start.x;b.y=g.start.y;c.listener(f,b)}},c.delay)}};c.onPointerMove=function(g){var p=c.bbox;var l=g.changedTouches||a.getCoords(g);var h=l.length;for(var k=0;k<h;k++){var j=l[k];var m=j.identifier||Infinity;var s=c.tracker[m];if(!s){continue}var o=(j.pageX-p.x1);var n=(j.pageY-p.y1);var r=o-s.start.x;var q=n-s.start.y;var f=Math.sqrt(r*r+q*q);if(!(o>0&&o<p.width&&n>0&&n<p.height&&f<=c.driftDeviance)){eventjs.remove(c.doc,"mousemove",c.onPointerMove);c.cancel=true;return}}};c.onPointerUp=function(g){if(a.pointerEnd(g,b,c)){clearTimeout(d);eventjs.remove(c.doc,"mousemove",c.onPointerMove);eventjs.remove(c.doc,"mouseup",c.onPointerUp);if(g.cancelBubble&&++g.cancelBubbleCount>1){return}if(c.gesture==="longpress"){if(b.state==="start"){b.state="end";c.listener(g,b)}return}if(c.cancel){return}if((new Date()).getTime()-e>c.timeout){return}var f=c.gestureFingers;if(c.minFingers<=f&&c.maxFingers>=f){b.state="tap";b.fingers=c.gestureFingers;c.listener(g,b)}}};var b=a.pointerSetup(c);eventjs.add(c.target,"mousedown",c.onPointerDown);return b};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.tap=a.tap;eventjs.Gesture._gestureHandlers.longpress=a.longpress;return a})(eventjs.proxy);if(typeof(eventjs)==="undefined"){var eventjs={}}if(typeof(eventjs.proxy)==="undefined"){eventjs.proxy={}}eventjs.proxy=(function(a){a.wheelPreventElasticBounce=function(b){if(!b){return}if(typeof(b)==="string"){b=document.querySelector(b)}eventjs.add(b,"wheel",function(d,c){c.preventElasticBounce();eventjs.stop(d)})};a.wheel=function(f){var c;var h=f.timeout||150;var e=0;var j={gesture:"wheel",state:"start",wheelDelta:0,target:f.target,listener:f.listener,preventElasticBounce:function(l){var o=this.target;var n=o.scrollTop;var m=n+o.offsetHeight;var k=o.scrollHeight;if(m===k&&this.wheelDelta<=0){eventjs.cancel(l)}else{if(n===0&&this.wheelDelta>=0){eventjs.cancel(l)}}eventjs.stop(l)},add:function(){f.target[i](g,b,false)},remove:function(){f.target[d](g,b,false)}};var b=function(k){k=k||window.event;j.state=e++?"change":"start";j.wheelDelta=k.detail?k.detail*-20:k.wheelDelta;f.listener(k,j);clearTimeout(c);c=setTimeout(function(){e=0;j.state="end";j.wheelDelta=0;f.listener(k,j)},h)};var i=document.addEventListener?"addEventListener":"attachEvent";var d=document.removeEventListener?"removeEventListener":"detachEvent";var g=eventjs.getEventSupport("mousewheel")?"mousewheel":"DOMMouseScroll";f.target[i](g,b,false);return j};eventjs.Gesture=eventjs.Gesture||{};eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{};eventjs.Gesture._gestureHandlers.wheel=a.wheel;return a})(eventjs.proxy);if(typeof(Event)==="undefined"){var Event={}}if(typeof(Event.proxy)==="undefined"){Event.proxy={}}Event.proxy=(function(a){a.orientation=function(c){var b={gesture:"orientationchange",previous:null,current:window.orientation,target:c.target,listener:c.listener,remove:function(){window.removeEventListener("orientationchange",d,false)}};var d=function(f){b.previous=b.current;b.current=window.orientation;if(b.previous!==null&&b.previous!=b.current){c.listener(f,b);return}};if(window.DeviceOrientationEvent){window.addEventListener("orientationchange",d,false)}return b};Event.Gesture=Event.Gesture||{};Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{};Event.Gesture._gestureHandlers.orientation=a.orientation;return a})(Event.proxy);(function(b){var n=Math.sqrt,o=Math.atan2,g=Math.pow,d=Math.PI/180,l=Math.PI/2;var p=/\{ *([\w_ -]+) *\}/g;var a=0;function f(q){return window["webkit"+q]||window["moz"+q]||window["ms"+q]}function h(r,s){var t=Array.prototype.slice;if(r.bind){return r.bind.apply(r,t.call(arguments,1))}var q=t.call(arguments,2);return function(){return r.apply(s,q.length?q.concat(t.call(arguments)):arguments)}}function k(q){var s=+new Date(),r=Math.max(0,16-(s-a));a=s+r;return window.setTimeout(q,r)}var j=window.requestAnimationFrame||f("RequestAnimationFrame")||k;var m=window.cancelAnimationFrame||f("CancelAnimationFrame")||f("CancelRequestAnimationFrame")||function(q){window.clearTimeout(q)};function i(s,r,q){if(q&&j===k){s.call(r)}else{return j.call(window,h(s,r))}}function c(q){if(q){m.call(window,q)}}function e(q){q=q.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var s=new RegExp("[\\?&]"+q+"=([^&#]*)"),r=s.exec(window.location.search);return r==null?"":decodeURIComponent(r[1].replace(/\+/g," "))}geomap.util={formatNum:function(q,s){var r=Math.pow(10,(s===undefined?6:s));return Math.round(q*r)/r},isArray:Array.isArray||function(q){return(Object.prototype.toString.call(q)==="[object Array]")},template:function(r,q){return r.replace(p,function(u,s){var t=q[s];if(t===undefined){t="{"+s+"}"}else{if(typeof t==="function"){t=t(q)}}return t})},requestAnimFrame:i,cancelAnimFrame:c,getUrlParam:e}})(typeof exports!=="undefined"?exports:this);(function(){var f=Array.prototype.slice;function b(m,l){var j=f.call(arguments,2),h=[];for(var k=0,g=m.length;k<g;k++){h[k]=j.length?m[k][l].apply(m[k],j):m[k][l].call(m[k])}return h}function a(h,g){return e(h,g,function(j,i){return j>=i})}function c(h,g){return e(h,g,function(j,i){return j<i})}function d(i,h){var g=i.length;while(g--){i[g]=h}return i}function e(l,j,k){if(!l||l.length===0){return}var h=l.length-1,g=j?l[h][j]:l[h];if(j){while(h--){if(k(l[h][j],g)){g=l[h][j]}}}else{while(h--){if(k(l[h],g)){g=l[h]}}}return g}geomap.util.array={fill:d,invoke:b,min:c,max:a}})();(function(){function d(f,g){if(!this.__eventListeners[f]){return}var e=this.__eventListeners[f];if(g){e[e.indexOf(g)]=false}else{geomap.util.array.fill(e,false)}}function a(e,f){if(!this.__eventListeners){this.__eventListeners={}}if(arguments.length===1){for(var g in e){this.on(g,e[g])}}else{if(!this.__eventListeners[e]){this.__eventListeners[e]=[]}this.__eventListeners[e].push(f)}return this}function c(e,f){if(!this.__eventListeners){return this}if(arguments.length===0){for(e in this.__eventListeners){d.call(this,e)}}else{if(arguments.length===1&&typeof arguments[0]==="object"){for(var g in e){d.call(this,g,e[g])}}else{d.call(this,e,f)}}return this}function b(g,h){if(!this.__eventListeners){return this}var f=this.__eventListeners[g];if(!f){return this}for(var j=0,e=f.length;j<e;j++){f[j]&&f[j].call(this,h||{})}this.__eventListeners[g]=f.filter(function(i){return i!==false});return this}geomap.Observable={fire:b,on:a,off:c,}})();geomap.CommonMethods={_setOptions:function(a){for(var b in a){this.set(b,a[b])}},_setObject:function(a){for(var b in a){this._set(b,a[b])}},set:function(a,b){if(typeof a==="object"){this._setObject(a)}else{this._set(a,b)}return this},_set:function(a,b){this[a]=b},toggle:function(b){var a=this.get(b);if(typeof a==="boolean"){this.set(b,!a)}return this},get:function(a){return this[a]}};(function(){function b(d,h,e){if(e){if(!geomap.isLikelyNode&&h instanceof Element){d=h}else{if(h instanceof Array){d=[];for(var f=0,c=h.length;f<c;f++){d[f]=b({},h[f],e)}}else{if(h&&typeof h==="object"){for(var g in h){if(g==="canvas"||g==="group"){d[g]=null}else{if(h.hasOwnProperty(g)){d[g]=b({},h[g],e)}}}}else{d=h}}}}else{for(var g in h){d[g]=h[g]}}return d}function a(d,c){return b({},d,c)}geomap.util.object={extend:b,clone:a};geomap.util.object.extend(geomap.util,geomap.Observable)})();(function(){function b(j,k,m){k||(k={});m||(m={});var l=geomap.document.createElement(j);f(l,k);d(l,m);return l}function d(k,j){for(var l in j){k.style[l]=j[l]}}function f(k,j){for(var l in j){k[l]=j[l]}}function g(k,j,n,m){var l=(function(){var r=document.createElement("canvas"),o=r.getContext("2d"),p=window.devicePixelRatio||1,q=o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1;return p/q})();if(!m){m=l}k.width=j*m;k.height=n*m;k.style.width=j+"px";k.style.height=n+"px";k.getContext("2d").setTransform(m,0,0,m,0,0);return k}function a(k,j){j=j||"";if(j.replace(/\s/g,"").length==0){return false}return new RegExp(" "+j+" ").test(" "+k.className+" ")}function e(k,j){if(!a(k,j)){k.className+=" "+j}}function h(k,j){if(a(k,j)){var l=" "+k.className.replace(/[\t\r\n]/g,"")+" ";while(l.indexOf(" "+j+" ")>=0){l=l.replace(" "+j+" "," ")}k.className=l.replace(/^\s+|\s+$/g,"")}}function i(j){var s=new Object();var n=j.getElementsByTagName("input");for(var o=0;o<n.length;o++){var m=n[o];var r=m.name;var q="";if(m.type==="radio"){if(s[r]===undefined){s[r]=""}if(m.checked){q=m.value;s[r]=q}}else{if(m.type==="checkbox"){if(s[r]===undefined){s[r]=[]}if(m.checked){q=m.value;s[r].push(q)}}else{if(m.type!="button"&&m.type!="submit"){q=m.value;s[r]=q}}}}var k=j.getElementsByTagName("select");for(var o=0;o<k.length;o++){var m=k[o];var r=m.name;var l=m.selectedIndex;q=m.options[l].value;s[r]=q}var p=j.getElementsByTagName("textarea");for(var o=0;o<p.length;o++){var m=p[o];s[m.name]=m.value}return s}function c(l){var D=l.id||("form_"+new Date());var v=geomap.element.create("form",{id:D},{marginTop:"10px"});if(l.properties){var C={height:"30px"};for(var x=0,y=l.properties.length;x<y;x++){var q=l.properties[x];if(q.type==="text"){var u=geomap.element.create("div",{},C);var E=geomap.element.create("span",{},{minWidth:"100px",display:"inline-block",textAlign:"right"});E.innerText=q.title;var r=geomap.element.create("input",{type:"text",name:q.id});r.value=q.value;u.appendChild(E);u.appendChild(r);v.appendChild(u)}else{if(q.type==="hidden"){var r=geomap.element.create("input",{type:"hidden",name:q.id});r.value=q.value;v.appendChild(r)}else{if(q.type==="radio"||q.type==="checkbox"){var u=geomap.element.create("div",{},C);var E=geomap.element.create("span",{},{minWidth:"100px",display:"inline-block",textAlign:"right"});E.innerText=q.title;u.appendChild(E);for(var t in q.option){var p=geomap.element.create("label");var s=geomap.element.create("input",{type:q.type,name:q.id});s.value=t;var A=geomap.element.create("a");A.innerText=q.option[t];p.appendChild(s);p.appendChild(A);u.appendChild(p);if(q.value===t){s.checked=true}}v.appendChild(u)}else{if(q.type==="select"){var u=geomap.element.create("div",{},C);var E=geomap.element.create("span",{},{minWidth:"100px",display:"inline-block",textAlign:"right"});E.innerText=q.title;var n=geomap.element.create("select",{name:q.id});for(var t in q.option){var B=geomap.element.create("option",{type:"checkbox",name:q.id});B.value=t;B.innerText=q.option[t];n.appendChild(B);if(q.value===q.option[t]){s.selected=true}}u.appendChild(E);u.appendChild(n);v.appendChild(u)}else{if(q.type==="button"){var u=geomap.element.create("div",{},C);var E=geomap.element.create("span",{},{minWidth:"100px",display:"inline-block",textAlign:"right"});E.innerHTML="&nbsp;";u.appendChild(E);var o=geomap.element.create("input",{type:"button",className:"btn",name:q.id});o.value=q.value;u.appendChild(o);v.appendChild(u);if(q.click){eventjs.add(o,"click",q.click)}}else{if(q.type==="buttons"){var u=geomap.element.create("div",{},C);var E=geomap.element.create("span",{},{minWidth:"100px",display:"inline-block",textAlign:"right"});E.innerHTML="&nbsp;";u.appendChild(E);for(var z=0,w=q.group.length;z<w;z++){var m=q.group[z];var o=geomap.element.create("input",{type:"button",className:"btn",name:m.id});o.value=m.value;u.appendChild(o);if(m.click){eventjs.add(o,"click",m.click)}}v.appendChild(u)}}}}}}}}if(l.buttons){var u=geomap.element.create("div",{},C);var E=geomap.element.create("span",{},{minWidth:"100px",display:"inline-block",textAlign:"right"});E.innerHTML="&nbsp;";u.appendChild(E);for(var z=0,w=l.buttons.length;z<w;z++){var m=l.buttons[z];var o=geomap.element.create("input",{type:"button",className:"btn",name:m.id});o.value=m.value;u.appendChild(o);if(m.click){eventjs.add(o,"click",m.click)}}v.appendChild(u)}return v}geomap.element={create:b,setStyle:d,setOptions:f,hasClass:a,addClass:e,removeClass:h,formToJson:i,parseToForm:c,createHiDPICanvas:g}})();(function(){geomap.util.event={_ev_xy_now:[0,0],_ev_xy_last:[0,0],_ev_smooth:[[0,0]],_ev_speed:[0,0],_ev_inertance:-1,_ev_speed_down:0.9,speedStart:function(a,c){this._ev_inertance=1;this._ev_speed=[0,0];this._ev_xy_last=[a,c];var b=[0,0];this._ev_smooth=[b,b,b,b,b,b,b,b,b,b,b,b]},speedEnd:function(){this._ev_inertance=-1},moving:function(a,b){this._ev_xy_now=[a,b]},speeding:function(){if(this._ev_inertance==1){var f=geomap.util.matrixSubtract(this._ev_xy_now,this._ev_xy_last);this._ev_smooth.push(f);this._ev_smooth.shift();var c=[0,0];var e=this._ev_smooth;var b=e.length;for(var d=0;d<b;d++){c=geomap.util.matrixAdd(c,e[d])}c[0]=c[0]/b;c[1]=c[1]/b;this._ev_speed=[Math.round(c[0]),Math.round(c[1])];this._ev_xy_last=this._ev_xy_now}else{var e=this._ev_speed,a=this._ev_speed_down;e=geomap.util.matrixMultiply(e,[a,a]);this._ev_speed=geomap.util.posFloor(e)}return this._ev_speed}}})();(function(){var g=Array.prototype.slice,f=function(){},d=(function(){for(var h in {toString:1}){if(h==="toString"){return false}}return true})(),c=function(h,k,i){for(var j in k){if(j in h.prototype&&typeof h.prototype[j]==="function"&&(k[j]+"").indexOf("callSuper")>-1){h.prototype[j]=(function(l){return function(){var n=this.constructor.superclass;this.constructor.superclass=i;var m=k[l].apply(this,arguments);this.constructor.superclass=n;if(l!=="initialize"){return m}}})(j)}else{h.prototype[j]=k[j]}if(d){if(k.toString!==Object.prototype.toString){h.prototype.toString=k.toString}if(k.valueOf!==Object.prototype.valueOf){h.prototype.valueOf=k.valueOf}}}};function b(){}function a(h){var i=null,k=this;while(k.constructor.superclass){var j=k.constructor.superclass.prototype[h];if(k[h]!==j){i=j;break}k=k.constructor.superclass.prototype}if(!i){return console.log("tried to callSuper "+h+", method not found in prototype chain",this)}return(arguments.length>1)?i.apply(this,g.call(arguments,1)):i.call(this)}function e(){var l=null,k=g.call(arguments,0);if(typeof k[0]==="function"){l=k.shift()}function h(){this.initialize.apply(this,arguments)}h.superclass=l;h.subclasses=[];if(l){b.prototype=l.prototype;h.prototype=new b();l.subclasses.push(h)}for(var j=0,m=k.length;j<m;j++){c(h,k[j],l)}if(!h.prototype.initialize){h.prototype.initialize=f}h.prototype.constructor=h;h.prototype.callSuper=a;return h}geomap.Class=e})();(function(){geomap.PosAnimation=geomap.Class(geomap.CommonMethods,geomap.Observable,{easeLinearity:0.5,initialize:function(a){a||(a={});this.fnContext=this;this._setOptions(a)},run:function(c,e,d,b,a){this.stop();this._callback=e;this._callbackContext=a||this;this._inProgress=true;this._duration=b||0.25;this._easeOutPower=1/Math.max(this.easeLinearity,0.2);this._pos=d;this._startPos=d[0];this._offset=d[1].subtract(this._startPos);this._startTime=+new Date();this.fire("start");this._animate();this.loopTarget=c;this._timerId=this._animate.bind(this);this.loopTarget.on("looptime",this._timerId)},stop:function(){if(!this._inProgress){return}this._step(true);this._complete()},_animate:function(){this._step()},_step:function(b){var a=(+new Date())-this._startTime,c=this._duration*1000;if(a<c){this._runFrame(this._easeOut(a/c),b)}else{this._runFrame(1);this._complete()}},_runFrame:function(c,b){var a=this._offset.multiplyBy(c);var f=this._startPos.add(a);if(b){f._round()}var d={animationTarget:this,step:a,offset:this._offset,progress:c,pos:this._pos};this._callback.call(this._callbackContext,f,d);this.fire("step")},_complete:function(){this.loopTarget.off("looptime",this._timerId);this._inProgress=false;this.fire("end")},_easeOut:function(a){return 1-Math.pow(1-a,this._easeOutPower)}})})();(function(b){var c=geomap.util.object.extend;if(!b.geomap){b.geomap={}}if(b.geomap.Image){geomap.warn("geomap.Image is already defined.");return}var a={cacheImage:function(d){if(!this.__cache_imgs){this.__cache_imgs={}}var e=d.src;this.__cache_imgs[e]=d;return d},getCache:function(d){if(!this.__cache_imgs){return null}if(this.__cache_imgs[d]){return this.__cache_imgs[d]}return null},hasKey:function(d){if(!this.__load_img_key){this.__load_img_key={};this.__load_img_key[d]=1;return false}if(this.__load_img_key[d]){this.__load_img_key[d]=this.__load_img_key[d]+1;return true}else{this.__load_img_key[d]=1;return false}}};geomap.Image=geomap.Class(geomap.CommonMethods,geomap.Observable,{type:"image",x:0,y:0,z:0,left:0,top:0,cacheTime:0,lockKey:1,tileKey:null,tableKey:null,image:null,loaded:false,ctx:undefined,tag:0,initialize:function(d){d||(d={});this._setOptions(d);this.image=window.document.createElement("img");this._onloadHandle=this.onLoad.bind(this);this.image.onload=this._onloadHandle},isTile:function(d){return(d.x===this.x&&d.y===this.y&&d.z===this.z&&d.cacheTime==this.cacheTime)},getTileUrl:function(d,e){var f=geomap.util.template(d+(/\?/.test(d)?"&":"?")+"cacheTime={cacheTime}",e);return f},loadTile:function(d,f){this._setOptions(f);var e=this.getTileUrl(d,f);if(this.getSrc()===e){this.drawCanvas()}else{this.setSrc(e)}},drawCanvas:function(){if(this.loaded&&this.ctx!=undefined){this.ctx.drawImage(this.image,this.left,this.top);var d=this;this.fire("drawend",this)}},draw:function(e){if(this.loaded){e.drawImage(this.image,this.x,this.y);if(this.drawCallback){var d=this;this.drawCallback(d)}}},onLoad:function(d){this.loaded=true;this.drawCanvas();this.fire("onload")},setSrc:function(d){this.loaded=false;this.image.src=d},getSrc:function(){return this.image.src},fromURL:function(e,d,f){if(d!=undefined&&f!=undefined){this.x=d;this.y=f}if(this.loaded&&this.image.src===e){this.onLoad(this.image)}else{this.image.src=e}}})})(typeof exports!=="undefined"?exports:this);(function(){function c(d,e){return d+(/\?/.test(d)?"&":"?")+e}function a(){}function b(f,e){e||(e={});var j=e.method?e.method.toUpperCase():"GET",h=e.onComplete||function(){},i=new geomap.window.XMLHttpRequest(),d=e.body||e.parameters;headers=e.header||{};i.onreadystatechange=function(){if(i.readyState===4){h(i);i.onreadystatechange=a}};if(j==="GET"){d=null;if(typeof e.parameters==="string"){f=c(f,e.parameters)}}if(j==="JSON"){i.open("POST",f,true)}else{i.open(j,f,true)}for(var g in headers){i.setRequestHeader(g,headers[g])}if(j==="JSON"){i.setRequestHeader("Content-Type","application/json;charset=UTF-8")}else{if(j==="POST"||j==="PUT"){i.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}}if(d!=undefined&&j==="JSON"&&d!=null){i.send(JSON.stringify(d))}else{i.send(d)}return i}geomap.request=b})();(function(){function f(g,h){if(typeof g=="string"){g=Number(g)}if(typeof h=="string"){h=Number(h)}this.x=g;this.y=h}var e=Math.trunc||function(g){return g>0?Math.floor(g):Math.ceil(g)};f.prototype={clone:function(){return new f(this.x,this.y)},zero:function(){this.x=0;this.y=0;return this},add:function(g){return this.clone()._add(g)},_add:function(g){this.x+=g.x;this.y+=g.y;return this},subtract:function(g){return this.clone()._subtract(g)},_subtract:function(g){this.x-=g.x;this.y-=g.y;return this},divideBy:function(g){return this.clone()._divideBy(g)},_divideBy:function(g){this.x/=g;this.y/=g;return this},multiplyBy:function(g){return this.clone()._multiplyBy(g)},_multiplyBy:function(g){this.x*=g;this.y*=g;return this},scaleBy:function(g){return this.clone()._scaleBy(g)},_scaleBy:function(g){this.x*=g.x;this.y*=g.y;return this},unscaleBy:function(g){return this.clone()._unscaleBy(g)},_unscaleBy:function(g){this.x=this.x/g.x;this.y=this.y/g.y;return this},round:function(){return this.clone()._round()},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},floor:function(){return this.clone()._floor()},_floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){return this.clone()._ceil()},_ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},trunc:function(){return this.clone()._trunc()},_trunc:function(){this.x=e(this.x);this.y=e(this.y);return this},distanceTo:function(h){var g=h.x-this.x,i=h.y-this.y;return Math.sqrt(g*g+i*i)},equals:function(g){g=d(g);return g.x===this.x&&g.y===this.y},toString:function(){return"POINT("+this.x+" "+this.y+")"}};function d(g,h){if(g instanceof f){return g}if(geomap.util.isArray(g)){return new f(g[0],g[1])}if(typeof g==="object"&&"x" in g&&"y" in g){return new f(g.x,g.y)}return new f(g,h)}function b(g){if(g instanceof f){return true}return false}function a(g){return(g.x==0&&g.y==0)}function c(g){if(!g){return false}if(b(g)){return true}if(typeof g==="object"&&"x" in g&&"y" in g){return true}return false}geomap.Point=f;geomap.util.toPoint=d;geomap.util.isPoint=b;geomap.util.hasXY=c;geomap.util.isZeroPoint=a})();(function(){var b=geomap.Point;function a(f,e,h,g){this._a=f;this._b=e;this._c=h;this._d=g}a.prototype={setOrigin:function(c,e){this._b=c;this._d=e;return this},transform:function(c,d){return this._transform(c,d)},_transform:function(c,d){d=d||1;c.x=d*(this._a*c.x+this._b);c.y=d*(this._c*c.y+this._d);return c},untransform:function(c,d){d=d||1;return new b((c.x/d-this._b)/this._a,(c.y/d-this._d)/this._c)}};geomap.Transformtion=a})();(function(){var d=geomap.Point;function b(f){this._map=f}b.prototype={addEvent:function(f){eventjs.add(f,"gesture",this.handle.bind(this))},handle:function(g,f){eventjs.cancel(g);if(f.state=="start"){this._zooming=true;this._moved=false;this._zoom=this._map.zoom;return}else{if(f.state=="end"){this._map._touchZoomStatus=false;if(!this._moved||!this._zooming){this._zooming=false;return this}this._zooming=false;this._map.touchZoomEnd(g,this._centerPos,f.scale);return}else{if(!this._zooming){this._zooming=false;return this}if(!this._moved){var j=new d(f.touches[0].x,f.touches[0].y);var h=new d(f.touches[1].x,f.touches[1].y);var i=j.add(h)._divideBy(2);this._centerPos=i;this._map.touchZoomStart(g,this._centerPos);this._moved=true;return}this._map.touchZoom(g,this._centerPos,f.scale);return}}}};function a(f){this._map=f;this._inertia=true;this._inertia_speed=[0,0]}a.prototype={addEvent:function(f){eventjs.add(f,"drag gesture",this.handle.bind(this));if(this.dragingSpeedTimeId===undefined){this.dragingSpeedTimeId=this.dragingSpeed.bind(this);this._map.on("looptime",this.dragingSpeedTimeId)}},dragingSpeed:function(){if(this._drag_speed&&this._draging){var n=this._drag_nowpos[0]-this._drag_lastpos[0];var m=this._drag_nowpos[1]-this._drag_lastpos[1];this._drag_speed.push([n,m]);this._drag_speed.shift();var l=[0,0];var j=this._drag_speed.length;for(var g=0;g<j;g++){l[0]=l[0]+this._drag_speed[g][0];l[1]=l[1]+this._drag_speed[g][1]}var k=Math.round(l[0]/j);var h=Math.round(l[1]/j);this._inertia_speed=[k,h];this._drag_lastpos=this._drag_nowpos}else{var f=this._inertia_speed,o=f;if(Math.abs(o[0])<0){f[0]=0}if(Math.abs(o[1])<0){f[1]=0}f[0]=o[0]*0.97;f[1]=o[1]*0.97;this._inertia_speed=f}},handle:function(h,g){if(!g.fingers||g.fingers==1){eventjs.cancel(h);h.openInertia=this._inertia;if(g.state=="down"){this._draging=true;this._moved=false;if(this._inertia){var j=[0,0];this._drag_speed=[j,j,j,j,j,j,j,j];this._inertia_speed=[0,0];this._drag_lastpos=[g.x,g.y];this._drag_nowpos=[g.x,g.y]}return}else{if(g.state=="up"){if(!this._moved||!this._draging){this._draging=false;this._moved=false;return this}this._traging=false;var f=h;f.inertiaSpeed=this._inertia_speed;var i=new d(g.x,g.y);this._map.dragEnd(f,i);return this}else{if(!this._draging||this._map._touchZoomStatus){this._draging=false;return this}if(!this._moved){this._map.dragStart(h,new d(g.x,g.y));this._moved=true;return this}if(this._inertia){this._drag_nowpos=[g.x,g.y]}var i=new d(g.x,g.y);this._map.dragChange(h,i)}}}}};function e(f){this._map=f;this.wheelDebounceTime=40;this.wheelPxPerZoomLevel=60}function c(f){return navigator.userAgent.toLowerCase().indexOf(f)>=0}e.prototype={addEvent:function(f){eventjs.add(f,"wheel",this.handle.bind(this))},getWheelDelta:function(q){var g="ActiveXObject" in window;var k=g&&!document.addEventListener;var r=c("webkit");var l=c("android");var o=c("android 2")||c("android 3");var m=!!window.opera;var h=!n&&c("safari");var f=typeof orientation!=="undefined"||c("mobile");var j="msLaunchUri" in navigator&&!("documentMode" in document);var n=!j&&c("chrome");var p=navigator.platform.indexOf("Win")===0;var i=c("gecko")&&!r&&!m&&!g;var s=(p&&n)?2*window.devicePixelRatio:i?window.devicePixelRatio:1;return j?q.wheelDeltaY/2:(q.deltaY&&q.deltaMode===0)?-q.deltaY/s:(q.deltaY&&q.deltaMode===1)?-q.deltaY*20:(q.deltaY&&q.deltaMode===2)?-q.deltaY*60:(q.deltaX||q.deltaZ)?0:q.wheelDelta?(q.wheelDeltaY||q.wheelDelta)/2:(q.detail&&Math.abs(q.detail)<32765)?-q.detail*20:q.detail?q.detail/-32765*60:0},handle:function(h,g){eventjs.cancel(h);var i=g.wheelDelta;if(g.state=="start"){this._zooming=true;this._zooming_start=false}else{if(g.state=="end"){if(!this._zooming){this._zooming_start=false;this._zooming=false;return this}this._map.wheelZoomEnd(h,new d(h.offsetX,h.offsetY),i)}else{if(!this._zooming){return this}if(!this._zooming_start){this._zooming_start=true;this._map.wheelZoomStart(h,new d(h.offsetX,h.offsetY));return}var f=new d(h.offsetX,h.offsetY);this._map.wheelZoom(h,f,i)}}},_preformWheelZoom:function(g,f,h){this._map.wheelZoom(g,f,h)}};geomap.Event={TouchZoom:b,Drag:a,ScrollWheelZoom:e}})();(function(){var b=geomap.Point;function a(e,d){this.min=e;this.max=d}a.prototype={clone:function(){return new a(this.min.clone(),this.max.clone())},getCenter:function(){return new b((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2)},getBottomLeft:function(){return new b(this.min.x,this.max.y)},getTopRigth:function(){return new b(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(f){var e,d;f=geomap.util.toPoint(f);e=f.min;d=f.max;return(e.x>=this.min.x)&&(d.x<=this.max.x)&&(e.y>=this.min.y)&&(d.y<=this.max.y)},intersects:function(i){var g=this.min,d=this.max,h=i.min,e=i.max,f=(e.x>=g.x)&&(h.x<=d.y),j=(e.y>=g.y)&&(h.y<=d.y);return f&&j},overlaps:function(j){var g=this.min,d=this.max,i=j.min,e=j.max,h=(e.x>g.x)&&(i.x<d.y),f=(e.y>g.y)&&(i.y<d.y);return h&&f},toString:function(){return"Bounds("+this.min.x+","+this.min.y+","+this.max.x+","+this.max.y+")"}};function c(e,d,i,h){var f=geomap.util.isPoint,g=geomap.util.hasXY;if(!e||e instanceof a){return e}if(d&&f(e)&&f(d)){return new a(e,d)}if(g(e)&&g(d)){return new a(toPoint(e),toPoint(d))}return new a(toPoint(e,d),toPoint(i,h))}geomap.Bounds=a;geomap.util.toBounds=c})();(function(a){if(!a.geomap){a.geomap={}}if(a.geomap.view){geomap.warn("geomap.Map is already defined.");return}geomap.view={}})(typeof exports!=="undefined"?exports:this);(function(){var b=geomap.util.object.extend;var a=geomap.Point;geomap.view.Frame=geomap.Class(geomap.CommonMethods,geomap.Observable,{type:"BaseFrame",container:undefined,headBar:undefined,bodyBar:undefined,rootFrame:undefined,closeBtn:undefined,x:0,y:0,w:200,h:120,pos:"center",posPad:10,headHeight:26,bodyheight:50,closeBtnSize:20,padding:4,title:"",body:undefined,radius:6,closeType:1,showBody:true,canHeadDblClick:true,boxShadow:"2px 2px 4px #888888",background:"rgba(255,255,255,0.97)",closeIcon:'<svg t="1619335973042" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1119" width="20" height="20"><path d="M391.68 667.306667a34.133333 34.133333 0 0 1-24.132267-58.2656L464.571733 512l-97.024-97.041067a34.133333 34.133333 0 1 1 48.264534-48.264533l97.041066 97.041067 96.187734-96.170667a34.133333 34.133333 0 1 1 48.264533 48.264533l-96.1024 96.1024 96.017067 95.3344a34.133333 34.133333 0 1 1-48.093867 48.4352l-96.187733-95.505066-97.109334 97.109333c-6.673067 6.656-15.4112 10.001067-24.149333 10.001067z" p-id="1120"></path></svg>',initialize:function(c,d){d||(d={});this._setOptions(d);this.container=c;this.rootFrame=geomap.element.create("div",{className:"rootFrame"},{zIndex:"1000",position:"absolute",top:"0px",left:"0px",border:"0px solid #989898",background:this.background,borderRadius:this.radius+"px",boxShadow:this.boxShadow});this.headBar=geomap.element.create("div",{className:"headBar"},{position:"absolute",top:"0px",left:"0px",borderBottom:"1px solid #b9b9b9"});this.bodyBar=geomap.element.create("div",{className:"body"},{position:"absolute",top:this.headHeight+"px",left:"0px"});var f=this.w-this.closeBtnSize-this.padding,e=this.padding;this.closeBtn=geomap.element.create("div",{className:"closeBtn"},{position:"absolute",top:e+"px",left:f+"px",width:this.closeBtnSize+"px",height:this.closeBtnSize+"px"});this.closeBtn.innerHTML=this.closeIcon;this.rootFrame.appendChild(this.headBar);this.rootFrame.appendChild(this.bodyBar);this.rootFrame.appendChild(this.closeBtn);this.container.appendChild(this.rootFrame);this.resetPos();this.resetStyle();this.resetBody();this._resize=this.resetStyle.bind(this);var h=this.close.bind(this);this._close=h;var g;eventjs.add(this.closeBtn,"click touch",this._close);eventjs.add(this.headBar,"drag gesture",this.dragHeadBarEv.bind(this));if(this.canHeadDblClick){eventjs.add(this.headBar,"dblclick",this.displayBodyToggle.bind(this))}eventjs.add(this.rootFrame,"click touch",this.rootFrameClickEv.bind(this))},rootFrameClickEv:function(d,c){eventjs.cancel(d);if(geomap._FrameLayerZIndex){geomap._FrameLayerZIndex+=1;this.rootFrame.style.zIndex=geomap._FrameLayerZIndex}else{geomap._FrameLayerZIndex=geomap.util.formatNum(this.rootFrame.style.zIndex);this.rootFrame.style.zIndex=geomap._FrameLayerZIndex}},dragHeadBarEv:function(e,d){eventjs.cancel(e);if(d.state=="down"){var c=d.x,i=d.y;this._start_point=new a(c,i);this._status_drag=true;this.rootFrameClickEv(e,d)}else{if(d.state=="up"){this._status_drag=false;var h=new a(d.x,d.y);h._subtract(this._start_point);var g=this.x+h.x,f=this.y+h.y;if(g<(this.closeBtnSize-this.w)){g=this.closeBtnSize-this.w}else{if(g>(window.innerWidth-5)){g=window.innerWidth-5}}if(f<0){f=0}else{if(f>(window.innerHeight-this.headHeight)){f=window.innerHeight-this.headHeight}}this.x=g;this.y=f;this.resetStyle()}else{if(this._status_drag){var h=new a(d.x,d.y);h._subtract(this._start_point);var g=this.x+h.x,f=this.y+h.y;if(g<(this.closeBtnSize-this.w)){g=(this.closeBtnSize-this.w)}else{if(g>(window.innerWidth-5)){g=window.innerWidth-5}}if(f<0){f=0}else{if(f>(window.innerHeight-this.headHeight)){f=window.innerHeight-this.headHeight}}this.rootFrame.style.left=g+"px";this.rootFrame.style.top=f+"px"}}}},resetPos:function(){var c=this.container.clientWidth||window.clientWidth,d=this.container.clientHeight||window.innerHeight;var e=this.posPad;if(this.pos==="center"){this.x=Math.floor((c-this.w)/2);this.y=Math.floor((d-this.h)/2);return this}if(this.pos==="rc"){this.x=Math.floor((c-this.w))-e;this.y=Math.floor((d-this.h)/2);return this}if(this.pos==="lc"){this.x=e;this.y=Math.floor((d-this.h)/2);return this}if(this.pos==="lb"){this.x=e;this.y=d-this.h-e;return this}if(this.pos==="rb"){this.x=c-this.w-e;this.y=d-this.h-e;return this}if(this.pos==="rt"){this.x=c-this.w-e;this.y=e;return this}if(this.pos==="lt"){this.y=e;this.x=e;return this}},resetStyle:function(){this.bodyheight=this.h-this.headHeight;var c=window.innerWidth,g=window.innerHeight;this.w=Math.min(this.w,c);this.h=Math.min(this.h,g);var f=this.w-this.closeBtnSize-this.padding,e=this.padding;var d=this.headHeight-this.padding;geomap.element.setStyle(this.closeBtn,{width:this.closeBtnSize+"px",height:this.closeBtnSize+"px",left:f+"px",top:e+"px"});geomap.element.setStyle(this.headBar,{width:(this.w-this.padding)+"px",height:d+"px",paddingLeft:this.padding+"px",paddingTop:this.padding+"px"});if(this.showBody){geomap.element.setStyle(this.bodyBar,{width:this.w+"px",height:this.bodyheight+"px",top:this.headHeight+"px",display:""});geomap.element.setStyle(this.rootFrame,{width:this.w+"px",height:this.h+"px",top:this.y+"px",left:this.x+"px"})}else{geomap.element.setStyle(this.bodyBar,{width:this.w+"px",height:"0px",top:this.headHeight+"px",display:"none"});geomap.element.setStyle(this.rootFrame,{width:this.w+"px",height:this.headHeight+"px",top:this.y+"px",left:this.x+"px"})}return this},resetBody:function(){this.setTitle(this.title);this.setBody(this.body);return this},setTitle:function(c){this.title=c;this.headBar.innerHTML=this.title;return this},setBody:function(c){this.body=c;if(this.body===undefined){this.bodyBar.innerHTML=""}else{if(typeof this.body==="string"){this.bodyBar.innerHTML=this.body}else{this.bodyBar.innerHTML="";this.bodyBar.appendChild(this.body)}}if(this._loadBody){this.fire("datachange")}this._loadBody=true;return this},setData:function(e,c,d){this.setTitle(e);this.setBody(c);if(d!=undefined){this._setOptions(d);this.resetStyle()}},close:function(){if(this.closeType===1){this.fire("closestart");this.body=null;this.container.removeChild(this.rootFrame);this.fire("close");delete this}else{this.hide();this.fire("close")}},show:function(){if(this.rootFrame.style.display==="none"){this.rootFrame.style.display="";this.fire("show")}return this},hide:function(){if(this.rootFrame.style.display!="none"){this.rootFrame.style.display="none";this.fire("hide")}return this},displayToggle:function(){if(this.rootFrame.style.display==="none"){this.show()}else{this.hide()}},displayBodyToggle:function(){this.showBody=!this.showBody;this.resetStyle()}})})();(function(){var c=geomap.Point;var a=geomap.Bounds;var b=geomap.util.toPoint;geomap.Model={origin:new c(-180,90),tileSize:256,res:undefined,bounds:undefined,center:new c(0,0),viewSize:undefined,zoom:0,map:undefined,transformtion:new geomap.Transformtion(1,0,-1,0),transformtion2:new geomap.Transformtion(1,0,1,0),resolution:function(e){var d=(360/(Math.pow(2,e))/this.tileSize);var f=(180/(Math.pow(2,e))/this.tileSize);return new c(d,f)},getScale:function(d){return this.tileSize*Math.pow(2,d)},getZoomScale:function(d,e){e=e===undefined?this.zoom:e;return this.getScale(d)/this.getScale(e)},getBounds:function(){return this._getBounds().clone()},_getBounds:function(){if(!this._bounds||this._boundsChanged){var e,g,i,h,f,d;h=this.center;e=this.resolution(this.zoom);g=this.getSize().divideBy(2);i=e._scaleBy(g);f=h.subtract(this.modelCoord(i));d=h.add(this.modelCoord(i));this._bounds=new a(f,d);this._boundsChanged=false}return this._bounds},setZoom:function(d){if(this.zoom!=d){this._boundsChanged=true}this.zoom=d;return this},setZoomCoord:function(h,f){if(this.zoom==f){return this}var g=this.coordToScreen(h);var d=this.resolution(f);var e=h.subtract(this.modelCoord(g._scaleBy(d)));this.center=this.getSize().divideBy(2)._scaleBy(d).add(e);this.zoom=f;this._boundsChanged=true;return this},setZoomScreen:function(d,e){var f=d;r1=this.resolution(e),coord=this.screenToCoord(f),viewHalf=this.getSize().divideBy(2),centerOffset=viewHalf.subtract(f);this.center=coord._add(this.modelCoord(centerOffset._scaleBy(r1)));this.zoom=e;this._boundsChanged=true;return this},panScreen:function(f){var g=b(f);var e=this.zoom;var d=this.resolution(e);this.center._subtract(this.modelCoord(g.scaleBy(d)));this._boundsChanged=true},screenToCoord:function(g){var e=this.getBounds();var d=this.resolution(this.zoom);var f=this.modelCoord(d._scaleBy(g));return e.min._add(f)},coordToScreen:function(g){var e=this.getBounds();var d=this.resolution(this.zoom);var f=this.modelCoord(g.subtract(e.min));return f._unscaleBy(d)},toTransform:function(e,d){return this.transformtion.transform(e,d)},modelCoord:function(d){return this.toTransform(d,1)},toTransformScreen:function(d,e){return this.transformtion2.transform(d,e)}}})();(function(){var c=geomap.Point;var a=geomap.Bounds;var b=geomap.util.toPoint;geomap.Caliper={capliperPos:[5,5],capliperHeight:150,capliperWidth:3,caliperDraw:function(t){var u=this.maxZoom;var e=this.minZoom;var m=this.zoom,j=u-e+1;var q=this.capliperPos[0],o=this.capliperPos[1],s=this.capliperHeight,g=Math.ceil(s/j),l=this.capliperWidth;s=g*(j-1);var f=m-e,k=o+f*g;t.fillStyle="#009688";t.strokeStyle="#009688";this.drawTriangle(t,q,k,l,q,o,g,l,f);if((f+1)==j){t.strokeStyle="#009688"}else{var r=(k-o+1)/s;r=r>1?1:r;var d=t.createLinearGradient(q,o,q,o+s);d.addColorStop(0,"#009688");d.addColorStop(r,"#009688");d.addColorStop(r,"#000000");d.addColorStop(1,"#000000");t.strokeStyle=d}t.beginPath();t.moveTo(q,o);t.lineTo(q,o+s);for(var h=0;h<j;h++){var n=h*g;var p=(h%2)*l+l;t.moveTo(q,o+n);t.lineTo(q+p,o+n)}t.stroke()},drawTriangle:function(q,p,o,e,n,m,g,k,j){q.fillStyle="#009688";q.strokeStyle="#009688";q.beginPath();q.moveTo(n,m);q.lineTo(n,o);for(var h=0;h<j;h++){var l=h*g;var f=(h%2)*k+k;q.moveTo(n,m+l);q.lineTo(n+f,m+l)}var d=j%2*k+k;q.moveTo(p,o);q.lineTo(p+d,o);q.stroke();q.moveTo(p,p);q.arc(p,o,e,0,Math.PI*2,true);q.fill()}}})();(function(){var a=geomap.Point;geomap.MapEvent={wheelDebounceTime:40,wheelPxPerZoomLevel:60,_preformWheelZoom:function(d,g){var h=this._wheel_delta,i=this.zoom,k=this.zoom,f=0,b=h/(this.wheelPxPerZoomLevel*4),l=4*Math.log(2/(1+Math.exp(-Math.abs(b))))/Math.LN2,j=f?Math.ceil(l/f)*f:l,c=this._limitZoom(k+(this._wheel_delta>0?j:-j))-k;if(this._wheel_delta>0){if(this._wheel_d0>=0){if(this._wheel_d0<this._wheel_delta){this._wheel_d0=this._wheel_delta;this._wheel_d1=0}else{if(this._wheel_d1==0){this._wheel_d1=1;var i=this.zoom;var k=this._limitZoom(i+1);this.setZoomScreen(g,k);this.fire("zoom",{event:d,point:g,delta:this._wheel_delta});this.fire("wheelzoom",{event:d,point:g,delta:this._wheel_delta,startZoom:i,endZoom:k})}else{this._wheel_d0=this._wheel_delta}}}}else{if(this._wheel_d2<=0){if(this._wheel_d2<=this._wheel_delta){this._wheel_d2=this._wheel_delta;this._wheel_d1=0}else{if(this._wheel_d1==0){this._wheel_d1=1;var i=this.zoom;var k=this._limitZoom(i-1);this.setZoomScreen(g,k);this.fire("zoom",{event:d,point:g,delta:this._wheel_delta});this.fire("wheelzoom",{event:d,point:g,delta:this._wheel_delta,startZoom:i,endZoom:k})}else{this._wheel_d2=this._wheel_delta}}}}this.__wheel_startTime=null;if(!c){return}var e=Math.ceil(k+c)},wheelZoomStart:function(c,b,d){this._wheel_delta=0;this._wheel_d0=0;this._wheel_d1=0;this._wheel_d2=0;this.fire("zoomstart",{event:c,point:b,delta:d,zoom:this.zoom})},wheelZoom:function(d,c,f){this._wheel_delta=f;if(!this.__wheel_startTime){this.__wheel_startTime=+new Date()}var b=Math.max(this.wheelDebounceTime-(+new Date()-this.__wheel_startTime),0);if(this.__wheeltimer){clearTimeout(this.__wheeltimer);this.__wheeltimer=null}this.__wheeltimer=setTimeout(this._preformWheelZoom.bind(this,d,c),b)},wheelZoomEnd:function(c,b,d){this._wheel_d0=0;this._wheel_d1=0;this._wheel_d2=0;this.fire("zoomend",{event:c,point:b,delta:d})},dragStart:function(c,b){this.__startPos=b;this.__bounds_changed=(!c.ctrlKey&&!c.altKey);this.fire("dragstart",{event:c,point:b,boundsChanged:this.__bounds_changed})},dragChange:function(c,b){if(this.__bounds_changed){this.panScreen(b.subtract(this.__startPos))}this.fire("drag",{event:c,point:b,boundsChanged:this.__bounds_changed});this.__startPos=b},dragEndWithInertiaSpeed:function(b){var c=b.event;if(this._animMoveFn){this._animMoveFn.stop()}else{this._animMoveFn=new geomap.PosAnimation({easeLinearity:0.1});this._animMoveFn.on("end",function(){var g=this.other;var f=this.arg;g.fire("dragend",f);g.__bounds_changed=true}.bind({other:this,args:b}))}var e=b.point;var d=new a(b.event.inertiaSpeed[0],b.event.inertiaSpeed[1]);this._animMoveFn.run(this,function(i,h){this.other.panScreen(i);var g=this.startP.add(i);this.startP=g;var f=this.arg;f.point=g;this.other.fire("drag",f)},[d,new a(0,0)],0.4,{startP:e,other:this,arg:b})},dragEnd:function(c,b){if(c.openInertia){this.dragEndWithInertiaSpeed({event:c,point:b,boundsChanged:this.__bounds_changed})}else{this.fire("dragend",{event:c,point:b,boundsChanged:this.__bounds_changed});this.__bounds_changed=true}},touchZoomStart:function(c,b){this.__touch_point=b;this.__touch_zoom=this.zoom;this.fire("touchzoomstart",{event:c,point:this.__touch_point})},touchZoom:function(g,f,i){var b=this.getScale(this.__touch_zoom);var d=b*i;var c=Math.round(Math.log(d/256)/Math.LN2);var h=this._limitZoom(c);this.setZoomScreen(this.__touch_point,h);this.zoom=h;this.fire("touchzoom",{event:g,scale:i,point:f})},touchZoomEnd:function(g,f,i){var b=this.getScale(this.__touch_zoom);var d=b*i;var c=Math.round(Math.log(d/256)/Math.LN2);var h=c;this.setZoomScreen(this.__touch_point,h);this.zoom=h;this.fire("touchzoomend",{event:g,scale:i,point:this.__touch_point})}}})();(function(){var c=geomap.Point;var a=geomap.Bounds;var b=geomap.util.toPoint;geomap.MapRectSelect={_rectPoints:[],_movingPos:[0,0],RectSelectBindEvent:function(d){if(!this._RectSelectDrawDownID){this._RectSelectDrawDownID=this.RectSelectDrawDown.bind(this);this._RectSelectDrawUpID=this.RectSelectDrawUp.bind(this);this._RectSelectDrawMovingID=this.RectSelectDrawMoving.bind(this);this._RectSelectDrawID=this.RectSelectDraw.bind(this);d.on("mousedown",this._RectSelectDrawDownID);d.on("mouseup",this._RectSelectDrawUpID);d.on("mousemove",this._RectSelectDrawMovingID);d.on("drawingCanvas",this._RectSelectDrawID)}},RectSelectDrawDown:function(d){if(d.event.altKey){this.__status_draw=true;this.__status_draw_p0=d.point;this._movingPos=d.point;this.fire("drawCanvas")}},RectSelectDrawMoving:function(d){this._movingPos=d.point},RectSelectDrawUp:function(h){if(this.__status_draw&&this.__status_draw_p0){if(this.__status_draw_p0.equals(h.point)){var i=this.screenToCoord(h.point);var d={event:h,coord:i};this.fire("pointcoord",d);this.__status_draw=false;return}else{this.__status_draw_p1=h.point;var g=this.screenToCoord(this.__status_draw_p0);var f=this.screenToCoord(this.__status_draw_p1);var d={event:h,minx:Math.min(g.x,f.x),miny:Math.min(g.y,f.y),maxx:Math.max(g.x,f.x),maxy:Math.max(g.y,f.y)};this.fire("rectcoord",d);this.__status_draw=false}}},RectSelectDraw:function(d){if(this.__status_draw&&this._movingPos){var f=this.__status_draw_p0,e=this._movingPos;d.setLineDash([]);d.fillStyle="rgba(255, 255, 255, 0.4)";d.strokeStyle="#fff";d.beginPath();d.moveTo(f.x,f.y);d.lineTo(f.x,e.y);d.lineTo(e.x,e.y);d.lineTo(e.x,f.y);d.closePath();d.closePath();d.fill();d.stroke();this.fire("drawCanvas")}}}})();(function(c){if(!c.geomap){c.geomap={}}if(c.geomap.Map){geomap.warn("geomap.Map is already defined.");return}var d=geomap.util;var e=d.object.extend;var b=geomap.Point;var a=geomap.util.toPoint;geomap.Map=geomap.Class(geomap.CommonMethods,geomap.Observable,geomap.Model,geomap.MapEvent,geomap.Caliper,geomap.MapRectSelect,{type:"object",width:100,height:1000,viewOrigin:{x:0,y:0},center:undefined,canvas:undefined,canvasCtx:undefined,bgCanvas:undefined,bgCanvasCtx:undefined,zoom:2,maxZoom:11,minZoom:0,layers:[],_global_interval:null,_canrender:true,_container:undefined,_geometrys:[],model:undefined,loopTime:40,canvasRatio:1,initialize:function(f,g){g||(g={});this._setOptions(g);this._sizeChanged=true;if(g.debug){geomap.debug=g.debug}if(this.center===undefined){this.center=new b(0,0)}else{this.center=a(this.center)}this._container=f;this._initElement();this.on("drawmap",this.OnDrawMap.bind(this));this.on("drawCanvas",this.RedrawingCanvasTag.bind(this));this.on("clear_geometry",this.clearGeometry.bind(this));this.LoopTime()},_dispose:function(){geomap.util.cancelAnimFrame(this._global_interval);this._global_interval=null},_initElement:function(){this._container.style.position="absolute";this._container.style.overflow="hidden";var i=this.getSize();var j=i.x,f=i.y;var k=geomap.element.create("canvas",{id:"_map_canvas",width:j,height:f},{zIndex:2,border:"0px solid red",backgroundColor:"#e4e4e4",position:"absolute",width:j+"px",height:f+"px"});geomap.element.createHiDPICanvas(k,j,f,this.canvasRatio);var h=geomap.element.create("canvas",{width:j,height:f},{backgroundColor:"#e4e4e4",position:"absolute",width:j+"px",height:f+"px"});this.bgCanvas=h;this.bgCanvasCtx=h.getContext("2d");this._container.appendChild(k);this.canvas=k;const g=k.getContext("2d");this.canvasCtx=g;this._eventDrag=new geomap.Event.Drag(this);this._eventTouchZoom=new geomap.Event.TouchZoom(this);this._eventWheelZoom=new geomap.Event.ScrollWheelZoom(this);this._eventDrag.addEvent(this.canvas);this._eventTouchZoom.addEvent(this.canvas);this._eventWheelZoom.addEvent(this.canvas);this.RectSelectBindEvent(this);eventjs.add(this.canvas,"contextmenu",eventjs.cancel);eventjs.add(this.canvas,"click touch",function(n,m){var l=new b(n.offsetX||m.x,n.offsetY||m.y);var p=this.screenToCoord(l);var o=e({},{target:this,coord:p,point:l,event:n});this.fire("click",o)}.bind(this));eventjs.add(this.canvas,"mousedown",function(o,n){var m=new b(o.offsetX,o.offsetY);var l={event:o,point:m};this.fire("mousedown",l)}.bind(this));eventjs.add(this.canvas,"mousemove",function(o,n){var m=new b(o.offsetX,o.offsetY);var l={event:o,point:m};this.fire("mousemove",{event:o,point:m})}.bind(this));eventjs.add(this.canvas,"mouseup",function(o,n){var m=new b(o.offsetX,o.offsetY);var l={event:o,point:m};this.fire("mouseup",l)}.bind(this))},_limitZoom:function(f){if(this.maxZoom<f){return this.maxZoom}else{if(this.minZoom>f){return this.minZoom}}return f},LoopTime:function(){this.fire("looptime");for(var h=0,f=this.layers.length;h<f;h++){var g=this.layers[h];g.OnLoopTime()}this._redrawingCanvas.call(this);geomap.util.requestAnimFrame(this.LoopTime,this)},_redrawingCanvas:function(){if(this._redrawing==true||this._move_type==1){this._redrawing=false;const g=this.canvasCtx;var m=this.getSize();g.clearRect(0,0,m.x,m.y);for(var l=0,h=this.layers.length;l<h;l++){var j=this.layers[l];j.drawingCanvas(g)}var f=this._geometrys.length;if(f>0){for(var l=0;l<f;l++){var n=this._geometrys[l];n.render(g);if(n.loopRender){this._redrawing=true}}}this.caliperDraw(g);this.fire("drawingCanvas",g)}},OnDrawMap:function(){this.fire("viewreset");this._redrawing=true},RedrawingCanvasTag:function(){this._redrawing=true},_loadLayer:function(f){f.on("drawCanvas",this.RedrawingCanvasTag.bind(this));f.initLayer(this.canvas,this)},addLayer:function(f){this._loadLayer(f);this.layers.push(f);this.fire("drawmap")},setCenter:function(g,f){g=a(g);this.center=g;this._boundsChanged=true;if(f!=undefined&&typeof f=="number"){this.setZoom(f)}},animMove:function(h){h=a(h);var k,o=this.getSize(),j=this.coordToScreen(h).round();var m=o.divideBy(2).round();var i=Math.round(j.distanceTo(m));var g=Math.round(Math.sqrt(o.x*o.x+o.y*o.y));if(i>g){var f=i/g;var n,l;n=j.x-(j.x-m.x)*f;l=j.y+(m.y-j.y)*f;j=this.modelCoord(new b(n,l).round());k=this.screenToCoord(j)}else{k=this.center}if(!h.equals(this.center)){if(this._animMoveFn){this._animMoveFn.stop()}else{this._animMoveFn=new geomap.PosAnimation()}this._animMoveFn.run(this,function(p){this.setCenter(p);this.fire("drawmap")},[k,h],1,this)}},moveTo:function(h,f,g){this.setCenter(a(h));if(f===undefined){}else{if(typeof f=="string"){f=Number(f)}this.setZoom(f)}this.fire("drawmap")},getSize:function(){if(!this._size||this._sizeChanged){this._size=new b(this._container.clientWidth||this.width,this._container.clientHeight||this.height);this._sizeChanged=false}return this._size.clone()},resize:function(){this._sizeChanged=true;var f=this.getSize();geomap.element.createHiDPICanvas(this.canvas,f.x,f.y,this.canvasRatio);geomap.element.createHiDPICanvas(this.bgCanvas,f.x,f.y,this.canvasRatio);this._boundsChanged=true;this._redrawing=true;this.fire("resize");this.fire("drawmap")},getCoord:function(f){return this.model.screenToCoord(d.toPoint(f))},addGeometry:function(f){this._geometrys.push(f);this._redrawing=true},clearGeometry:function(){this._geometrys=[];this._redrawing=true}})})(typeof exports!=="undefined"?exports:this);(function(){geomap.Geometry=geomap.Class(geomap.CommonMethods,geomap.Observable,{_coordinates:[],_map:null,_start:true,_fill:false,_pointWeight:6,_type:0,style:{fillStyle:"rgba(0, 0, 0, 0.4)",strokeStyle:"rgba(0,255,255,0.9)",lineWidth:2},lineDashOffset:0,lineDash:[],loopRender:false,initialize:function(b,a){a||(a={});this._setOptions(a);this._map=b;this._type=0},setMap:function(a){this._map=a},s2c:function(a){return this._map.screenToCoord(a)},c2s:function(a){return this._map.coordToScreen(a).round()},addCoord:function(b){var a=this._coordinates.length;if(a>0){if(!this._coordinates[a-1].equals(b)){this._coordinates.push(b)}}else{this._coordinates.push(b)}},setType:function(a,b){this.clear();this._fill=b||false;if(typeof a=="string"){if(a=="Polygon"){this._type=0}else{if(a=="Point"){this._type=1}else{if(a=="Line"){this._type=2}else{if(a=="Rect"){this._type=3}else{if(a=="Circle"){this._type=4}}}}}}else{this._type=a}},getType:function(){var a="Polygon";switch(this._type){case 1:a="Point";break;case 2:a="Line";break;case 3:a="Rect";break;case 4:a="Circle";break}return a},push:function(a){var b=this.s2c(a);this.addCoord(b)},clear:function(){var c=this._coordinates;this._coordinates=[];var a=c.length;for(var b=0;b<a;b++){c[b]=null}},moveTo:function(a){if(this._start){this._movePoint=a}},end:function(){this._movePoint=null;this._start=false;var a=this._coordinates.length;switch(this._type){case 0:if(a>2){this._coordinates.push(this._coordinates[0])}else{this.clear()}break;case 2:if(a<2){this.clear()}break;case 3:case 4:if(a!=2){this.clear()}break}},isEnd:function(){switch(this._type){case 1:return this._coordinates.length==1;case 3:case 4:return this._coordinates.length==2}return false},setStyle:function(a){var b=this.style;for(var c in b){a[c]=b[c]}},getText:function(){var a=this.getJson();return JSON.stringify(a)},getJson:function(){var e=this._coordinates,b=e.length;var a={type:"",coordinates:[]};if(b<1){return a}switch(this._type){case 1:a.type="Point";a.coordinates=[e[0].x,e[0].y];break;case 2:a.type="Line";for(var c=0;c<b;c++){a.coordinates.push([e[c].x,e[c].y])}break;case 3:a.type="Polygon";if(b>1){var g=e[0],f=e[1],d=[];d.push([g.x,g.y]);d.push([g.x,f.y]);d.push([f.x,f.y]);d.push([f.x,g.y]);d.push([g.x,g.y]);a.coordinates.push(d)}break;default:a.type="Polygon";if(b>1){var g=e[0],f=e[1],d=[];for(var c=0;c<b;c++){d.push([e[c].x,e[c].y])}a.coordinates.push(d)}}return a},render:function(b){var a=this._coordinates.length;b.setLineDash([]);if(this.lineDash&&this.lineDash.length>1){b.setLineDash(this.lineDash);b.lineDashOffset=this.lineDashOffset;this.lineDashOffset+=1;this.loopRender=true}else{this.loopRender=false}if(a>0){this.setStyle(b);switch(this._type){case 0:b.beginPath();var h=this.c2s(this._coordinates[0]);b.moveTo(h.x,h.y);for(var c=1;c<a;c++){var g=this._coordinates[c];var e=this.c2s(g);b.lineTo(e.x,e.y)}if(this._start&&this._movePoint&&this._movePoint!=null){b.lineTo(this._movePoint.x,this._movePoint.y)}b.closePath();b.stroke();if(this._fill){b.fill()}break;case 1:var e=this.c2s(this._coordinates[0]),d=this._point_weight;b.fillRect(e.x-d/2,e.y-d/2,d,d);b.strokeRect(e.x-d/2,e.y-d/2,d,d);break;case 2:b.beginPath();var h=this.c2s(this._coordinates[0]);b.moveTo(h.x,h.y);for(var c=1;c<a;c++){var g=this._coordinates[c];var e=this.c2s(g);b.lineTo(e.x,e.y)}if(this._start&&this._movePoint&&this._movePoint!=null){b.lineTo(this._movePoint.x,this._movePoint.y)}b.stroke();break;case 3:var h=this.c2s(this._coordinates[0]),f;if(a==2){f=this.c2s(this._coordinates[1]).subtract(h);this._fill?b.fillRect(h.x,h.y,f.x,f.y):b.strokeRect(h.x,h.y,f.x,f.y)}else{if(this._start&&this._movePoint&&this._movePoint!=null){f=this._movePoint.subtract(h);this._fill?b.fillRect(h.x,h.y,f.x,f.y):b.strokeRect(h.x,h.y,f.x,f.y)}}}}}})})();(function(){var a=geomap.Point;geomap.Path=geomap.Class(geomap.Geometry,{lineDash:null,initialize:function(c,b){b||(b={});this.callSuper("initialize",c,b)},setData:function(e){var b=e.coordinates;this._type=0;this._coordinates=[];if(b.length>0){var f=b[0];if(f.length>0){for(var d=0,c=f.length;d<c;d++){this._coordinates.push(new a(f[d][0],f[d][1]))}}}this._map.fire("drawmap")}})})();(function(){var b=geomap.Point;var a=geomap.util.object.clone;geomap.Polygon=geomap.Class(geomap.Geometry,{initialize:function(d,c){c||(c={});this.callSuper("initialize",d,c);this._type=0},setData:function(f){var c=f.coordinates;this._type=0;this._coordinates=[];if(c.length>0){var g=c[0];if(g.length>0){for(var e=0,d=g.length;e<d;e++){this._coordinates.push(new b(g[e][0],g[e][1]))}}}this._map.fire("drawmap")}})})();(function(){var a=geomap.Point;geomap.Marker=geomap.Class(geomap.CommonMethods,geomap.Observable,geomap.Geometry,{type:"Marker",canvas:null,ctx:null,point:null,width:400,height:200,ratio:3,radius:10,lineV:20,padding:10,textRows:[],style:{fillStyle:"rgba(0, 0, 0, 0.9)"},fontStyle:{font:"bold 14px serif",fillStyle:"white"},initialize:function(e,d){this._map=e;d||(d={});if(d.style){d.style=geomap.util.object.extend(this.style,d.style)}this._setOptions(d);this._type=0;var c=geomap.element.create("canvas");var b=c.getContext("2d");geomap.element.createHiDPICanvas(c,this.width,this.height,this.ratio);this.canvas=c;this.ctx=b;this.point=new a(100,100)},setData:function(f){var g=f.geometry;var d=f.properties;this.textRows=[];if(d!=undefined){var b=this.ctx;var e=this.getRectTextSize();for(var c in d){this.drawText(b,c+":"+d[c],e[0])}}this.draw();this._map.fire("drawmap")},draw:function(){var k=this.ctx,d=this.width,j=this.height;k.clearRect(0,0,d,j);this.roundedRect(k,0,0,d,j,this.radius);var e=this.fontStyle;for(var c in e){k[c]=e[c]}var h=this.textRows.length,g=this.padding+this.lineV,i=this.padding;for(var f=0;f<h;f++){k.fillText(this.textRows[f],i,g);g+=this.lineV}},getRectTextSize:function(){var b=this.width-(this.padding*2),c=this.height-(this.padding*2);return[b,c]},drawText:function(d,f,c){var g=f.split("");var e="";for(var b=0;b<g.length;b++){if(d.measureText(e).width<c&&d.measureText(e+(g[b])).width<=c){e+=g[b]}else{this.textRows.push(e);e=g[b]}}this.textRows.push(e)},render:function(c){var b=this.width,d=this.height;c.drawImage(this.canvas,this.point.x,this.point.y,b,d)},roundedRect:function(e,d,g,f,c,b){this.setStyle(e);e.beginPath();e.moveTo(d,g+b);e.lineTo(d,g+c-b);e.quadraticCurveTo(d,g+c,d+b,g+c);e.lineTo(d+f-b,g+c);e.quadraticCurveTo(d+f,g+c,d+f,g+c-b);e.lineTo(d+f,g+b);e.quadraticCurveTo(d+f,g,d+f-b,g);e.lineTo(d+b,g);e.quadraticCurveTo(d,g,d,g+b);e.fill()}})})();(function(b){var d=geomap.util.object.extend;var a=geomap.Point;if(!b.geomap){b.geomap={}}if(b.geomap.Layer){geomap.warn("geomap.Map is already defined.");return}var c={type:"Layer",width:100,height:100,_canvas:null,_map:undefined,transformtion:null,wheelZoomChanage:false,canvas:null,canvasCtx:null,cacheTime:0,initLayer:function(e,g){this.transformtion=new geomap.Transformtion(-1,0,-1,0);this._canvas=e;this._drawLock=1;this._map=g;this.cacheTime=+new Date();var e=geomap.element.create("canvas",{},{zIndex:2,border:"1px solid blue",backgroundColor:"#e4e4e4",position:"absolute",top:"0px"});var f=e.getContext("2d");this.canvas=e;this.canvasCtx=f;this.OnResize();g.on("resize",this.OnResize.bind(this));g.on("viewreset",this.ViewReset.bind(this));g.on("dragstart",this.OnDragStart.bind(this));g.on("drag",this.OnDrag.bind(this));g.on("dragend",this.OnDragEnd.bind(this));g.on("touchzoomstart",this.OnTouchZoomStart.bind(this));g.on("touchzoom",this.OnTouchZoom.bind(this));g.on("touchzoomend",this.OnTouchZoomEnd.bind(this));g.on("wheelzoom",this.OnScrollZoom.bind(this));this.fire("initLayer");this.ViewReset()},OnResize:function(){var e=this._map.getSize();this.width=e.x;this.height=e.y;this.canvas.width=e.x;this.canvas.height=e.y;this.canvas.style.width=e.x+"px";this.canvas.style.height=e.y+"px"},OnTouchZoomStart:function(e){var f=e.event,g=e.point;this._touchZoomStart=g},OnTouchZoom:function(e){var f=e.event,g=e.scale;this._canvasScale=geomap.util.formatNum(g,4);this.fire("drawCanvas")},OnTouchZoomEnd:function(e){this._touchZoomStart=null;this.ViewReset()},scrollZoomEnd:function(e){this._canvasScale=1;this.ViewReset()},OnScrollZoom:function(e){if(e.startZoom==e.endZoom){return}if(this._animMoveFn){this._animMoveFn.stop()}else{this._animMoveFn=new geomap.PosAnimation({easeLinearity:0.1});this._animMoveFn.on("end",function(){this._touchZoomStart=null;this._canvasScale=1;this.wheelZoomChanage=false;this.ViewReset()}.bind(this))}this._touchZoomStart=e.point;this._animMoveFn.run(this._map,function(j,h){var g=this._map.getScale(h.pos[0].x)/256;var f=this._map.getScale(j.x)/256;var i=f/g;this._canvasScale=i;this.wheelZoomChanage=true;this.fire("drawCanvas")},[new a(e.startZoom,0),new a(e.endZoom,0)],0.4,this)},OnDragStart:function(e){this._dragStartPos=e.point},OnDrag:function(e){if(e.boundsChanged){this._dragOffset=e.point.subtract(this._dragStartPos);this.fire("drawCanvas")}},OnDragEnd:function(f){this._dragOffset=null;this.ViewReset()},ViewReset:function(){this.fire("drawCanvas")},getCanavsSize:function(){return this._map.getSize()},OnLoopTime:function(){},refreshCache:function(){this.cacheTime=+new Date();this.ViewReset()}};geomap.Layer=geomap.Class(geomap.CommonMethods,geomap.Observable,c,{initialize:function(e){e||(e={});this._setOptions(e)},drawingCanvas:function(m,f){var e=this._map,k=new a(0,0),n=this.getCanavsSize(),i=this._dragOffset||k,l=(this._touchZoomStart||k),g=(this._canvasScale||1),h=n.multiplyBy(g).round();var j=this.transformtion.transform(l.clone(),g)._add(l).add(i).round();m.drawImage(this.canvas,j.x,j.y,h.x,h.y)}})})(typeof exports!=="undefined"?exports:this);(function(b){var c=geomap.util.object.extend;var a=geomap.Point;if(!b.geomap){b.geomap={}}if(b.geomap.TileLayer){geomap.warn("geomap.Map is already defined.");return}geomap.TileLayer=geomap.Class(geomap.Layer,{url:null,_drawLock:1,cache:true,_canvas_map_size:new a(0,0),_mapSize:null,_tiles:{},initialize:function(d){this.callSuper("initialize",d);this.on("initLayer",this.OnInitLayer.bind(this));this._drawCallbackID=this.drawCallback.bind(this)},OnInitLayer:function(){this.getCanavsSize()},getCanavsSize:function(){var e=this._map,d=e.getSize();if(!this._canvas_copy_size||!this._mapSize||!d.equals(this._mapSize)){this._mapSize=d.clone();this._canvas_copy_size=d.multiplyBy(3);this.canvas.width=this._canvas_copy_size.x;this.canvas.height=this._canvas_copy_size.y;this.canvas.style.width=this._canvas_copy_size.x+"px";this.canvas.style.height=this._canvas_copy_size.y+"px";this._canvas_map_size=d;this.transformtion.setOrigin(-d.x,-d.y)}return this._canvas_copy_size},ViewReset:function(){this._canvasScale=1;var G=this._map,o=G.zoom,f=G.tileSize,m=G.getBounds(),J=G.resolution(o),e=this.getCanavsSize(),D=this._canvas_map_size,F=this._drawLock+1;var g=Math.round(D.x/f)+2;var s=Math.round(D.y/f)+2;var i=this.OriginTileInfo(J,m.min);var d=i.cell;var j=i.row;var h=i.left;var w=i.top;this._drawLock=F;for(var I in this._tiles){this._tiles[I]=null}this._tiles={};this.canvasCtx.clearRect(0,0,e.x,e.y);for(var E=-0,C=g;E<C;E++){for(var v=-0,n=s;v<n;v++){var q=1*d+E;var p=1*j+v;var A=Math.floor(h+f*E)+D.x;var u=Math.floor(w+f*v)+D.y;if(q>=0&&p>=0){var B="cr-"+E+"-"+v;var H={x:q,y:p,z:o,left:A,top:u,col:E,row:v,cacheTime:this.cacheTime,ctx:this.canvasCtx,tag:0,tileId:B};if(this._tiles[B]){this._tiles[B]=null;delete this._tiles[B]}this._tiles[B]=H}}}this.loadTileSource()},loadTileSource:function(){if(!this._tileImageMap){this._tileImageMap=[]}for(var f=0,e=this._tileImageMap.length;f<e;f++){var d=this._tileImageMap[f];d.tag=0}this._tileImageMap2=[];for(var h in this._tiles){var g=this._tiles[h];for(var f=0,e=this._tileImageMap.length;f<e;f++){var d=this._tileImageMap[f];if(d.isTile(g)){d.loadTile(this.url,g,this._drawCallbackID);d.tag=1;g.tag=1;f=e}}}for(var h in this._tiles){var g=this._tiles[h];if(g.tag==0){for(var f=0,e=this._tileImageMap.length;f<e;f++){var d=this._tileImageMap[f];if(d.tag==0){d.on("drawend",this._drawCallbackID);d.loadTile(this.url,g);d.tag=1;g.tag=1;f=e}}if(g.tag==0){var d=new geomap.Image(g);d.on("drawend",this._drawCallbackID);d.loadTile(this.url,g);g.tag=1;d.tag=1;this._tileImageMap.push(d)}}}},drawCallback:function(e){this.fire("drawCanvas");var d=this._tiles[e.tileId];if(d){this._tiles[e.tileId]=null;delete this._tiles[e.tileId]}},OriginTileInfo:function(h,g){var d=this._map,e=d.origin,m=d.tileSize;var k=g.x,j=g.y;var l=Math.floor((g.x-e.x)/h.x/m);var n=Math.floor((e.y-g.y)/h.y/m);var f=-(g.x-e.x)/h.x+m*l;var i=-(e.y-g.y)/h.y+m*n;return{cell:l,row:n,left:f,top:i,res:h,tsize:m}}})})(typeof exports!=="undefined"?exports:this);(function(b){var c=geomap.util.object.extend;var a=geomap.Point;if(!b.geomap){b.geomap={}}if(b.geomap.Palette){geomap.warn("geomap.Map is already defined.");return}geomap.VectorLayer=geomap.Class(geomap.Layer,{type:"VectorLayer",paths:[],drawType:0,fill:true,loopRender:false,_enabled:true,initialize:function(d){this.callSuper("initialize",d);this.on("initLayer",this.OnInitLayer.bind(this))},OnInitLayer:function(){this.transformtion.setOrigin(0,0)},setType:function(d,e){this.drawType=d;if(e!=undefined){this.fill=e}if(this._pathing){this._pathing.setType(this.drawType,this.fill)}},addData:function(g,e){if(g.type=="FeatureCollection"){var d=g.features.length;for(var f=0;f<d;f++){var j=g.features[f].geometry;var h=new geomap.Path(this._map,e);h.setData(j);this.paths.push(h)}}else{if(g.type=="Feature"){var j=g.geometry;var h=new geomap.Path(this._map,e);h.setData(j);this.paths.push(h)}else{this.paths.push(g)}}this.ViewReset()},clearData:function(){this.paths=[];this.ViewReset()},OnLoopTime:function(){if(this.loopRender&&(this._canvasScale==1||this._canvasScale==undefined)){this._dragOffset=null;this.ViewReset()}},ViewReset:function(){if(!this.wheelZoomChanage&&(this._canvasScale==1||this._canvasScale==undefined)){this.canvasCtx.clearRect(0,0,this.width,this.height);this._canvasScale=1;var j=this._map.zoom,g=this._map.getBounds(),f=this._map.resolution(j);this.loopRender=false;if(this.paths.length>0){for(var e=0,d=this.paths.length;e<d;e++){var h=this.paths[e];this.canvasCtx.setLineDash([]);h.render(this.canvasCtx);if(h.loopRender){this.loopRender=true}}}if(this._pathing&&this._pathing!=null){this._pathing.render(this.canvasCtx)}this.fire("drawCanvas")}}})})(typeof exports!=="undefined"?exports:this);(function(b){var c=geomap.util.object.extend;var a=geomap.Point;if(!b.geomap){b.geomap={}}if(b.geomap.Palette){geomap.warn("geomap.Map is already defined.");return}geomap.PaletteLayer=geomap.Class(geomap.Layer,{type:"PaltteLayer",paths:[],drawType:0,fill:true,loopRender:false,_enabled:true,referenceLine:false,initialize:function(d){this.callSuper("initialize",d);this.on("initLayer",this.OnInitLayer.bind(this))},OnInitLayer:function(){this._map.on("mousedown",this.OnMouseDown.bind(this));this._map.on("mousemove",this.OnMouseMove.bind(this));this._map.on("mouseup",this.OnMouseUp.bind(this));this.transformtion.setOrigin(0,0)},setType:function(d,e){this.drawType=d;if(e!=undefined){this.fill=e}if(this._pathing){this._pathing.setType(this.drawType,this.fill)}},OnMouseDown:function(g){if(!this._enabled){return}var d=g.event,f=g.point;if(d.ctrlKey){eventjs.cancel(d);this._opendraw=true;if(this._palette_drawing){this.fire("draw_point",g)}else{this._palette_drawing=true;this.fire("draw_start",g)}if(!this._pathing||this._pathing===null){this._pathing=new geomap.Path(this._map,{lineDash:[]});this._pathing.setType(this.drawType,this.fill)}}else{this._opendraw=false}},OnMouseMove:function(g){if(!this._enabled){return}var d=g.event,f=g.point;if(this._opendraw){if(!d.ctrlKey){if(this._palette_drawing){this._palette_drawing=false;this.fire("draw_end",g)}}else{if(this._palette_drawing){this.fire("draw_moving",g)}}if(this._pathing){if(!d.ctrlKey){this.PathEnd(g,f)}else{this._pathing.moveTo(f);this.ViewReset()}}}},OnMouseUp:function(g){if(!this._enabled){return}var d=g.event,f=g.point;if(!this._opendraw){this.PathEnd(g,f)}else{if(this._opendraw&&this._pathing){var f=g.point;this._pathing.push(f);this.ViewReset();if(this._pathing.isEnd()){this.PathEnd(g,f)}}}},addGeometry:function(d){this.paths.push(d);this.ViewReset()},clearGeometry:function(){this.paths=[];this.ViewReset()},PathEnd:function(f,d){if(this._pathing&&this._pathing!=null){this._pathing.end();this.fire("geometry_change",this._pathing);this.paths.push(this._pathing);this._pathing=null;this.ViewReset()}},OnLoopTime:function(){if(this.loopRender&&(this._canvasScale==1||this._canvasScale==undefined)){this._dragOffset=null;this.ViewReset()}},drawingCanvas:function(d){this.callSuper("drawingCanvas",d);this.drawReferenceLine(d)},ViewReset:function(){var d=this.canvasCtx;if(!this.wheelZoomChanage&&(this._canvasScale==1||this._canvasScale==undefined)){d.clearRect(0,0,this.width,this.height);d.setLineDash([]);this._canvasScale=1;var l=this._map.zoom,h=this._map.getBounds(),g=this._map.resolution(l);this.loopRender=false;if(this.paths.length>0){for(var f=0,e=this.paths.length;f<e;f++){var j=this.paths[f];j.render(d);if(j.loopRender){this.loopRender=true}}}if(this._pathing&&this._pathing!=null){this._pathing.render(d)}this.fire("drawCanvas")}},toggleReferenceLine:function(){this.toggle("referenceLine");this.fire("drawCanvas")},drawReferenceLine:function(f){if(!this.referenceLine){return}var e=this.width,j=this.height,l=20;f.strokeStyle="rgba(66, 66, 66, 0.3)";f.beginPath();for(var g=0;g<e;g++){var d=g*l,k=0;f.moveTo(d,k);f.lineTo(d,j)}for(var g=0;g<j;g++){var k=g*l,d=0;f.moveTo(d,k);f.lineTo(e,k)}f.stroke();l=10;f.strokeStyle="rgba(224, 224, 224, 0.3)";f.beginPath();for(var g=0;g<e;g++){var d=g*l,k=0;f.moveTo(d,k);f.lineTo(d,j)}for(var g=0;g<j;g++){var k=g*l,d=0;f.moveTo(d,k);f.lineTo(e,k)}f.stroke()}})})(typeof exports!=="undefined"?exports:this);var MapProject=MapProject||{version:"1.0.0"};if(typeof exports!=="undefined"){exports.MapProject=MapProject}else{if(typeof define==="function"&&define.amd){define([],function(){return MapProject})}}(function(e){if(!e.MapProject){e.MapProject={}}if(e.MapProject.Map){geomap.warn("MapProject.Map is already defined.");return}var f=geomap.util,a=geomap.request,d=f.template,b=f.toPoint;var g=f.object.extend;var c=geomap.Point;MapProject.Map=geomap.Class(geomap.Map,{mapId:undefined,server:{project:"",mapInfo:"",display:"",tile:"",addLayer:"",deleteLayer:"",orderChange:"",addParking:"",queryParking:"",deleteParking:"",},_server:{},_server_layers:[],codeOk:0,reqHead:"",_mapInfo:{},_projectMap:[],_init_map_status:false,drawType:"Rect",initialize:function(h,i){var j;if(typeof h==="string"){j=document.getElementById(h)}else{j=h}this.callSuper("initialize",j,i);this._init_reqcb();this._init_fireEv();this._reset_map_conf();this.loadProject()},_init_reqcb:function(){this._clearDrawGeometry=this.clearDrawGeometry.bind(this);this._drawMapGeom=this.__drawMapGeom.bind(this);this._queryCoordData=this.__queryCoordData.bind(this);this._reqcb_queryCoordData=this.__reqcb_queryCoordData.bind(this);this._reqcb_loadProject=this.__reqcb_loadProject.bind(this);this._reqcb_loadServerLayers=this.__reqcb_loadServerLayers.bind(this)},_init_fireEv:function(){this.on("req_project_ok",this._reqcb_loadProject_ok.bind(this))},loadProject:function(){a(this._server.project,{method:"POST",header:this.reqHead,onComplete:this._reqcb_loadProject});this.loadServerLayers()},__reqcb_loadProject:function(k){var i=k.status;if(i==200){var h=JSON.parse(k.response);if(h.code===this.codeOk){var j=h.data;if(j.projectMap){this._projectMap=j.projectMap}if(j.mapInfo){this._mapInfo=j.mapInfo;this.fire("req_project_ok",j.mapInfo);return}}this.fire("req_project_fail")}else{this.fire("req_error",k)}},_reqcb_loadProject_ok:function(){this.loadMapInfo(this._mapInfo)},_reset_server:function(){var j=this.mapId;for(var i in this.server){var h=this.server[i];this._server[i]=d(h,{mapId:j})}},__queryCoordData:function(i){this.vectorLayer.clearData();if(this.mapQuery){var h=d(this.mapQuery.url,{mapId:this.mapId});a(h,{method:"POST",body:"p="+i,header:this.reqHead,onComplete:this._reqcb_queryCoordData})}},__reqcb_queryCoordData:function(k){var i=k.response,h=k.status;this.vectorLayer.clearData();if(h==200&&i.length>0&&i.indexOf("{")==0){if(this.mapQuery){var j=JSON.parse(i);this.mapQuery.fire("coord_data",j)}if(j.type="FeatureCollection"){this.vectorLayer.addData(j,{style:{fillStyle:"rgba(0,0,200,0.5)",strokeStyle:"#fff",lineWidth:2},_fill:true,lineDash:[4,2]});this.fire("drawmap")}}},__drawMapGeom:function(j){if(this.mapDraw){var i=this;var h={geometry:j,layer:this.paletteLayer,clearDraw:this._clearDrawGeometry,map:i};this.mapDraw.fire("geom_data",h)}},clearDrawGeometry:function(){this.paletteLayer.clearGeometry()},_reset_map_conf:function(){this._reset_server();if(!this._init_map_status){this._init_map_status=true;var j=new geomap.TileLayer({url:this._server.tile});this.parkingLayer=j;var h=new geomap.VectorLayer();this.vectorLayer=h;var k=new geomap.PaletteLayer({drawType:this.drawType});this.paletteLayer=k;k.on("geometry_change",this._drawMapGeom);this.addLayer(j);this.addLayer(h);this.addLayer(k);var i=this._queryCoordData;this.on("pointcoord",function(m){var l=m.coord.x+","+m.coord.y;i(l)});this.on("rectcoord",function(m){var l=m.minx+","+m.miny+","+m.maxx+","+m.maxy;i(l)})}else{this.parkingLayer.url=this._server.tile;this.parkingLayer.refreshCache();this.vectorLayer.clearData();this.fire("drawmap")}this.fire("map_complete",this)},loadServerLayers:function(){a(this._server.mapInfo,{method:"POST",header:this.reqHead,onComplete:this._reqcb_loadServerLayers})},__reqcb_loadServerLayers:function(k){var i=k.status;if(i==200){var h=JSON.parse(k.response);if(h.code===this.codeOk){var j=h.data;if(j.layers){this._server_layers=j.layers;this.fire("server_layer_ok",this._server_layers);return}}this.fire("req_project_fail")}else{this.fire("req_error",k)}},loadMapInfo:function(h){if(h){this._mapInfo=h;this.mapId=h.mapId;this._reset_map_conf()}},mapChange:function(h){if(this._projectMap&&this._projectMap.length>h){var i=this._projectMap[h];this.loadMapInfo(i);this.loadProject()}},orderChangeFn:function(j,h){var i=this;a(this._server.orderChange,{method:"JSON",body:{oldIndex:j,newIndex:h},onComplete:function(m){var k=m.response,l=m.status;if(l==200){i.refresh()}}})},displayServerLayer:function(h,j){var i=this;a(this._server.displayLayer,{method:"JSON",body:{layerId:h,display:j},onComplete:function(m){var k=m.response,l=m.status;if(l==200){i.refresh()}}})},deleteServerLayer:function(h){var i=this;a(this._server.deleteLayer,{method:"JSON",body:{id:h},onComplete:function(l){var j=l.response,k=l.status;if(k==200){i.refresh()}}})},addServerLayer:function(i){var h=this;a(this._server.addLayer,{method:"JSON",body:i,onComplete:function(l){var j=l.response,k=l.status;if(k==200){h.refresh()}}})},setMapQuery:function(h){this.mapQuery=h},setMapDraw:function(h){this.mapDraw=h;this.paletteLayer.setType(this.mapDraw.drawType,this.mapDraw.fill)},jsonReq:function(h,j,i){var k=d(h,{mapId:this.mapId});a(k,{method:"JSON",body:j,header:this.reqHead,onComplete:i})},toggleReferenceLine:function(){this.paletteLayer.toggleReferenceLine()},refresh:function(){this.loadProject()}})})(typeof exports!=="undefined"?exports:this);(function(f){if(!f.MapProject){f.MapProject={}}if(f.MapProject.LayerInfo){geomap.warn("MapProject.Menu is already defined.");return}var g=geomap.util,b=geomap.request,e=g.template,c=g.toPoint,a=geomap.element;var h=g.object.extend;var d=geomap.Point;MapProject.LayerInfo=geomap.Class(geomap.CommonMethods,geomap.Observable,{map:undefined,root:undefined,toolBar:undefined,tbOpt:{className:"toolBar"},tbStyle:{width:"100%",height:"50px"},layers:[],menu:undefined,title:"图层信息",initialize:function(i){i||(i={});this._setOptions(i);this.root=a.create("div");this.toolBar=a.create("div",this.tbOpt,this.tbStyle);this.tableDiv=a.create("div");this.detailDiv=a.create("div",{},{padding:"20px"});this.root.appendChild(this.toolBar);this.root.appendChild(this.tableDiv);this.root.appendChild(this.detailDiv);this.addToolBar();if(this.map!=undefined){this.setMap(this.map)}},setMap:function(i){this.map=i;this.createMapLayerTable();this.map.on("server_layer_ok",this._loadMapLayer.bind(this))},addToMenu:function(i){this.menu=i;this.menu.on("menu_click",this.menuClick.bind(this));this.menu.addMenu({mapMenu:true,type:"serverLayerInfo",text:this.title,id:"map_server_layer_info"})},menuClick:function(i){var k=i.menu,j=k.data;if(j.mapMenu&&j.type==="serverLayerInfo"){if(this.viewFrame){this.viewFrame.show()}else{this.viewFrame=new geomap.view.Frame(document.body,{title:this.title,body:this.getElement(),w:600,h:450,closeType:2})}}},getElement:function(){return this.root},addToolBar:function(){var j=this.editForm.bind(this);var i=a.create("input",{value:"添加",type:"button",className:"btn"});eventjs.add(i,"click",j);this.toolBar.appendChild(i)},_loadMapLayer:function(){this.layers=this.map._server_layers;this.createMapLayerTable()},createMapLayerTable:function(){var v={opt:"操作"};var r=[{text:"删除",tag:"a",id:"delete",style:{cursor:"pointer"}},{text:"显隐",tag:"a",id:"display"}];var m={layerOrder:"序号",layerType:"类型",display:"状态",title:"图层说明",layerSource:"图层源"};var w=document.createElement("thead");var x=document.createElement("tr");for(var y in m){var n=document.createElement("td");n.innerText=m[y];x.appendChild(n)}for(var y in v){var n=document.createElement("td");n.innerText=v[y];x.appendChild(n)}w.appendChild(x);var s=document.createElement("tbody");if(this.layers!=undefined&&this.layers.length>0){for(var q=0,o=this.layers.length;q<o;q++){var u=this.layers[q];var x=document.createElement("tr");for(var y in m){var n=document.createElement("td");n.innerText=u[y];x.appendChild(n)}if(r.length>0){var n=document.createElement("td");x.appendChild(n);for(var p=0,t=r.length;p<t;p++){var z=r[p];var l=a.create(z.tag,{},z.style||{paddingLeft:"10px",cursor:"pointer"});l.innerText=z.text;l._rowIndex=q;l._data=z;l._myself=this;eventjs.add(l,"click",function(j,i){eventjs.cancel(j);this.eventFn(j,i)}.bind(this));n.appendChild(l)}}s.appendChild(x)}}if(!this.table){this.table=document.createElement("table");eventjs.add(this.table,"drag",this.dragTableEvent.bind(this));eventjs.add(this.table,"mouseOver",this.mouseOverEvent.bind(this));this.tableDiv.appendChild(this.table)}this.table.innerHTML="";this.table.appendChild(w);this.table.appendChild(s)},dragTableEvent:function(j,t){var o=t.target,m=j.target;if(t.state==="down"){eventjs.cancel(j);var q=m;if(m.nodeName=="TD"){q=m.parentElement||m.parentNode;this._drag_tr=q;this._drag_rowIndex=q.rowIndex}}else{if(t.state==="up"){if(this._drag_on_tr&&this._drag_tr!=undefined){if(this._drag_on_tr.rowIndex==this._drag_rowIndex){}else{if(this._drag_tr.querySelectorAll){var s=this._drag_tr.querySelectorAll("td");this.table.deleteRow(this._drag_rowIndex);var u=null;var p=this._drag_rowIndex;var r=this._drag_on_tr.rowIndex;if(this._drag_rowIndex<this._drag_on_tr.rowIndex){r+=1;u=this.table.insertRow(r)}else{u=this.table.insertRow(r)}for(var n=0,l=s.length;n<l;n++){u.appendChild(s[n])}this.orderChangeFn(p-1,r-1)}}}this._drag_tr=undefined}}},mouseOverEvent:function(q,n){var j=q.target;var p=j;if(j.nodeName=="TD"){p=j.parentElement||j.parentNode;this._drag_on_tr=p;var l=this.table.querySelectorAll("tr.selected");for(var o=0,m=l.length;o<m;o++){var r=l[o];a.removeClass(r,"selected")}if(this._drag_tr){a.addClass(this._drag_on_tr,"selected")}}},editForm:function(){var i=this.addLayerFn.bind(this);var j={name:"车位",id:"form_edit_parking",properties:[{id:"title",type:"text",title:"图层说明",value:"",required:false},{id:"layerSource",type:"text",title:"图层源",value:"",required:false},{id:"layerType",type:"radio",title:"类型",value:"POLYGON",option:{POLYGON:"面",POINT:"点",RASTER:"栅格图    "},required:false},{id:"display",type:"radio",title:"状态",value:"1",option:{"1":"可见","2":"不可见"},required:true},{id:"styleId",type:"radio",title:"样式",value:"parking_polygon",option:{parking_polygon:"车位面",parking_point:"车位点",line_dash:"楼栋边界线"},required:true}],buttons:[{title:"确定",type:"button",value:"确定",click:i}]};var k=a.parseToForm(j);this.addFormEl=k;this.detailDiv.innerHTML="";this.detailDiv.appendChild(k)},orderChangeFn:function(k,i){var j=this;j.map.orderChangeFn(k,i)},addLayerFn:function(){var j=a.formToJson(this.addFormEl);var i=this;i.map.addServerLayer(j)},eventFn:function(j,r){var k=r.target,q=k._myself,l=k._data,o=k._rowIndex;if(l.id=="delete"){var m=typeof o==="string"?Number(o):o;if(q.layers.length>m){var n=q.layers[m];q.map.deleteServerLayer(n.id)}}else{if(l.id=="display"){var m=typeof o==="string"?Number(o):o;if(q.layers.length>m){var n=q.layers[m];var p=n.display==1?0:1;q.map.displayServerLayer(n.id,p)}}}},})})(typeof exports!=="undefined"?exports:this);(function(f){if(!f.MapProject){f.MapProject={}}if(f.MapProject.Menu){geomap.warn("MapProject.Menu is already defined.");return}var g=geomap.util,b=geomap.request,e=g.template,c=g.toPoint,a=geomap.element;var h=g.object.extend;var d=geomap.Point;MapProject.Menu=geomap.Class(geomap.CommonMethods,geomap.Observable,{map:undefined,container:undefined,toolBar:undefined,tbOpt:{className:"menu-nav"},tbStyle:{},memuOpt:{className:"menu-item"},menu:[],mapmenu:[{mapMenu:true,type:"reference_line",text:"参考线",id:"map_reference_Line"}],_mapmenu:[],initialize:function(i,j){j||(j={});this._setOptions(j);if(typeof i==="string"){this.container=document.getElementById(i)}else{this.container=i}this.toolBar=a.create("ul",this.tbOpt,this.tbStyle);eventjs.add(this.toolBar,"click",this._ev_menu_item);this.container.appendChild(this.toolBar);this._init_handle_ev();if(this.map!=undefined){this.setMap(this.map)}this._init_menu()},_init_handle_ev:function(){this._init_map_menu=this.__init_map_menu.bind(this)},setMap:function(i){this.map=i;this.__init_map_menu();this.map.on("map_complete",this._init_map_menu)},addMenu:function(i){this.menu.push(i);this.__init_map_menu()},__init_map_menu:function(){this._mapmenu=[];var j=this.mapmenu;for(var o=0,n=j.length;o<n;o++){var p=j[o];this._mapmenu.push(p)}if(this.map&&this.map._projectMap){var l=this.map._projectMap;for(var o=0,n=l.length;o<n;o++){var r=l[o];var q="map_"+o;this._mapmenu.push({mapMenu:true,type:"layer",id:q,text:r.subTitle,layerIndex:o})}}this._init_menu()},_init_menu:function(){this.toolBar.innerHTML="";for(var l=0,j=this._mapmenu.length;l<j;l++){var n=this._mapmenu[l];var m=this._create_menu_item(n);this.toolBar.appendChild(m)}for(var l=0,j=this.menu.length;l<j;l++){var n=this.menu[l];var m=this._create_menu_item(n);this.toolBar.appendChild(m)}},_create_menu_item:function(l){var i=a.create("li",this.memuOpt);var j=a.create("a");if(l.icon!=undefined&&l.icon!=""){j.innerHTML=l.icon+"&nbsp;"+l.text}else{j.innerText=l.text}var k=this;i.__menu_item=true;i._data={data:l,target:k};i.appendChild(j);return i},_ev_menu_item:function(k,i){var m=k.target;if(m!=undefined){var n=m;while(n.__menu_item==undefined&&n.nodeName!="BODY"){n=n.parentElement||n.parentNode}if(n._data&&n._data.target&&n._data.target._ev_menu_map(n._data)){var j=n._data.target;var l={event:k,self:i,menu:{target:n,data:n._data.data,self:j}};j.fire("menu_click",l)}}},_ev_menu_map:function(j){var i=true,k=j.target,l=j.data;if(k&&k.map&&l.id){if(l.mapMenu){if(l.type==="layer"){if(l.layerIndex!=undefined){k.map.mapChange(l.layerIndex);i=false}}else{if(l.type==="reference_line"){k.map.toggleReferenceLine();i=false}}}}return i}})})(typeof exports!=="undefined"?exports:this);(function(f){if(!f.MapProject){f.MapProject={}}if(f.MapProject.MapQuery){geomap.warn("MapProject.MapQuery is already defined.");return}var g=geomap.util,b=geomap.request,e=g.template,c=g.toPoint,a=geomap.element;var h=g.object.extend;var d=geomap.Point;MapProject.MapQuery=geomap.Class(geomap.CommonMethods,geomap.Observable,{url:undefined,root:undefined,title:"查询结果",width:600,height:400,tbOpt:{},tbStyle:{width:"100%"},map:undefined,table:undefined,buttons:[{text:"删除",tag:"a",style:{cursor:"pointer"}}],initialize:function(i){i||(i={});this._setOptions(i);this.root=a.create("div");this._eventFn=this.eventFn.bind(this);this.on("coord_data",this.coord_data.bind(this))},coord_data:function(i){this.viewData(i);this.showFrame()},viewData:function(n){var x=[];if(!this.table){this.table=a.create("table",this.tbOpt,this.tbStyle);this.root.appendChild(this.table)}this.table.innerHTML="";if(n.type=="FeatureCollection"){var r=n.features.length;for(var B=0;B<r;B++){var s=n.features[B];var u=s.properties;var o=s.id.split(".");if(o.length>1){u.id=o[1]}else{u.id=s.id}x.push(u)}}else{if(n.type=="Feature"){var u=n.properties;var o=n.id.split(".");if(o.length>1){u.id=o[1]}else{u.id=n.id}x.push(u)}}if(x.length>0){var E=this.table;var D=a.create("thead");E.appendChild(D);var w=a.create("tr");D.appendChild(w);for(var F in x[0]){var t=a.create("th");t.innerText=F;w.appendChild(t)}if(this.buttons.length>0){var y=a.create("th");y.innerText="操作";w.appendChild(y)}var m=a.create("tbody");E.appendChild(m);for(var B=0,z=x.length;B<z;B++){var p=a.create("tr");m.appendChild(p);for(var F in x[B]){var t=a.create("td");t.innerText=x[B][F];p.appendChild(t)}if(this.buttons.length>0){var v=a.create("td");p.appendChild(v);for(var A=0,C=this.buttons.length;A<C;A++){var l=this.buttons[A];var q=a.create(l.tag,l.opt||{},l.style||{});q.innerText=l.text;q._data=x[B];q.self=l;eventjs.add(q,"click",this._eventFn);v.appendChild(q)}}}}},eventFn:function(l,i){var n=i.target,m=n._data,k=n.self;console.log("td===,id="+m.parking_id);if(k&&k.fn){var j={data:m,self:k,target:n};k.fn(l,j)}},removeRow:function(i){var j=i;while(j&&j.tagName.toString()!="TR"&&j.tagName.toString()!="tr"){j=j.parentElement||j.parentNode}if(j&&j.tagName=="TR"){j.remove()}},showFrame:function(){if(this.viewFrame){this.viewFrame.show()}else{this.viewFrame=new geomap.view.Frame(document.body,{title:this.title,body:this.root,w:this.width,h:this.height,closeType:2})}}})})(typeof exports!=="undefined"?exports:this);(function(f){if(!f.MapProject){f.MapProject={}}if(f.MapProject.MapDraw){geomap.warn("MapProject.MapDraw is already defined.");return}var g=geomap.util,b=geomap.request,e=g.template,c=g.toPoint,a=geomap.element;var h=g.object.extend;var d=geomap.Point;MapProject.MapDraw=geomap.Class(geomap.CommonMethods,geomap.Observable,{url:undefined,root:undefined,title:"结果",width:600,height:400,tbOpt:{},tbStyle:{width:"100%"},map:undefined,table:undefined,drawType:"Rect",fill:true,buttons:[{text:"删除",tag:"a",style:{cursor:"pointer"}}],form:{name:"车位",id:"form_edit_parking",properties:[{id:"id",type:"text",title:"车位ID",value:"",required:false},{id:"building_id",type:"text",title:"楼栋",value:"",required:false},{id:"parking_no",type:"text",title:"车位编号",value:"",required:false},{id:"map_id",type:"hidden",title:"地图ID",value:"",required:true},{id:"sale_status",type:"radio",title:"销售状态",value:"1",option:{"1":"已售","2":"未售"},required:true}]},initialize:function(i){i||(i={});this._setOptions(i);this._saveGeomEv=this.saveGeomEv.bind(this);this._closeFrameEv=this.closeFrameEv.bind(this);this.root=a.create("div");this.on("geom_data",this.geomDataCallback.bind(this))},closeFrameEv:function(j,i){this.map.clearDrawGeometry()},saveGeomEv:function(){if(this.form&&this.form.id&&this._data_geom){var j=a.formToJson(document.getElementById(this.form.id));var l=this._data_geom.getText();var m="";for(var i in j){if(i==="id"){m=j[i];delete j[i]}}var k=this;k.map.jsonReq(this.url,{geometry:l,properties:j,id:m},function(n){k.map.refresh();k.hideFrame()})}},getViewForm:function(){var i=this.form;var k=i.id;i.buttons=[{id:"ok",type:"button",title:"",value:"确定",click:this._saveGeomEv}];var j=a.parseToForm(i);return j},geomDataCallback:function(i){var m=i.geometry,k=i.layer,j=i.clearDraw;var l=this;this._data_geom=m;if(j){j()}if(m._coordinates.length<1){return}this.showFrame()},showFrame:function(){if(this.viewFrame){this.viewFrame.show()}else{this.viewFrame=new geomap.view.Frame(document.body,{title:this.title,body:this.getViewForm(),w:this.width,h:this.height,closeType:2})}},hideFrame:function(){if(this.viewFrame){this.viewFrame.hide()}}})})(typeof exports!=="undefined"?exports:this);